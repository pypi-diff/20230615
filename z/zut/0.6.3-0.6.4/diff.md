# Comparing `tmp/zut-0.6.3-py3-none-any.whl.zip` & `tmp/zut-0.6.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,31 +1,32 @@
-Zip file size: 70435 bytes, number of entries: 59
--rw-rw-rw-  2.0 fat     2157 b- defN 23-Jun-14 14:15 zut/__init__.py
--rw-rw-rw-  2.0 fat      164 b- defN 23-Jun-14 14:32 zut/_version.py
+Zip file size: 72279 bytes, number of entries: 60
+-rw-rw-rw-  2.0 fat     2172 b- defN 23-Jun-15 12:07 zut/__init__.py
+-rw-rw-rw-  2.0 fat      164 b- defN 23-Jun-15 16:31 zut/_version.py
 -rw-rw-rw-  2.0 fat      276 b- defN 23-Jun-12 06:54 zut/apps.py
 -rw-rw-rw-  2.0 fat      949 b- defN 23-Jun-12 06:54 zut/colors.py
 -rw-rw-rw-  2.0 fat     6914 b- defN 23-Jun-14 14:15 zut/commands.py
 -rw-rw-rw-  2.0 fat     1979 b- defN 23-Jun-14 14:31 zut/config.py
 -rw-rw-rw-  2.0 fat     9861 b- defN 23-Jun-14 14:15 zut/credentials.py
--rw-rw-rw-  2.0 fat     1218 b- defN 23-Jun-12 06:54 zut/csv.py
--rw-rw-rw-  2.0 fat     1488 b- defN 23-Jun-14 14:15 zut/datetime.py
--rw-rw-rw-  2.0 fat    17630 b- defN 23-Jun-14 14:15 zut/excel.py
--rw-rw-rw-  2.0 fat     9037 b- defN 23-Jun-14 14:15 zut/filesh.py
+-rw-rw-rw-  2.0 fat     1220 b- defN 23-Jun-15 16:27 zut/csv.py
+-rw-rw-rw-  2.0 fat     1662 b- defN 23-Jun-15 12:10 zut/datetime.py
+-rw-rw-rw-  2.0 fat    19433 b- defN 23-Jun-15 12:10 zut/excel.py
+-rw-rw-rw-  2.0 fat    12996 b- defN 23-Jun-15 10:42 zut/filesh.py
 -rw-rw-rw-  2.0 fat     2590 b- defN 23-Jun-12 06:54 zut/git.py
 -rw-rw-rw-  2.0 fat     1537 b- defN 23-Jun-14 14:15 zut/gpg.py
 -rw-rw-rw-  2.0 fat     4943 b- defN 23-Jun-12 06:54 zut/json.py
--rw-rw-rw-  2.0 fat      731 b- defN 23-Jun-14 14:15 zut/lang.py
+-rw-rw-rw-  2.0 fat      429 b- defN 23-Jun-15 12:07 zut/lang.py
 -rw-rw-rw-  2.0 fat     4578 b- defN 23-Jun-14 14:15 zut/logging.py
--rw-rw-rw-  2.0 fat     3116 b- defN 23-Jun-14 14:15 zut/numeric.py
+-rw-rw-rw-  2.0 fat     3252 b- defN 23-Jun-15 12:12 zut/numeric.py
 -rw-rw-rw-  2.0 fat     2710 b- defN 23-Jun-14 14:15 zut/process.py
 -rw-rw-rw-  2.0 fat     2054 b- defN 23-Jun-12 06:54 zut/tabular.py
 -rw-rw-rw-  2.0 fat     2019 b- defN 23-Jun-12 06:54 zut/text.py
+-rw-rw-rw-  2.0 fat      309 b- defN 23-Jun-15 12:06 zut/typing.py
 -rw-rw-rw-  2.0 fat      632 b- defN 23-Jun-14 14:15 zut/venv.py
 -rw-rw-rw-  2.0 fat     1665 b- defN 23-Jun-12 11:26 zut/db/__init__.py
--rw-rw-rw-  2.0 fat    15036 b- defN 23-Jun-14 14:15 zut/db/commons.py
+-rw-rw-rw-  2.0 fat    14970 b- defN 23-Jun-15 12:14 zut/db/commons.py
 -rw-rw-rw-  2.0 fat     2650 b- defN 23-Jun-12 11:26 zut/db/mssql.py
 -rw-rw-rw-  2.0 fat     8672 b- defN 23-Jun-12 11:26 zut/db/pg.py
 -rw-rw-rw-  2.0 fat       42 b- defN 23-Jun-12 06:54 zut/db/sql_pg/010_extensions.sql
 -rw-rw-rw-  2.0 fat      479 b- defN 23-Jun-12 06:54 zut/db/sql_pg/020_slugify.sql
 -rw-rw-rw-  2.0 fat     1157 b- defN 23-Jun-12 11:26 zut/django/migration_tools.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Jun-12 06:54 zut/django/management/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Jun-12 06:54 zut/django/management/commands/__init__.py
@@ -35,27 +36,27 @@
 -rw-rw-rw-  2.0 fat     2808 b- defN 23-Jun-12 06:54 zut/django/templatetags/static_lib.py
 -rw-rw-rw-  2.0 fat     9036 b- defN 23-Jun-12 11:26 zut/django/tracking/__init__.py
 -rw-rw-rw-  2.0 fat     4666 b- defN 23-Jun-12 11:26 zut/django/tracking/models.py
 -rw-rw-rw-  2.0 fat      621 b- defN 23-Jun-12 11:26 zut/django/tracking/sql_pg/tracking_history_view.sql
 -rw-rw-rw-  2.0 fat     1652 b- defN 23-Jun-12 06:54 zut/django/views/MarkdownTemplateView.py
 -rw-rw-rw-  2.0 fat       56 b- defN 23-Jun-12 06:54 zut/django/views/__init__.py
 -rw-rw-rw-  2.0 fat     1767 b- defN 23-Jun-14 14:15 zut/inout/InCsv.py
--rw-rw-rw-  2.0 fat     2155 b- defN 23-Jun-14 14:15 zut/inout/InDb.py
+-rw-rw-rw-  2.0 fat     2124 b- defN 23-Jun-15 16:27 zut/inout/InDb.py
 -rw-rw-rw-  2.0 fat     1403 b- defN 23-Jun-14 14:15 zut/inout/InExcel.py
--rw-rw-rw-  2.0 fat     4127 b- defN 23-Jun-14 14:15 zut/inout/InTable.py
--rw-rw-rw-  2.0 fat     4662 b- defN 23-Jun-14 14:15 zut/inout/OutCsv.py
--rw-rw-rw-  2.0 fat     2884 b- defN 23-Jun-14 14:15 zut/inout/OutDb.py
--rw-rw-rw-  2.0 fat     3076 b- defN 23-Jun-14 14:15 zut/inout/OutExcel.py
--rw-rw-rw-  2.0 fat     3202 b- defN 23-Jun-14 14:15 zut/inout/OutFile.py
--rw-rw-rw-  2.0 fat     9687 b- defN 23-Jun-14 14:15 zut/inout/OutTable.py
+-rw-rw-rw-  2.0 fat     4082 b- defN 23-Jun-15 12:15 zut/inout/InTable.py
+-rw-rw-rw-  2.0 fat     4626 b- defN 23-Jun-15 16:27 zut/inout/OutCsv.py
+-rw-rw-rw-  2.0 fat     2876 b- defN 23-Jun-15 16:27 zut/inout/OutDb.py
+-rw-rw-rw-  2.0 fat     3340 b- defN 23-Jun-15 16:27 zut/inout/OutExcel.py
+-rw-rw-rw-  2.0 fat     3151 b- defN 23-Jun-15 16:27 zut/inout/OutFile.py
+-rw-rw-rw-  2.0 fat    10204 b- defN 23-Jun-15 16:27 zut/inout/OutTable.py
 -rw-rw-rw-  2.0 fat     1163 b- defN 23-Jun-14 14:15 zut/inout/OutTabulate.py
--rw-rw-rw-  2.0 fat     7385 b- defN 23-Jun-14 14:15 zut/inout/__init__.py
--rw-rw-rw-  2.0 fat     2922 b- defN 23-Jun-14 14:15 zut/inout/utils.py
+-rw-rw-rw-  2.0 fat     7261 b- defN 23-Jun-15 12:15 zut/inout/__init__.py
+-rw-rw-rw-  2.0 fat     2786 b- defN 23-Jun-15 12:17 zut/inout/utils.py
 -rw-rw-rw-  2.0 fat     9147 b- defN 23-Jun-12 06:54 zut/network/__init__.py
 -rw-rw-rw-  2.0 fat     3850 b- defN 23-Jun-12 06:54 zut/network/commons.py
 -rw-rw-rw-  2.0 fat     2962 b- defN 23-Jun-12 06:54 zut/network/winhttp.py
--rw-rw-rw-  2.0 fat     1066 b- defN 23-Jun-14 14:32 zut-0.6.3.dist-info/LICENSE.txt
--rw-rw-rw-  2.0 fat     4840 b- defN 23-Jun-14 14:32 zut-0.6.3.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-14 14:32 zut-0.6.3.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        4 b- defN 23-Jun-14 14:32 zut-0.6.3.dist-info/top_level.txt
--rw-rw-r--  2.0 fat     4556 b- defN 23-Jun-14 14:32 zut-0.6.3.dist-info/RECORD
-59 files, 207680 bytes uncompressed, 63391 bytes compressed:  69.5%
+-rw-rw-rw-  2.0 fat     1066 b- defN 23-Jun-15 16:31 zut-0.6.4.dist-info/LICENSE.txt
+-rw-rw-rw-  2.0 fat     4962 b- defN 23-Jun-15 16:31 zut-0.6.4.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-15 16:31 zut-0.6.4.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        4 b- defN 23-Jun-15 16:31 zut-0.6.4.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat     4627 b- defN 23-Jun-15 16:31 zut-0.6.4.dist-info/RECORD
+60 files, 214253 bytes uncompressed, 65133 bytes compressed:  69.6%
```

## zipnote {}

```diff
@@ -54,14 +54,17 @@
 
 Filename: zut/tabular.py
 Comment: 
 
 Filename: zut/text.py
 Comment: 
 
+Filename: zut/typing.py
+Comment: 
+
 Filename: zut/venv.py
 Comment: 
 
 Filename: zut/db/__init__.py
 Comment: 
 
 Filename: zut/db/commons.py
@@ -156,23 +159,23 @@
 
 Filename: zut/network/commons.py
 Comment: 
 
 Filename: zut/network/winhttp.py
 Comment: 
 
-Filename: zut-0.6.3.dist-info/LICENSE.txt
+Filename: zut-0.6.4.dist-info/LICENSE.txt
 Comment: 
 
-Filename: zut-0.6.3.dist-info/METADATA
+Filename: zut-0.6.4.dist-info/METADATA
 Comment: 
 
-Filename: zut-0.6.3.dist-info/WHEEL
+Filename: zut-0.6.4.dist-info/WHEEL
 Comment: 
 
-Filename: zut-0.6.3.dist-info/top_level.txt
+Filename: zut-0.6.4.dist-info/top_level.txt
 Comment: 
 
-Filename: zut-0.6.3.dist-info/RECORD
+Filename: zut-0.6.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## zut/__init__.py

```diff
@@ -13,23 +13,24 @@
 from .csv import get_default_csv_delimiter
 from .datetime import now_aware, make_aware, is_aware
 from .filesh import configure_smb_credentials  # other functions should be called directly with the module, e.g. `from zut import filesh`, then `filesh.open_file(...)`
 from .git import get_git_tags, get_git_hash, git_has_changes, check_git_version_tag
 from .gpg import download_gpg_key, verify_gpg_signature
 from .inout import out_file, out_table, in_table, transfer_table, OutFile, OutTable, OutTabulate, OutCsv, OutExcel, OutDb, InTable, InCsv, InExcel, InDb, normalize_inout
 from .json import ExtendedJSONDecoder, ExtendedJSONEncoder
-from .lang import ZUT_ROOT, Literal, Protocol, Self, is_list_or_tuple_of
+from .lang import ZUT_ROOT, is_list_or_tuple_of
 from .logging import configure_logging, DEFAULT_LOGGING_DICTCONFIG
 from .network import configure_proxy, check_connectivity, check_socket
 from .numeric import human_bytes, parse_decimal
 from .process import get_exit_code, check_completed_subprocess
 from .text import slugify, slugify_snake, remove_whitespaces, remove_consecutive_whitespaces, reconfigure_encoding
 from .venv import get_venv, is_in_venv
 
 
 # NOTE: Inner API: the following features require extra dependencies.
 # zut.credentials       -> [credentials]
 # zut.db                -> [pg] or [mssql]
 # zut.django            -> [django]: django, djangorestframework (for zut.django.middleware), cmarkgfm (for zut.django.views.MarkdownTemplateView)
 # zut.excel             -> [excel]
-# zut.filesh         -> [smb] (for operations on Samba/Windows shares)
+# zut.filesh            -> [smb] (for operations on Samba/Windows shares)
 # zut.network.winhttp   -> [winhttp]
+# zut.typing            -> [typing]
```

## zut/_version.py

```diff
@@ -1,4 +1,4 @@
 # file generated by setuptools_scm
 # don't change, don't track in version control
-__version__ = version = '0.6.3'
-__version_tuple__ = version_tuple = (0, 6, 3)
+__version__ = version = '0.6.4'
+__version_tuple__ = version_tuple = (0, 6, 4)
```

## zut/csv.py

 * *Ordering differences only*

```diff
@@ -37,8 +37,8 @@
         except StopIteration:
             return None
 
     finally:
         if fp_to_close:
             fp_to_close.close()
         else:
-            fp.seek(0)
+            fp.seek(0)
```

## zut/datetime.py

```diff
@@ -1,25 +1,30 @@
 from __future__ import annotations
 from datetime import datetime, time, timezone, timedelta
-from .lang import Literal
 
 
 def is_aware(value: datetime|time):
     if value is None:
         return False
     return value.utcoffset() is not None
 
 
-def make_aware(value: datetime|time, tz: Literal['local']|timezone = 'local'):
+def make_aware(value: datetime|time, tz: timezone = 'local'):
+    """
+    Make a datetime aware in the timezone `tz` (use `tz='local'` for the local system timezone).
+    """
     if value is None:
         return None
     return value.astimezone(None if tz == 'local' else tz)
 
 
-def now_aware(tz: Literal['local']|timezone = 'local', no_microsecond = False):
+def now_aware(tz: timezone = 'local', no_microsecond = False):
+    """
+    Get the current datetime in the timezone `tz` (use `tz='local'` for the local system timezone).
+    """
     now = datetime.now(timezone.utc).astimezone(None if tz == 'local' else tz)
     if no_microsecond:
         now = now.replace(microsecond=0)
     return now
 
 
 def duration_iso_string(duration):
```

## zut/excel.py

```diff
@@ -1,13 +1,12 @@
 from __future__ import annotations
 import logging
 from pathlib import Path
 from typing import Any
 from .tabular import Row
-from .lang import Literal
 from . import filesh
 from openpyxl import load_workbook, Workbook, DEFUSEDXML
 from openpyxl.worksheet.worksheet import Worksheet
 from openpyxl.worksheet.table import Table, TableColumn, TableFormula, TableStyleInfo
 from openpyxl.worksheet.formula import DataTableFormula, ArrayFormula
 from openpyxl.worksheet.filters import AutoFilter
 from openpyxl.cell.cell import Cell
@@ -77,15 +76,15 @@
         logger.debug("save workbook %s", self.path)
         with filesh.open_file(self.path, 'wb') as fp:
             self._pyxl_workbook.save(fp)
 
         self._needs_save = False
         
 
-    def get_table(self, name: str, default: Any|Literal['__raise__'] = '__raise__') -> ExcelTable:
+    def get_table(self, name: str, default = '__raise__') -> ExcelTable:
         if name in self._tables:
             return self._tables[name]
         
         for sheet_name in self._pyxl_workbook.sheetnames:
             pyxl_worksheet: Worksheet = self._pyxl_workbook[sheet_name]
             if name in pyxl_worksheet.tables:
                 pyxl_table = pyxl_worksheet.tables[name]
@@ -117,66 +116,71 @@
         return self._tables[name]
 
 
 class ExcelTable:
     def __init__(self, pyxl_table: Table|str, pyxl_worksheet: Worksheet, workbook: ExcelWorkbook, no_headers: bool = None):
         self.workbook = workbook
         self._pyxl_worksheet = pyxl_worksheet        
-        self._column_formats: dict[int,dict[str,Any]] = {}
 
         if isinstance(pyxl_table, str):
             self._pyxl_table: Table = None
             self.name: str = pyxl_table
             if no_headers:
                 self.has_headers = False
-                self._min_row = 1
+                self._min_row_index = 0
             else:
                 self.has_headers = True
-                self._min_row = 2
-            self._min_col = 1
+                self._min_row_index = 1
+            self._min_col_index = 0
             self._row_count = 0
             self._column_names: list[str] = []
 
         elif isinstance(pyxl_table, Table):
             self._pyxl_table: Table = pyxl_table
             self.name: str = pyxl_table.name
             
-            self._min_col, min_row, max_col, max_row = range_boundaries(pyxl_table.ref)
+            min_col, min_row, max_col, max_row = range_boundaries(pyxl_table.ref)
 
+            # NOTE: range_boundaries returns 1-base indices
+            self._min_col_index = min_col - 1
             if pyxl_table.headerRowCount == 0:
                 self.has_headers = False
-                self._min_row = min_row
+                self._min_row_index = min_row - 1
             elif pyxl_table.headerRowCount == 1:
                 self.has_headers = True
-                self._min_row = min_row + 1
+                self._min_row_index = min_row
             else:
                 raise ValueError(f'invalid headerRowCount: {pyxl_table.headerRowCount}')
             
-            self._row_count = max_row - self._min_row + 1
-            col_count = max_col - self._min_col + 1
+            self._row_count = max_row - self._min_row_index
+            col_count = max_col - self._min_col_index
         
             self._column_names: list[str] = list(self._pyxl_table.column_names)
             # NOTE: if no headers, default names are returned, example in French: ['Colonne1', 'Colonne2']
             if len(self._column_names) != col_count:
                 raise ValueError(f'invalid column_names length ({len(self._column_names)}, expected {col_count}): {self._column_names}')
         else:
             raise ValueError(f"invalid type for pyxl_table: {type(pyxl_table).__name__}")
 
+        self._column_formats: list[dict[str,Any]] = None
+
 
     @property
     def column_names(self) -> list[str]:
         return self._column_names
 
     @property
-    def min_row(self) -> int:
-        return self._min_row
+    def min_row_index(self) -> int:
+        """ 0-base index of the first data row. """
+        return self._min_row_index
     
     @property
-    def min_col(self) -> int:
-        return self._min_col
+    def min_col_index(self) -> int:
+        """ 0-base index of the first column. """
+        return self._min_col_index
     
     @property
     def row_count(self) -> int:
         return self._row_count
     
     @property
     def col_count(self) -> int:
@@ -184,23 +188,22 @@
     
     @property
     def ref(self) -> str:
         if self.col_count == 0:
             raise ValueError(f"cannot get table ref: table does not contain any column")
         if self.row_count == 0 and not self.has_headers:
             raise ValueError(f"cannot get table ref: table does not contain any line")
-        
-        min_row = self._min_row
-        if self.has_headers:
-            min_row -= 1
-        
-        return f"{get_column_letter(self._min_col)}{min_row}:{get_column_letter(self._min_col + self.col_count - 1)}{self._min_row + self._row_count - 1}"
+                
+        return f"{get_column_letter(self._min_col_index + 1)}{self._min_row_index - (1 if self.has_headers else 0) + 1}:{get_column_letter(self._min_col_index + self.col_count)}{self._min_row_index + self._row_count}"
 
 
     def get_row(self, index: int) -> Row:
+        """
+        Get row at the given 0-base index.
+        """
         if index == -1:
             if self.row_count == 0:
                 raise ValueError(f"cannot get last row: table does not contain any row")
             index = self.row_count - 1
         elif index < 0:
             raise ValueError(f"invalid row index: {index}")
         
@@ -216,23 +219,23 @@
 
     def insert_row(self) -> Row:
         self.workbook._needs_save = True
         row_index = self._row_count
 
         # ensure empty values
         for col_index in range(0, self.col_count):
-            cell = self._pyxl_worksheet.cell(self._min_row + row_index, self._min_col + col_index)
+            cell = self._pyxl_worksheet.cell(self._min_row_index + 1 + row_index, self._min_col_index + 1 + col_index)
             if cell.value is not None:
-                raise ValueError(f'cannot insert row: row {row_index} is not empty')
+                raise ValueError(f'cannot insert row: row at index {row_index} is not empty')
 
         self._row_count += 1
 
         # erase old styles and apply column format
         for col_index in range(0, self.col_count):
-            self._erase_cell(row_index, col_index)
+            self.erase_cell(row_index, col_index)
             
         return self.get_row(row_index)
     
 
     def insert_col(self, name: str):
         self.workbook._needs_save = True
         if not name:
@@ -240,52 +243,53 @@
         if name in self.column_names:
             raise ValueError(f'column name already used: {name}')
             
         col_index = self.col_count
 
         # ensure empty values
         for row_index in range(0, self._row_count):
-            cell = self._pyxl_worksheet.cell(self._min_row + row_index, self._min_col + col_index)
+            cell = self._pyxl_worksheet.cell(self._min_row_index + 1 + row_index, self._min_col_index + 1 + col_index)
             if cell.value is not None:
                 raise ValueError(f'cannot insert column: column {col_index} is not empty')
 
         self.column_names.append(name) # implies self.col_count += 1
 
         if self.has_headers:
-            cell = self._pyxl_worksheet.cell(self._min_row - 1, self._min_col + col_index)
+            cell = self._pyxl_worksheet.cell(self._min_row_index, self._min_col_index + 1 + col_index)
+            #logger.debug('set column name to cell %s%s: %s', cell.column_letter, cell.row, name)
             cell.value = name
 
         # erase old styles and apply column format
         for row_index in range(0, self._row_count):
-            self._erase_cell(row_index, col_index)
+            self.erase_cell(row_index, col_index)
             
 
     def truncate(self):
         self.workbook._needs_save = True
         prev_row_count = self._row_count
         self._row_count = 0
 
         for row_index in range(0, prev_row_count):
             for col_index in range(0, self.col_count):
-                self._erase_cell(row_index, col_index, allow_outside=True)
+                self.erase_cell(row_index, col_index, allow_outside=True)
 
 
     def redefine(self):
         self.workbook._needs_save = True
         new_ref = self.ref
         if self._pyxl_table is not None and new_ref == self._pyxl_table.ref:
             return
         
         logger.debug("define table %s: %s => %s", self.name, self._pyxl_table.ref if self._pyxl_table is not None else None, new_ref)
 
         newcolumns = []
 
         for i in range(0, self.col_count):
             if self.has_headers:
-                name = self._pyxl_worksheet.cell(self._min_row - 1, self._min_col + i).value
+                name = self._pyxl_worksheet.cell(self._min_row_index, self._min_col_index + 1 + i).value
             else:
                 name = self.column_names[i] if i < len(self.column_names) else None
             newcolumn = TableColumn(id=i+1, name=name)
             newcolumns.append(newcolumn)
 
             if self._pyxl_table is not None and i < len(self._pyxl_table.tableColumns):
                 prevcolumn: TableColumn = self._pyxl_table.tableColumns[i]
@@ -317,28 +321,34 @@
         if self.name in self._pyxl_worksheet.tables:
             del self._pyxl_worksheet.tables[self.name]
         self._pyxl_worksheet.add_table(newtable)
 
 
     def get_value(self, row_index: int, col_index: int) -> Any:
         self._check_indexes(row_index, col_index)
-        cell = self._pyxl_worksheet.cell(self._min_row + row_index, self._min_col + col_index)
+        cell = self._pyxl_worksheet.cell(self._min_row_index + 1 + row_index, self._min_col_index + 1 + col_index)
         value = cell.value
         # TODO: formatting
         return value
     
 
     def set_value(self, row_index: int, col_index: int, value: Any):
+        """
+        Set the value of the cell located at the given 0-base indices, and apply the default formatting and formulas of the corresponding table column.
+
+        Any value (including `None`) overrides default column formulas. If you want to use the default column formula, use `erase_cell` method instead.
+        """
         self._check_indexes(row_index, col_index)
         self.workbook._needs_save = True
-        cell = self._pyxl_worksheet.cell(self._min_row + row_index, self._min_col + col_index)
+        cell = self._pyxl_worksheet.cell(self._min_row_index + 1 + row_index, self._min_col_index + 1 + col_index)
 
         self._apply_column_format(cell)
 
         try:
+            #logger.debug('set value to cell %s%s: %s', cell.column_letter, cell.row, value)
             cell.value = value
         except ValueError as err:
             if str(err).startswith('Cannot convert'):
                 cell.value = str(value)
             else:
                 raise
         
@@ -351,88 +361,102 @@
 
         if row_index < 0 or row_index >= self.row_count:
             raise ValueError(f"invalid row index: {row_index} (row count: {self.row_count})")
         if col_index < 0 or col_index >= self.col_count:
             raise ValueError(f"invalid row index: {col_index} (row count: {self.col_count})")
 
 
-    def _erase_cell(self, row_index: int, col_index: int, allow_outside: bool = False) -> Cell:
-        cell = self._pyxl_worksheet.cell(self._min_row + row_index, self._min_col + col_index)
+    def erase_cell(self, row_index: int, col_index: int, allow_outside: bool = False):
+        """
+        Erase the value of the cell located at the given 0-base indices, and apply the default formatting and formulas of the corresponding table column.
+        
+        If `allow_outside` is set, the cell may be located outside of the table. In this case, no formatting or formula is applied.
+        """
+        if not allow_outside:
+            self._check_indexes(row_index, col_index)
+
+        self.workbook._needs_save = True
+        cell = self._pyxl_worksheet.cell(self._min_row_index + 1 + row_index, self._min_col_index + 1 + col_index)
         cell.style = 'Normal'
+        #logger.debug('erase cell %s%s', cell.column_letter, cell.row)
         cell.value = None
 
         if not allow_outside or (row_index < self._row_count and col_index < self.col_count):
             self._apply_column_format(cell)
-        
-        return cell
-
+    
 
     def _apply_column_format(self, cell: Cell):
-        index = cell.col_idx - self.min_col
-        if index in self._column_formats:
-            fmt = self._column_formats[index]
-        else:
-            fmt = self._build_column_format(index)
-            self._column_formats[index] = fmt
+        if self._column_formats is None:
+            self._column_formats = self._build_column_formats()
+        
+        index = (cell.col_idx - 1) - self._min_col_index
+        if index >= len(self._column_formats):
+            return
+        
+        fmt = self._column_formats[index]
 
         if 'formula' in fmt:
             formula = fmt['formula']
             if isinstance(formula, ArrayFormula):
                 pass # TODO: not supported yet
             else:
+                #logger.debug('apply formula to cell %s%s: %s', cell.column_letter, cell.row, formula)
                 cell.value = formula
 
         if 'style' in fmt:
             cell.style = fmt['style']
 
         for fmt_key, fmt_value in fmt.items():
             if fmt_key in ['formula', 'style']:
                 continue
             setattr(cell, fmt_key, fmt_value)
 
 
-    def _build_column_format(self, index: int):
-        fmt: dict[str,Any] = {}
-
-        if self._pyxl_table is None or index >= len(self._pyxl_table.tableColumns):
-            return fmt
-        
-        column: TableColumn = self._pyxl_table.tableColumns[index]
-
-        # Read dataCellStyle
-        if column.dataCellStyle:
-            fmt['style'] = column.dataCellStyle
-        
-        # Read dxf
-        if column.dataDxfId is not None:
-            dxf: DifferentialStyle = self.workbook._pyxl_workbook._differential_styles[column.dataDxfId]
+    def _build_column_formats(self) -> list[dict[str,Any]]:
+        if not self._pyxl_table:
+            return []
+                
+        column: TableColumn
+        fmt_list = []
+        for index, column in enumerate(self._pyxl_table.tableColumns):
+            fmt: dict[str,Any] = {}
+            fmt_list.append(fmt)
+
+            # Read dataCellStyle
+            if column.dataCellStyle:
+                fmt['style'] = column.dataCellStyle
+            
+            # Read dxf
+            if column.dataDxfId is not None:
+                dxf: DifferentialStyle = self.workbook._pyxl_workbook._differential_styles[column.dataDxfId]
+
+                if dxf.numFmt:
+                    fmt['number_format'] = dxf.numFmt.formatCode
+                else:
+                    if not 'style' in fmt:
+                        fmt['number_format'] = self._DEFAULT_NUMBER_FORMAT
+
+                fmt['alignment'] = dxf.alignment if dxf.alignment else self._DEFAULT_ALIGNMENT
+                fmt['border'] = dxf.border if dxf.border else self._DEFAULT_BORDER
+                fmt['font'] = dxf.font if dxf.font else self._DEFAULT_FONT
+                fmt['protection'] = dxf.protection if dxf.protection else self._DEFAULT_PROTECTION
+                fmt['fill'] = PatternFill(fill_type=dxf.fill.fill_type, bgColor=dxf.fill.fgColor, fgColor=dxf.fill.bgColor) if dxf.fill else self._DEFAULT_FILL # NOTE: fgcolor and bgcolor are inversed in DifferentialStyle
+
+            # Read formula
+            if column.calculatedColumnFormula:
+                formula = column.calculatedColumnFormula
+                if formula.array:
+                    fmt['formula'] = ArrayFormula(formula.attr_text)
+                else:
+                    fmt['formula'] = '=' + formula.attr_text
 
-            if dxf.numFmt:
-                fmt['number_format'] = dxf.numFmt.formatCode
-            else:
-                if not 'style' in fmt:
-                    fmt['number_format'] = self._DEFAULT_NUMBER_FORMAT
+                #logger.debug('column %s (%s) formula: %s', get_column_letter(index + 1), column.name, fmt['formula'])
+            
+        return fmt_list
 
-            fmt['alignment'] = dxf.alignment if dxf.alignment else self._DEFAULT_ALIGNMENT
-            fmt['border'] = dxf.border if dxf.border else self._DEFAULT_BORDER
-            fmt['font'] = dxf.font if dxf.font else self._DEFAULT_FONT
-            fmt['protection'] = dxf.protection if dxf.protection else self._DEFAULT_PROTECTION
-            fmt['fill'] = PatternFill(fill_type=dxf.fill.fill_type, bgColor=dxf.fill.fgColor, fgColor=dxf.fill.bgColor) if dxf.fill else self._DEFAULT_FILL # NOTE: fgcolor and bgcolor are inversed in DifferentialStyle
-
-        # Read formula
-        if column.calculatedColumnFormula:
-            formula = column.calculatedColumnFormula
-            if formula.array:
-                fmt['formula'] = ArrayFormula(formula.attr_text)
-            else:
-                fmt['formula'] = '=' + formula.attr_text
-        
-        # Return built format
-        return fmt
-    
 
     _DEFAULT_NUMBER_FORMAT = 'General'
     _DEFAULT_FILL = PatternFill(fill_type=None)
     _DEFAULT_ALIGNMENT = None # openpyxl.styles.alignment.Alignment
     _DEFAULT_BORDER = None # openpyxl.styles.alignment.Border
     _DEFAULT_FONT = None # openpyxl.styles.fonts.Font
     _DEFAULT_PROTECTION = None # openpyxl.styles.protection.Protection
```

## zut/filesh.py

```diff
@@ -1,14 +1,15 @@
 """
 Operations working on local files and on Samba/Windows shares.
 """
 from __future__ import annotations
 from datetime import datetime
 import os, ntpath, sys, logging, shutil
 from pathlib import Path
+from typing import Callable
 
 try:
     # package `smbprotocol`
     import smbclient
     import smbclient.path as smbclient_path
     import smbclient.shutil as smbclient_shutil
 except ImportError:
@@ -117,28 +118,37 @@
         return os.makedirs(path, exist_ok=exist_ok)
 
     if not smbclient:
         raise ModuleNotFoundError(f'missing package `smbprotocol`')
     return smbclient.makedirs(path, exist_ok=exist_ok)
 
 
-def remove(path: str):
+def remove(path: str, missing_ok: bool = False):
     path, native = _standardize(path)
 
+    if missing_ok:
+        if not exists(path):
+            return
+
     if native:
-        return os.remove(path)
+        os.remove(path)
+        return
 
     if not smbclient:
         raise ModuleNotFoundError(f'missing package `smbprotocol`')
-    return smbclient.remove(path)
+    smbclient.remove(path)
 
 
-def rmtree(path: str, ignore_errors=False, onerror=None):
+def rmtree(path: str, ignore_errors=False, onerror=None, missing_ok: bool = False):
     path, native = _standardize(path)
 
+    if missing_ok:
+        if not exists(path):
+            return
+
     if not native:
         return shutil.rmtree(path, ignore_errors=ignore_errors, onerror=onerror)
     
     if not smbclient_shutil:
         raise ModuleNotFoundError(f'missing package `smbprotocol`')
     return smbclient_shutil.rmtree(path, ignore_errors=ignore_errors, onerror=onerror)
 
@@ -188,88 +198,153 @@
     Open the file in text mode, write to it, and close the file.
     """
     with open_file(path, mode='w', encoding=encoding, errors=errors, newline=newline) as f:
         return f.write(data)
 
 
 def copy(src: str, dst: str, follow_symlinks=True):
+    """
+    Copy file data and file data and file's permission mode (which on Windows is only the read-only flag).
+    Other metadata like file's creation and modification times, are not preserved.
+
+    The destination may be a directory (in this case, the file will be copied into `dst` directory using
+    the base filename from `src`).
+
+    If `follow_symlinks` is `False`, `dst` will be created as a symbolic link if `src` is a symbolic link.
+    If `follow_symlinks` is `True`, `dst` will be a copy of the file `src` refers to.
+    """
     src, src_native = _standardize(src)
     dst, dst_native = _standardize(dst)
     
     if src_native and dst_native:
         return shutil.copy(src, dst, follow_symlinks=follow_symlinks)
     
     if not smbclient_shutil:
         raise ModuleNotFoundError(f'missing package `smbprotocol`')
     return smbclient_shutil.copy(src, dst, follow_symlinks=follow_symlinks)
 
 
 def copy2(src: str, dst: str, follow_symlinks=True):
+    """
+    Identical to `copy()` except that `copy2()` also attempts to preserve the file metadata.
+
+    `copy2()` uses `copystat()` to copy the file metadata. Please see `copystat()` for more information about how and what
+    metadata it copies to the `dst` file.
+
+    If `follow_symlinks` is `False`, `dst` will be created as a symbolic link if `src` is a symbolic link.
+    If `follow_symlinks` is `True`, `dst` will be a copy of the file `src` refers to.
+    """
     src, src_native = _standardize(src)
     dst, dst_native = _standardize(dst)
     
     if src_native and dst_native:
         return shutil.copy2(src, dst, follow_symlinks=follow_symlinks)
     
     if not smbclient_shutil:
         raise ModuleNotFoundError(f'missing package `smbprotocol`')
     return smbclient_shutil.copy2(src, dst, follow_symlinks=follow_symlinks)
 
 
 def copyfile(src: str, dst: str, follow_symlinks=True):
+    """
+    Copy the contents (no metadata) in the most efficient way possible.
+
+    If `follow_symlinks` is `False`, `dst` will be created as a symbolic link if `src` is a symbolic link.
+    If `follow_symlinks` is `True`, `dst` will be a copy of the file `src` refers to.
+    """
     src, src_native = _standardize(src)
     dst, dst_native = _standardize(dst)
     
     if src_native and dst_native:
         return shutil.copyfile(src, dst, follow_symlinks=follow_symlinks)
     
     if not smbclient_shutil:
         raise ModuleNotFoundError(f'missing package `smbprotocol`')
     return smbclient_shutil.copyfile(src, dst, follow_symlinks=follow_symlinks)
 
 
 def copystat(src: str, dst: str, follow_symlinks=True):
+    """
+    Copy the read-only attribute, last access time, and last modification time from `src` to `dst`.
+    The file contents, owner, and group are unaffected.
+
+    If `follow_symlinks` is `False` and `src` and `dst` both refer to symbolic links, the attributes will be read and written
+    on the symbolic links themselves (rather than the files the symbolic links refer to).
+    """
     src, src_native = _standardize(src)
     dst, dst_native = _standardize(dst)
     
     if src_native and dst_native:
         return shutil.copystat(src, dst, follow_symlinks=follow_symlinks)
     
     if not smbclient_shutil:
         raise ModuleNotFoundError(f'missing package `smbprotocol`')
     return smbclient_shutil.copystat(src, dst, follow_symlinks=follow_symlinks)
 
 
 def copymode(src: str, dst: str, follow_symlinks=True):
+    """
+    Copy the permission bits from `src` to `dst`.
+    The file contents, owner, and group are unaffected.
+    
+    Due to the limitations of Windows, this function only sets/unsets `dst` FILE_ATTRIBUTE_READ_ONLY flag based on what `src` attribute is set to.
+
+    If `follow_symlinks` is `False` and `src` and `dst` both refer to symbolic links, the attributes will be read and written
+    on the symbolic links themselves (rather than the files the symbolic links refer to).
+    """
     src, src_native = _standardize(src)
     dst, dst_native = _standardize(dst)
 
     if src_native and dst_native:
-        return shutil.copytree(src, dst, follow_symlinks=follow_symlinks)
+        return shutil.copymode(src, dst, follow_symlinks=follow_symlinks)
 
     if not smbclient_shutil:
         raise ModuleNotFoundError(f'missing package `smbprotocol`')
     return smbclient_shutil.copymode(src, dst, follow_symlinks=follow_symlinks)
 
 
-def copytree(src: str, dst: str, symlinks=False, ignore=None, ignore_dangling_symlinks=False, dirs_exist_ok=False):
+def copytree(src: str, dst: str, symlinks: bool = False, ignore: Callable[[str, list[str]],list[str]] = None, ignore_dangling_symlinks: bool = False, dirs_exist_ok: bool = False):
+    """
+    Recursively copy a directory tree rooted at `src` to a directory named `dst` and return the destination directory.
+
+    Permissions and times of directories are copied with `copystat()`, individual files are copied using `copy2()`.
+
+    If `symlinks` is true, symbolic links in the source tree result in symbolic links in the destination tree;
+    if it is false, the contents of the files pointed to by symbolic links are copied. If the file pointed by the symlink doesn't
+    exist, an exception will be added. You can set `ignore_dangling_symlinks` to true if you want to silence this exception.
+    Notice that this has no effect on platforms that don't support `os.symlink`.
+
+    If `dirs_exist_ok` is false (the default) and `dst` already exists, an error is raised. If `dirs_exist_ok` is true, the copying
+    operation will continue if it encounters existing directories, and files within the `dst` tree will be overwritten by corresponding files from the
+    `src` tree.
+
+    If `ignore` is given, it must be a callable of the form `ignore(src, names) -> ignored_names`.
+    It will be called recursively and will receive as its arguments the directory being visited (`src`) and a list of its content (`names`).
+    It must return a subset of the items of `names` that must be ignored in the copy process.
+    """
     src, src_native = _standardize(src)
     dst, dst_native = _standardize(dst)
 
     if src_native and dst_native:
         return shutil.copytree(src, dst, symlinks=symlinks, ignore=ignore, ignore_dangling_symlinks=ignore_dangling_symlinks, dirs_exist_ok=dirs_exist_ok)
 
     if not smbclient_shutil:
         raise ModuleNotFoundError(f'missing package `smbprotocol`')
     return smbclient_shutil.copytree(src, dst, symlinks=symlinks, ignore=ignore, ignore_dangling_symlinks=ignore_dangling_symlinks, dirs_exist_ok=dirs_exist_ok)
 
 
-def archivate(path: str|Path, archives_dir: str|Path = None) -> str:
+def archivate(path: str|Path, archives_dir: str|Path = None, missing_ok: bool = False) -> str:
     if isinstance(path, Path):
         path = str(path)
+
+
+    if missing_ok:
+        if not path or not exists(path):
+            return
+
     if isinstance(archives_dir, Path):
         archives_dir = str(archives_dir)
     
     if not exists(path):
         return ValueError(f'path does not exist: {path}')
     
     if archives_dir and not exists(archives_dir):
@@ -280,15 +355,15 @@
 
     bname = basename(path)
     stem, ext = splitext(bname)
     mainpart = (archives_dir if archives_dir else dirname(path)) + '/' + stem + f"_{mtime.strftime('%Y%m%d')}"
     
     i = 1
     while True:
-        archive = mainpart + (f"-{str(i).zfill(3)}" if i > 1 else '') + ext
+        archive = mainpart + (f"-{i}" if i > 1 else '') + ext
         if not exists(archive):
             break
         i += 1
 
-    logger.info(f"archive {path} to {archive}")
+    logger.info(f"archivate {path} to {archive}")
     copy2(path, archive)
     return archive
```

## zut/lang.py

```diff
@@ -1,26 +1,13 @@
 from __future__ import annotations
 import sys
 from pathlib import Path
 
-
-# Export root directory of the library
 ZUT_ROOT = Path(__file__).parent
-
-
-# Export typings from adequate library
-if sys.version_info[0:2] < (3, 8):
-    from typing_extensions import Literal, Protocol
-else:
-    from typing import Literal, Protocol
-    
-if sys.version_info[0:2] < (3, 11):
-    from typing_extensions import Self
-else:
-    from typing import Self
+""" Root directory of `zut` library """
 
 
 def is_list_or_tuple_of(instance, element_type: type|tuple[type]):
     if not isinstance(instance, (list,tuple)):
         return False
 
     for element in instance:
```

## zut/numeric.py

```diff
@@ -1,19 +1,28 @@
 from __future__ import annotations
 from decimal import Decimal, InvalidOperation
 from locale import getlocale
-from .lang import Literal
 from .text import ValueString
 
 
-def human_bytes(value: int, *, unit: str = 'iB', divider: int = 1024, decimals: int = 2, decimal_separator: str = None, thousands_separator: str = None, max_multiple: Literal['K']|Literal['M']|Literal['G']|Literal['T'] = None):
+def human_bytes(value: int, *, unit: str = 'iB', divider: int = 1024, decimals: int = 2, decimal_separator: str = None, thousands_separator: str = None, max_multiple: str = None):
+    """
+    Get a human-readable representation of a number of bytes.
+
+    `max_multiple` may be `K`, `M`, `G'` or `T'. 
+    """
     return human_number(value, unit=unit, divider=divider, decimals=decimals, decimal_separator=decimal_separator, thousands_separator=thousands_separator, max_multiple=max_multiple)
 
 
-def human_number(value: int, *, unit: str = '', divider: int = 1000, decimals: int = 2, decimal_separator: str = None, thousands_separator: str = None, max_multiple: Literal['K']|Literal['M']|Literal['G']|Literal['T'] = None):
+def human_number(value: int, *, unit: str = '', divider: int = 1000, decimals: int = 2, decimal_separator: str = None, thousands_separator: str = None, max_multiple: str = None):
+    """
+    Get a human-readable representation of a number.
+
+    `max_multiple` may be `K`, `M`, `G'` or `T'. 
+    """
     if value is None:
         return ValueString('', None)
 
     suffixes = []
 
     # Append non-multiple suffix (bytes)
     # (if unit is 'iB' we dont display the 'i' as it makes more sens to display "123 B" than "123 iB")
```

## zut/db/commons.py

```diff
@@ -7,934 +7,930 @@
 00000060: 7274 206c 6f67 6769 6e67 0d0a 6672 6f6d  rt logging..from
 00000070: 2070 6174 686c 6962 2069 6d70 6f72 7420   pathlib import 
 00000080: 5061 7468 0d0a 696d 706f 7274 2072 650d  Path..import re.
 00000090: 0a66 726f 6d20 7479 7069 6e67 2069 6d70  .from typing imp
 000000a0: 6f72 7420 416e 792c 2047 656e 6572 6963  ort Any, Generic
 000000b0: 2c20 5479 7065 5661 720d 0a66 726f 6d20  , TypeVar..from 
 000000c0: 7572 6c6c 6962 2e70 6172 7365 2069 6d70  urllib.parse imp
-000000d0: 6f72 7420 7175 6f74 650d 0a66 726f 6d20  ort quote..from 
-000000e0: 2e2e 6c61 6e67 2069 6d70 6f72 7420 4c69  ..lang import Li
-000000f0: 7465 7261 6c0d 0a0d 0a6c 6f67 6765 7220  teral....logger 
-00000100: 3d20 6c6f 6767 696e 672e 6765 744c 6f67  = logging.getLog
-00000110: 6765 7228 5f5f 6e61 6d65 5f5f 290d 0a0d  ger(__name__)...
-00000120: 0a54 5f43 6f6e 6e65 6374 696f 6e20 3d20  .T_Connection = 
-00000130: 5479 7065 5661 7228 2754 5f43 6f6e 6e65  TypeVar('T_Conne
-00000140: 6374 696f 6e27 290d 0a54 5f43 7572 736f  ction')..T_Curso
-00000150: 7220 3d20 5479 7065 5661 7228 2754 5f43  r = TypeVar('T_C
-00000160: 7572 736f 7227 290d 0a0d 0a63 6c61 7373  ursor')....class
-00000170: 2044 6257 7261 7070 6572 2847 656e 6572   DbWrapper(Gener
-00000180: 6963 5b54 5f43 6f6e 6e65 6374 696f 6e2c  ic[T_Connection,
-00000190: 2054 5f43 7572 736f 725d 293a 0d0a 2020   T_Cursor]):..  
-000001a0: 2020 4063 6c61 7373 6d65 7468 6f64 0d0a    @classmethod..
-000001b0: 2020 2020 6465 6620 6973 5f61 7661 696c      def is_avail
-000001c0: 6162 6c65 2863 6c73 293a 0d0a 2020 2020  able(cls):..    
-000001d0: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-000001e0: 6c65 6d65 6e74 6564 4572 726f 7228 290d  lementedError().
-000001f0: 0a20 2020 200d 0a20 2020 2073 6368 656d  .    ..    schem
-00000200: 653a 2073 7472 0d0a 2020 2020 6465 6661  e: str..    defa
-00000210: 756c 745f 7363 6865 6d61 5f6e 616d 653a  ult_schema_name:
-00000220: 2073 7472 0d0a 2020 2020 636f 6d70 6174   str..    compat
-00000230: 6962 6c65 5f64 6a61 6e67 6f5f 656e 6769  ible_django_engi
-00000240: 6e65 733a 206c 6973 745b 7374 725d 0d0a  nes: list[str]..
-00000250: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00000260: 5f5f 2873 656c 662c 202a 2c20 6e61 6d65  __(self, *, name
-00000270: 3a20 7374 7220 3d20 4e6f 6e65 2c20 686f  : str = None, ho
-00000280: 7374 3a20 7374 7220 3d20 4e6f 6e65 2c20  st: str = None, 
-00000290: 706f 7274 3a20 696e 7420 3d20 4e6f 6e65  port: int = None
-000002a0: 2c20 7573 6572 3a20 7374 7220 3d20 4e6f  , user: str = No
-000002b0: 6e65 2c20 7061 7373 776f 7264 3a20 7374  ne, password: st
-000002c0: 7220 3d20 4e6f 6e65 2c20 646a 616e 676f  r = None, django
-000002d0: 5f61 6c69 6173 3a20 7374 7220 3d20 4e6f  _alias: str = No
-000002e0: 6e65 2c20 636f 6e6e 6563 7469 6f6e 3a20  ne, connection: 
-000002f0: 545f 436f 6e6e 6563 7469 6f6e 203d 204e  T_Connection = N
-00000300: 6f6e 652c 206e 6169 7665 5f74 7a3a 204c  one, naive_tz: L
-00000310: 6974 6572 616c 5b27 6c6f 6361 6c27 5d7c  iteral['local']|
-00000320: 7469 6d65 7a6f 6e65 203d 2027 6c6f 6361  timezone = 'loca
-00000330: 6c27 293a 2020 2020 0d0a 2020 2020 2020  l'):    ..      
-00000340: 2020 6966 206e 6f74 2073 656c 662e 6973    if not self.is
-00000350: 5f61 7661 696c 6162 6c65 2829 3a0d 0a20  _available():.. 
-00000360: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00000370: 2056 616c 7565 4572 726f 7228 6622 6361   ValueError(f"ca
-00000380: 6e6e 6f74 2075 7365 207b 7479 7065 2873  nnot use {type(s
-00000390: 656c 6629 2e5f 5f6e 616d 655f 5f7d 2028  elf).__name__} (
-000003a0: 6e6f 7420 6176 6169 6c61 626c 6529 2229  not available)")
-000003b0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-000003c0: 2020 2020 6966 2064 6a61 6e67 6f5f 616c      if django_al
-000003d0: 6961 7320 6973 206e 6f74 204e 6f6e 653a  ias is not None:
-000003e0: 0d0a 2020 2020 2020 2020 2020 2020 6672  ..            fr
-000003f0: 6f6d 2064 6a61 6e67 6f2e 636f 6e66 2069  om django.conf i
-00000400: 6d70 6f72 7420 7365 7474 696e 6773 0d0a  mport settings..
-00000410: 2020 2020 2020 2020 2020 2020 4441 5441              DATA
-00000420: 4241 5345 5320 3d20 7365 7474 696e 6773  BASES = settings
-00000430: 2e44 4154 4142 4153 4553 0d0a 2020 2020  .DATABASES..    
-00000440: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-00000450: 6a61 6e67 6f5f 616c 6961 7320 696e 2044  jango_alias in D
-00000460: 4154 4142 4153 4553 3a0d 0a20 2020 2020  ATABASES:..     
-00000470: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00000480: 2056 616c 7565 4572 726f 7228 6622 6b65   ValueError(f"ke
-00000490: 7920 5c22 7b64 6a61 6e67 6f5f 616c 6961  y \"{django_alia
-000004a0: 737d 5c22 206e 6f74 2066 6f75 6e64 2069  s}\" not found i
-000004b0: 6e20 646a 616e 676f 2044 4154 4142 4153  n django DATABAS
-000004c0: 4553 2073 6574 7469 6e67 7322 290d 0a20  ES settings").. 
-000004d0: 2020 2020 2020 2020 2020 2064 6174 6162             datab
-000004e0: 6173 655f 7365 7474 696e 6773 3a20 6469  ase_settings: di
-000004f0: 6374 5b73 7472 2c41 6e79 5d20 3d20 4441  ct[str,Any] = DA
-00000500: 5441 4241 5345 535b 646a 616e 676f 5f61  TABASES[django_a
-00000510: 6c69 6173 5d0d 0a20 2020 2020 2020 2020  lias]..         
-00000520: 2020 2065 6e67 696e 6520 3d20 6461 7461     engine = data
-00000530: 6261 7365 5f73 6574 7469 6e67 735b 2745  base_settings['E
-00000540: 4e47 494e 4527 5d0d 0a20 2020 2020 2020  NGINE']..       
-00000550: 2020 2020 2069 6620 6e6f 7420 656e 6769       if not engi
-00000560: 6e65 2069 6e20 7365 6c66 2e63 6f6d 7061  ne in self.compa
-00000570: 7469 626c 655f 646a 616e 676f 5f65 6e67  tible_django_eng
-00000580: 696e 6573 3a0d 0a20 2020 2020 2020 2020  ines:..         
-00000590: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000005a0: 7565 4572 726f 7228 6622 646a 616e 676f  ueError(f"django
-000005b0: 2064 6174 6162 6173 6520 656e 6769 6e65   database engine
-000005c0: 205c 227b 656e 6769 6e65 7d5c 2220 6973   \"{engine}\" is
-000005d0: 206e 6f74 2063 6f6d 7061 7469 626c 6520   not compatible 
-000005e0: 7769 7468 207b 7479 7065 2873 656c 6629  with {type(self)
-000005f0: 2e5f 5f6e 616d 655f 5f7d 2229 0d0a 2020  .__name__}")..  
-00000600: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00000610: 2020 2020 2020 2020 2064 6174 6162 6173           databas
-00000620: 655f 7365 7474 696e 6773 3a20 6469 6374  e_settings: dict
-00000630: 5b73 7472 2c41 6e79 5d20 3d20 7b7d 0d0a  [str,Any] = {}..
-00000640: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00000650: 6e61 6d65 3a20 7374 7220 3d20 6e61 6d65  name: str = name
-00000660: 2069 6620 6e61 6d65 2069 7320 6e6f 7420   if name is not 
-00000670: 4e6f 6e65 2065 6c73 6520 6461 7461 6261  None else databa
-00000680: 7365 5f73 6574 7469 6e67 732e 6765 7428  se_settings.get(
-00000690: 274e 414d 4527 2c20 4e6f 6e65 290d 0a20  'NAME', None).. 
-000006a0: 2020 2020 2020 2073 656c 662e 5f68 6f73         self._hos
-000006b0: 743a 2073 7472 203d 2068 6f73 7420 6966  t: str = host if
-000006c0: 2068 6f73 7420 6973 206e 6f74 204e 6f6e   host is not Non
-000006d0: 6520 656c 7365 2064 6174 6162 6173 655f  e else database_
-000006e0: 7365 7474 696e 6773 2e67 6574 2827 484f  settings.get('HO
-000006f0: 5354 272c 204e 6f6e 6529 0d0a 2020 2020  ST', None)..    
-00000700: 2020 2020 7365 6c66 2e5f 7573 6572 3a20      self._user: 
-00000710: 7374 7220 3d20 7573 6572 2069 6620 7573  str = user if us
-00000720: 6572 2069 7320 6e6f 7420 4e6f 6e65 2065  er is not None e
-00000730: 6c73 6520 6461 7461 6261 7365 5f73 6574  lse database_set
-00000740: 7469 6e67 732e 6765 7428 2755 5345 5227  tings.get('USER'
-00000750: 2c20 4e6f 6e65 290d 0a20 2020 2020 2020  , None)..       
-00000760: 2073 656c 662e 5f70 6173 7377 6f72 643a   self._password:
-00000770: 2073 7472 203d 2070 6173 7377 6f72 6420   str = password 
-00000780: 6966 2070 6173 7377 6f72 6420 6973 206e  if password is n
-00000790: 6f74 204e 6f6e 6520 656c 7365 2064 6174  ot None else dat
-000007a0: 6162 6173 655f 7365 7474 696e 6773 2e67  abase_settings.g
-000007b0: 6574 2827 5041 5353 574f 5244 272c 204e  et('PASSWORD', N
-000007c0: 6f6e 6529 0d0a 2020 2020 2020 2020 7365  one)..        se
-000007d0: 6c66 2e5f 706f 7274 3a20 7374 7220 3d20  lf._port: str = 
-000007e0: 706f 7274 2069 6620 706f 7274 2069 7320  port if port is 
-000007f0: 6e6f 7420 4e6f 6e65 2065 6c73 6520 6461  not None else da
-00000800: 7461 6261 7365 5f73 6574 7469 6e67 732e  tabase_settings.
-00000810: 6765 7428 2750 4f52 5427 2c20 4e6f 6e65  get('PORT', None
-00000820: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-00000830: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-00000840: 5f70 6f72 742c 2073 7472 293a 0d0a 2020  _port, str):..  
-00000850: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00000860: 706f 7274 203d 2069 6e74 2873 656c 662e  port = int(self.
-00000870: 5f70 6f72 7429 0d0a 2020 2020 2020 2020  _port)..        
-00000880: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00000890: 6e61 6976 655f 747a 203d 206e 6169 7665  naive_tz = naive
-000008a0: 5f74 7a0d 0a20 2020 2020 2020 2022 2222  _tz..        """
-000008b0: 2049 6620 6e6f 7420 4e6f 6e65 2c20 696e   If not None, in
-000008c0: 6469 6361 7465 2077 6869 6368 2074 696d  dicate which tim
-000008d0: 657a 6f6e 6520 7769 6c6c 2062 6520 7573  ezone will be us
-000008e0: 6564 2066 6f72 206e 6169 7665 2064 6174  ed for naive dat
-000008f0: 6574 696d 6573 2e20 2222 220d 0a0d 0a20  etimes. """.... 
-00000900: 2020 2020 2020 2073 656c 662e 5f63 6f6e         self._con
-00000910: 6e65 6374 696f 6e20 3d20 636f 6e6e 6563  nection = connec
-00000920: 7469 6f6e 0d0a 2020 2020 2020 2020 7365  tion..        se
-00000930: 6c66 2e5f 6d75 7374 5f63 6c6f 7365 5f63  lf._must_close_c
-00000940: 6f6e 6e65 6374 696f 6e20 3d20 636f 6e6e  onnection = conn
-00000950: 6563 7469 6f6e 2069 7320 4e6f 6e65 0d0a  ection is None..
-00000960: 0d0a 0d0a 2020 2020 6465 6620 5f5f 656e  ....    def __en
-00000970: 7465 725f 5f28 7365 6c66 293a 0d0a 2020  ter__(self):..  
-00000980: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00000990: 660d 0a0d 0a0d 0a20 2020 2064 6566 205f  f......    def _
-000009a0: 5f65 7869 745f 5f28 7365 6c66 2c20 6578  _exit__(self, ex
-000009b0: 635f 7479 7065 203d 204e 6f6e 652c 2065  c_type = None, e
-000009c0: 7863 5f76 616c 203d 204e 6f6e 652c 2065  xc_val = None, e
-000009d0: 7863 5f74 6220 3d20 4e6f 6e65 293a 0d0a  xc_tb = None):..
-000009e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000009f0: 5f63 6f6e 6e65 6374 696f 6e20 616e 6420  _connection and 
-00000a00: 7365 6c66 2e5f 6d75 7374 5f63 6c6f 7365  self._must_close
-00000a10: 5f63 6f6e 6e65 6374 696f 6e3a 0d0a 2020  _connection:..  
-00000a20: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00000a30: 636f 6e6e 6563 7469 6f6e 2e63 6c6f 7365  connection.close
-00000a40: 2829 0d0a 0d0a 0d0a 2020 2020 6465 6620  ()......    def 
-00000a50: 6765 745f 7572 6928 7365 6c66 2c20 7461  get_uri(self, ta
-00000a60: 626c 653a 2073 7472 7c74 7570 6c65 2c20  ble: str|tuple, 
-00000a70: 2a2c 2077 6974 685f 7061 7373 776f 7264  *, with_password
-00000a80: 203d 2046 616c 7365 293a 0d0a 2020 2020   = False):..    
-00000a90: 2020 2020 7572 6920 3d20 6622 7b73 656c      uri = f"{sel
-00000aa0: 662e 7363 6865 6d65 7d3a 220d 0a0d 0a20  f.scheme}:".... 
-00000ab0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00000ac0: 7573 6572 206f 7220 7365 6c66 2e5f 686f  user or self._ho
-00000ad0: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
-00000ae0: 2075 7269 202b 3d20 272f 2f27 0d0a 2020   uri += '//'..  
-00000af0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00000b00: 662e 5f75 7365 723a 0d0a 2020 2020 2020  f._user:..      
-00000b10: 2020 2020 2020 2020 2020 7572 6920 2b3d            uri +=
-00000b20: 2071 756f 7465 2873 656c 662e 5f75 7365   quote(self._use
-00000b30: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
-00000b40: 2020 2020 6966 2073 656c 662e 5f70 6173      if self._pas
-00000b50: 7377 6f72 643a 0d0a 2020 2020 2020 2020  sword:..        
-00000b60: 2020 2020 2020 2020 2020 2020 7572 6920              uri 
-00000b70: 2b3d 2027 3a27 202b 2028 7175 6f74 6528  += ':' + (quote(
-00000b80: 7365 6c66 2e5f 7061 7373 776f 7264 2920  self._password) 
-00000b90: 6966 2077 6974 685f 7061 7373 776f 7264  if with_password
-00000ba0: 2065 6c73 6520 7265 2e73 7562 2872 272e   else re.sub(r'.
-00000bb0: 272c 2027 2a27 2c20 7365 6c66 2e5f 7061  ', '*', self._pa
-00000bc0: 7373 776f 7264 2929 0d0a 2020 2020 2020  ssword))..      
-00000bd0: 2020 2020 2020 2020 2020 7572 6920 2b3d            uri +=
-00000be0: 2027 4027 0d0a 0d0a 2020 2020 2020 2020   '@'....        
-00000bf0: 2020 2020 6966 2073 656c 662e 5f68 6f73      if self._hos
-00000c00: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00000c10: 2020 2020 7572 6920 2b3d 2071 756f 7465      uri += quote
-00000c20: 2873 656c 662e 5f68 6f73 7429 0d0a 2020  (self._host)..  
-00000c30: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00000c40: 2073 656c 662e 5f70 6f72 743a 0d0a 2020   self._port:..  
-00000c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000c60: 2020 7572 6920 2b3d 2066 273a 7b73 656c    uri += f':{sel
-00000c70: 662e 5f70 6f72 747d 270d 0a0d 0a20 2020  f._port}'....   
-00000c80: 2020 2020 2069 6620 7365 6c66 2e5f 6e61       if self._na
-00000c90: 6d65 3a0d 0a20 2020 2020 2020 2020 2020  me:..           
-00000ca0: 2075 7269 202b 3d20 6622 2f7b 7175 6f74   uri += f"/{quot
-00000cb0: 6528 7365 6c66 2e5f 6e61 6d65 297d 220d  e(self._name)}".
-00000cc0: 0a0d 0a20 2020 2020 2020 2073 6368 656d  ...        schem
-00000cd0: 612c 2074 6162 6c65 203d 2073 656c 662e  a, table = self.
-00000ce0: 7370 6c69 745f 6e61 6d65 2874 6162 6c65  split_name(table
-00000cf0: 290d 0a20 2020 2020 2020 2069 6620 7461  )..        if ta
-00000d00: 626c 653a 0d0a 2020 2020 2020 2020 2020  ble:..          
-00000d10: 2020 7572 6920 2b3d 2066 222f 220d 0a20    uri += f"/".. 
-00000d20: 2020 2020 2020 2020 2020 2069 6620 7363             if sc
-00000d30: 6865 6d61 3a0d 0a20 2020 2020 2020 2020  hema:..         
-00000d40: 2020 2020 2020 2075 7269 202b 3d20 7175         uri += qu
-00000d50: 6f74 6528 7363 6865 6d61 290d 0a20 2020  ote(schema)..   
-00000d60: 2020 2020 2020 2020 2020 2020 2075 7269               uri
-00000d70: 202b 3d20 272e 270d 0a20 2020 2020 2020   += '.'..       
-00000d80: 2020 2020 2075 7269 202b 3d20 7175 6f74       uri += quot
-00000d90: 6528 7461 626c 6529 0d0a 0d0a 2020 2020  e(table)....    
-00000da0: 2020 2020 7265 7475 726e 2075 7269 0d0a      return uri..
-00000db0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00000dc0: 790d 0a20 2020 2064 6566 2063 6f6e 6e65  y..    def conne
-00000dd0: 6374 696f 6e28 7365 6c66 293a 0d0a 2020  ction(self):..  
-00000de0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00000df0: 662e 5f63 6f6e 6e65 6374 696f 6e3a 0d0a  f._connection:..
-00000e00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00000e10: 2e5f 636f 6e6e 6563 7469 6f6e 203d 2073  ._connection = s
-00000e20: 656c 662e 5f63 7265 6174 655f 636f 6e6e  elf._create_conn
-00000e30: 6563 7469 6f6e 2829 0d0a 2020 2020 2020  ection()..      
-00000e40: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
-00000e50: 6f6e 6e65 6374 696f 6e0d 0a0d 0a0d 0a20  onnection...... 
-00000e60: 2020 2064 6566 205f 6372 6561 7465 5f63     def _create_c
-00000e70: 6f6e 6e65 6374 696f 6e28 7365 6c66 2920  onnection(self) 
-00000e80: 2d3e 2054 5f43 6f6e 6e65 6374 696f 6e3a  -> T_Connection:
-00000e90: 0d0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
-00000ea0: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
-00000eb0: 726f 7228 290d 0a0d 0a0d 0a20 2020 2064  ror()......    d
-00000ec0: 6566 2063 7572 736f 7228 7365 6c66 2920  ef cursor(self) 
-00000ed0: 2d3e 2054 5f43 7572 736f 723a 0d0a 2020  -> T_Cursor:..  
-00000ee0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00000ef0: 662e 636f 6e6e 6563 7469 6f6e 2e63 7572  f.connection.cur
-00000f00: 736f 7228 290d 0a20 2020 200d 0a20 2020  sor()..    ..   
-00000f10: 200d 0a20 2020 2064 6566 206c 696d 6974   ..    def limit
-00000f20: 5f71 7565 7279 2873 656c 662c 2071 7565  _query(self, que
-00000f30: 7279 3a20 7374 722c 206c 696d 6974 3a20  ry: str, limit: 
-00000f40: 696e 7429 3a0d 0a20 2020 2020 2020 2069  int):..        i
-00000f50: 6620 6c69 6d69 7420 6973 204e 6f6e 653a  f limit is None:
-00000f60: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00000f70: 7475 726e 2071 7565 7279 0d0a 2020 2020  turn query..    
-00000f80: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00000f90: 2069 7369 6e73 7461 6e63 6528 6c69 6d69   isinstance(limi
-00000fa0: 742c 2069 6e74 293a 0d0a 2020 2020 2020  t, int):..      
-00000fb0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00000fc0: 6545 7272 6f72 2866 2269 6e76 616c 6964  eError(f"invalid
-00000fd0: 2074 7970 6520 666f 7220 6c69 6d69 743a   type for limit:
-00000fe0: 207b 7479 7065 286c 696d 6974 292e 5f5f   {type(limit).__
-00000ff0: 6e61 6d65 5f5f 7d20 2865 7870 6563 7465  name__} (expecte
-00001000: 6420 696e 7429 2229 0d0a 2020 2020 2020  d int)")..      
-00001010: 2020 0d0a 2020 2020 2020 2020 696d 706f    ..        impo
-00001020: 7274 2073 716c 7061 7273 6520 2320 6e6f  rt sqlparse # no
-00001030: 7420 6174 2074 6865 2074 6f70 2062 6563  t at the top bec
-00001040: 6175 7365 2074 6865 2065 6e64 7573 6572  ause the enduser
-00001050: 206d 6967 6874 206e 6f74 206e 6565 6420   might not need 
-00001060: 7468 6973 2066 6561 7475 7265 0d0a 0d0a  this feature....
-00001070: 2020 2020 2020 2020 2320 5061 7273 6520          # Parse 
-00001080: 5351 4c20 746f 2072 656d 6f76 6520 746f  SQL to remove to
-00001090: 6b65 6e20 6265 666f 7265 2074 6865 2053  ken before the S
-000010a0: 454c 4543 5420 6b65 7977 6f72 640d 0a20  ELECT keyword.. 
-000010b0: 2020 2020 2020 2023 2065 7861 6d70 6c65         # example
-000010c0: 3a20 5749 5448 2028 4354 4529 2074 6f6b  : WITH (CTE) tok
-000010d0: 656e 730d 0a20 2020 2020 2020 2073 7461  ens..        sta
-000010e0: 7465 6d65 6e74 7320 3d20 7371 6c70 6172  tements = sqlpar
-000010f0: 7365 2e70 6172 7365 2871 7565 7279 290d  se.parse(query).
-00001100: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00001110: 7374 6174 656d 656e 7473 2920 213d 2031  statements) != 1
-00001120: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00001130: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00001140: 6622 7175 6572 7920 636f 6e74 6169 6e73  f"query contains
-00001150: 207b 6c65 6e28 7374 6174 656d 656e 7473   {len(statements
-00001160: 297d 2073 7461 7465 6d65 6e74 7322 290d  )} statements").
-00001170: 0a0d 0a20 2020 2020 2020 2023 2047 6574  ...        # Get
-00001180: 2066 6972 7374 2044 4d4c 206b 6579 776f   first DML keywo
-00001190: 7264 0d0a 2020 2020 2020 2020 646d 6c5f  rd..        dml_
-000011a0: 6b65 7977 6f72 6420 3d20 4e6f 6e65 0d0a  keyword = None..
-000011b0: 2020 2020 2020 2020 646d 6c5f 6b65 7977          dml_keyw
-000011c0: 6f72 645f 696e 6465 7820 3d20 4e6f 6e65  ord_index = None
-000011d0: 0d0a 2020 2020 2020 2020 6f72 6465 725f  ..        order_
-000011e0: 6279 5f69 6e64 6578 203d 204e 6f6e 650d  by_index = None.
-000011f0: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
-00001200: 746f 6b65 6e20 696e 2065 6e75 6d65 7261  token in enumera
-00001210: 7465 2873 7461 7465 6d65 6e74 735b 305d  te(statements[0]
-00001220: 2e74 6f6b 656e 7329 3a0d 0a20 2020 2020  .tokens):..     
-00001230: 2020 2020 2020 2069 6620 746f 6b65 6e2e         if token.
-00001240: 7474 7970 6520 3d3d 2073 716c 7061 7273  ttype == sqlpars
-00001250: 652e 746f 6b65 6e73 2e44 4d4c 3a0d 0a20  e.tokens.DML:.. 
-00001260: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00001270: 6620 646d 6c5f 6b65 7977 6f72 6420 6973  f dml_keyword is
-00001280: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00001290: 2020 2020 2020 2020 2020 2020 646d 6c5f              dml_
-000012a0: 6b65 7977 6f72 6420 3d20 7374 7228 746f  keyword = str(to
-000012b0: 6b65 6e29 2e75 7070 6572 2829 0d0a 2020  ken).upper()..  
-000012c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012d0: 2020 646d 6c5f 6b65 7977 6f72 645f 696e    dml_keyword_in
-000012e0: 6465 7820 3d20 690d 0a20 2020 2020 2020  dex = i..       
-000012f0: 2020 2020 2065 6c69 6620 746f 6b65 6e2e       elif token.
-00001300: 7474 7970 6520 3d3d 2073 716c 7061 7273  ttype == sqlpars
-00001310: 652e 746f 6b65 6e73 2e4b 6579 776f 7264  e.tokens.Keyword
-00001320: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00001330: 2020 2069 6620 6f72 6465 725f 6279 5f69     if order_by_i
-00001340: 6e64 6578 2069 7320 4e6f 6e65 3a0d 0a20  ndex is None:.. 
-00001350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001360: 2020 206b 6579 776f 7264 203d 2073 7472     keyword = str
-00001370: 2874 6f6b 656e 292e 7570 7065 7228 290d  (token).upper().
-00001380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001390: 2020 2020 2069 6620 6b65 7977 6f72 6420       if keyword 
-000013a0: 3d3d 2022 4f52 4445 5220 4259 223a 0d0a  == "ORDER BY":..
-000013b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000013c0: 2020 2020 2020 2020 6f72 6465 725f 6279          order_by
-000013d0: 5f69 6e64 6578 203d 2069 0d0a 0d0a 2020  _index = i....  
-000013e0: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-000013f0: 2074 6865 2044 4d4c 206b 6579 776f 7264   the DML keyword
-00001400: 2069 7320 5345 4c45 4354 0d0a 2020 2020   is SELECT..    
-00001410: 2020 2020 6966 206e 6f74 2064 6d6c 5f6b      if not dml_k
-00001420: 6579 776f 7264 3a0d 0a20 2020 2020 2020  eyword:..       
-00001430: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00001440: 4572 726f 7228 6622 6e6f 2053 454c 4543  Error(f"no SELEC
-00001450: 5420 666f 756e 6420 2871 7565 7279 2064  T found (query d
-00001460: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
-00001470: 444d 4c20 6b65 7977 6f72 6429 2229 0d0a  DML keyword)")..
-00001480: 2020 2020 2020 2020 6966 2064 6d6c 5f6b          if dml_k
-00001490: 6579 776f 7264 2021 3d20 2753 454c 4543  eyword != 'SELEC
-000014a0: 5427 3a0d 0a20 2020 2020 2020 2020 2020  T':..           
-000014b0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000014c0: 7228 6622 6669 7273 7420 444d 4c20 6b65  r(f"first DML ke
-000014d0: 7977 6f72 6420 6973 207b 646d 6c5f 6b65  yword is {dml_ke
-000014e0: 7977 6f72 647d 2c20 6578 7065 6374 6564  yword}, expected
-000014f0: 2053 454c 4543 5422 290d 0a0d 0a20 2020   SELECT")....   
-00001500: 2020 2020 2023 2047 6574 2070 6172 7420       # Get part 
-00001510: 6265 666f 7265 2053 454c 4543 5420 2865  before SELECT (e
-00001520: 7861 6d70 6c65 3a20 5749 5448 290d 0a20  xample: WITH).. 
-00001530: 2020 2020 2020 2069 6620 646d 6c5f 6b65         if dml_ke
-00001540: 7977 6f72 645f 696e 6465 7820 3e20 303a  yword_index > 0:
-00001550: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-00001560: 6b65 6e73 203d 2073 7461 7465 6d65 6e74  kens = statement
-00001570: 735b 305d 2e74 6f6b 656e 735b 3a64 6d6c  s[0].tokens[:dml
-00001580: 5f6b 6579 776f 7264 5f69 6e64 6578 5d0d  _keyword_index].
-00001590: 0a20 2020 2020 2020 2020 2020 206c 696d  .            lim
-000015a0: 6974 6564 5f71 7565 7279 203d 2027 272e  ited_query = ''.
-000015b0: 6a6f 696e 2873 7472 2874 6f6b 656e 2920  join(str(token) 
-000015c0: 666f 7220 746f 6b65 6e20 696e 2074 6f6b  for token in tok
-000015d0: 656e 7329 0d0a 2020 2020 2020 2020 656c  ens)..        el
-000015e0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000015f0: 206c 696d 6974 6564 5f71 7565 7279 203d   limited_query =
-00001600: 2027 270d 0a20 2020 200d 0a20 2020 2020   ''..    ..     
-00001610: 2020 2023 2041 7070 656e 6420 5345 4c45     # Append SELE
-00001620: 4354 2062 6566 6f72 6520 4f52 4445 5220  CT before ORDER 
-00001630: 4259 0d0a 2020 2020 2020 2020 6966 206f  BY..        if o
-00001640: 7264 6572 5f62 795f 696e 6465 7820 6973  rder_by_index is
-00001650: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00001660: 2020 2020 2020 2020 746f 6b65 6e73 203d          tokens =
-00001670: 2073 7461 7465 6d65 6e74 735b 305d 2e74   statements[0].t
-00001680: 6f6b 656e 735b 646d 6c5f 6b65 7977 6f72  okens[dml_keywor
-00001690: 645f 696e 6465 783a 6f72 6465 725f 6279  d_index:order_by
-000016a0: 5f69 6e64 6578 5d0d 0a20 2020 2020 2020  _index]..       
-000016b0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000016c0: 2020 2020 746f 6b65 6e73 203d 2073 7461      tokens = sta
-000016d0: 7465 6d65 6e74 735b 305d 2e74 6f6b 656e  tements[0].token
-000016e0: 735b 646d 6c5f 6b65 7977 6f72 645f 696e  s[dml_keyword_in
-000016f0: 6465 783a 5d0d 0a0d 0a20 2020 2020 2020  dex:]....       
-00001700: 206c 696d 6974 6564 5f71 7565 7279 202b   limited_query +
-00001710: 3d20 7365 6c66 2e5f 6c69 6d69 745f 7061  = self._limit_pa
-00001720: 7273 6564 5f71 7565 7279 2827 272e 6a6f  rsed_query(''.jo
-00001730: 696e 2873 7472 2874 6f6b 656e 2920 666f  in(str(token) fo
-00001740: 7220 746f 6b65 6e20 696e 2074 6f6b 656e  r token in token
-00001750: 7329 2c20 6c69 6d69 743d 6c69 6d69 7429  s), limit=limit)
-00001760: 0d0a 0d0a 2020 2020 2020 2020 2320 4170  ....        # Ap
-00001770: 7065 6e64 204f 5244 4552 2042 590d 0a20  pend ORDER BY.. 
-00001780: 2020 2020 2020 2069 6620 6f72 6465 725f         if order_
-00001790: 6279 5f69 6e64 6578 2069 7320 6e6f 7420  by_index is not 
-000017a0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000017b0: 2020 2074 6f6b 656e 7320 3d20 7374 6174     tokens = stat
-000017c0: 656d 656e 7473 5b30 5d2e 746f 6b65 6e73  ements[0].tokens
-000017d0: 5b6f 7264 6572 5f62 795f 696e 6465 783a  [order_by_index:
-000017e0: 5d0d 0a20 2020 2020 2020 2020 2020 206c  ]..            l
-000017f0: 696d 6974 6564 5f71 7565 7279 202b 3d20  imited_query += 
-00001800: 275c 6e27 202b 2027 272e 6a6f 696e 2873  '\n' + ''.join(s
-00001810: 7472 2874 6f6b 656e 2920 666f 7220 746f  tr(token) for to
-00001820: 6b65 6e20 696e 2074 6f6b 656e 7329 0d0a  ken in tokens)..
-00001830: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00001840: 206c 696d 6974 6564 5f71 7565 7279 0d0a   limited_query..
-00001850: 2020 2020 0d0a 0d0a 2020 2020 6465 6620      ....    def 
-00001860: 5f6c 696d 6974 5f70 6172 7365 645f 7175  _limit_parsed_qu
-00001870: 6572 7928 7365 6c66 2c20 7175 6572 793a  ery(self, query:
-00001880: 2073 7472 2c20 6c69 6d69 743a 2069 6e74   str, limit: int
-00001890: 2920 2d3e 2073 7472 3a0d 0a20 2020 2020  ) -> str:..     
-000018a0: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-000018b0: 656d 656e 7465 6445 7272 6f72 2829 0d0a  ementedError()..
-000018c0: 0d0a 0d0a 2020 2020 6465 6620 6275 696c  ....    def buil
-000018d0: 645f 7175 6572 795f 7769 7468 5f70 6f73  d_query_with_pos
-000018e0: 6974 696f 6e61 6c5f 7061 7261 6d73 2873  itional_params(s
-000018f0: 656c 662c 2071 7565 7279 3a20 7374 722c  elf, query: str,
-00001900: 2070 6172 616d 733a 206c 6973 747c 7475   params: list|tu
-00001910: 706c 657c 6469 6374 293a 0d0a 2020 2020  ple|dict):..    
-00001920: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00001930: 6528 7061 7261 6d73 2c20 6469 6374 293a  e(params, dict):
-00001940: 0d0a 2020 2020 2020 2020 2020 2020 6672  ..            fr
-00001950: 6f6d 2073 716c 7061 7261 6d73 2069 6d70  om sqlparams imp
-00001960: 6f72 7420 5351 4c50 6172 616d 7320 2320  ort SQLParams # 
-00001970: 6e6f 7420 6174 2074 6865 2074 6f70 2062  not at the top b
-00001980: 6563 6175 7365 2074 6865 2065 6e64 7573  ecause the endus
-00001990: 6572 206d 6967 6874 206e 6f74 206e 6565  er might not nee
-000019a0: 6420 7468 6973 2066 6561 7475 7265 0d0a  d this feature..
-000019b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000019c0: 206e 6f74 2068 6173 6174 7472 2873 656c   not hasattr(sel
-000019d0: 662e 5f5f 636c 6173 735f 5f2c 2027 5f70  f.__class__, '_p
-000019e0: 6172 616d 735f 666f 726d 6174 7465 7227  arams_formatter'
-000019f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00001a00: 2020 2020 7365 6c66 2e5f 5f63 6c61 7373      self.__class
-00001a10: 5f5f 2e5f 7061 7261 6d73 5f66 6f72 6d61  __._params_forma
-00001a20: 7474 6572 203d 2053 514c 5061 7261 6d73  tter = SQLParams
-00001a30: 2827 6e61 6d65 6427 2c20 2771 6d61 726b  ('named', 'qmark
-00001a40: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-00001a50: 7175 6572 792c 2070 6172 616d 7320 3d20  query, params = 
-00001a60: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
-00001a70: 7061 7261 6d73 5f66 6f72 6d61 7474 6572  params_formatter
-00001a80: 2e66 6f72 6d61 7428 7175 6572 792c 2070  .format(query, p
-00001a90: 6172 616d 7329 0d0a 0d0a 2020 2020 2020  arams)....      
-00001aa0: 2020 7265 7475 726e 2071 7565 7279 2c20    return query, 
-00001ab0: 7061 7261 6d73 0d0a 2020 2020 2020 2020  params..        
-00001ac0: 0d0a 0d0a 2020 2020 6465 6620 6765 745f  ....    def get_
-00001ad0: 6375 7273 6f72 5f63 6f6c 756d 6e73 2873  cursor_columns(s
-00001ae0: 656c 662c 2063 7572 736f 723a 2054 5f43  elf, cursor: T_C
-00001af0: 7572 736f 7229 202d 3e20 6c69 7374 5b43  ursor) -> list[C
-00001b00: 6f6c 756d 6e5d 3a0d 0a20 2020 2020 2020  olumn]:..       
-00001b10: 2063 6f6c 756d 6e73 203d 205b 5d0d 0a0d   columns = []...
-00001b20: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
-00001b30: 696e 666f 2069 6e20 656e 756d 6572 6174  info in enumerat
-00001b40: 6528 6375 7273 6f72 2e64 6573 6372 6970  e(cursor.descrip
-00001b50: 7469 6f6e 293a 0d0a 2020 2020 2020 2020  tion):..        
-00001b60: 2020 2020 6e61 6d65 2c20 7079 7468 6f6e      name, python
-00001b70: 5f74 7970 652c 2064 6973 706c 6179 5f73  _type, display_s
-00001b80: 697a 652c 2069 6e74 6572 6e61 6c5f 7369  ize, internal_si
-00001b90: 7a65 2c20 7072 6563 6973 696f 6e2c 2073  ze, precision, s
-00001ba0: 6361 6c65 2c20 6e75 6c6c 5f6f 6b20 3d20  cale, null_ok = 
-00001bb0: 696e 666f 0d0a 2020 2020 2020 2020 2020  info..          
-00001bc0: 2020 636f 6c75 6d6e 203d 2043 6f6c 756d    column = Colum
-00001bd0: 6e28 6e61 6d65 2c20 706f 7369 7469 6f6e  n(name, position
-00001be0: 3d69 202b 2031 2c20 7079 7468 6f6e 5f74  =i + 1, python_t
-00001bf0: 7970 653d 7079 7468 6f6e 5f74 7970 652c  ype=python_type,
-00001c00: 2064 6973 706c 6179 5f73 697a 653d 6469   display_size=di
-00001c10: 7370 6c61 795f 7369 7a65 2c20 696e 7465  splay_size, inte
-00001c20: 726e 616c 5f73 697a 653d 696e 7465 726e  rnal_size=intern
-00001c30: 616c 5f73 697a 652c 2070 7265 6369 7369  al_size, precisi
-00001c40: 6f6e 3d70 7265 6369 7369 6f6e 2c20 7363  on=precision, sc
-00001c50: 616c 653d 7363 616c 652c 206e 756c 6c5f  ale=scale, null_
-00001c60: 6f6b 3d6e 756c 6c5f 6f6b 290d 0a20 2020  ok=null_ok)..   
-00001c70: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
-00001c80: 6978 5f63 7572 736f 725f 636f 6c75 6d6e  ix_cursor_column
-00001c90: 5f64 6566 696e 6974 696f 6e28 636f 6c75  _definition(colu
-00001ca0: 6d6e 290d 0a20 2020 2020 2020 2020 2020  mn)..           
-00001cb0: 2063 6f6c 756d 6e2e 5f63 6865 636b 2829   column._check()
-00001cc0: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00001cd0: 6c75 6d6e 732e 6170 7065 6e64 2863 6f6c  lumns.append(col
-00001ce0: 756d 6e29 0d0a 2020 2020 2020 2020 0d0a  umn)..        ..
-00001cf0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00001d00: 6f6c 756d 6e73 0d0a 0d0a 0d0a 2020 2020  olumns......    
-00001d10: 6465 6620 5f66 6978 5f63 7572 736f 725f  def _fix_cursor_
-00001d20: 636f 6c75 6d6e 5f64 6566 696e 6974 696f  column_definitio
-00001d30: 6e28 7365 6c66 2c20 636f 6c75 6d6e 3a20  n(self, column: 
-00001d40: 436f 6c75 6d6e 293a 0d0a 2020 2020 2020  Column):..      
-00001d50: 2020 2222 220d 0a20 2020 2020 2020 2046    """..        F
-00001d60: 6978 2061 2063 6f6c 756d 6e20 6465 6669  ix a column defi
-00001d70: 6e69 7469 6f6e 2c20 6166 7465 7220 696e  nition, after in
-00001d80: 7374 616e 6369 6174 696f 6e20 696e 2060  stanciation in `
-00001d90: 6765 745f 636f 6c75 6d6e 735f 6672 6f6d  get_columns_from
-00001da0: 5f63 7572 736f 7260 2c20 666f 7220 6120  _cursor`, for a 
-00001db0: 7370 6563 6966 6963 2064 6174 6162 6173  specific databas
-00001dc0: 6520 656e 6769 6e65 2e0d 0a20 2020 2020  e engine...     
-00001dd0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00001de0: 7061 7373 0d0a 2020 2020 2020 2020 0d0a  pass..        ..
-00001df0: 0d0a 2020 2020 6465 6620 6765 745f 6375  ..    def get_cu
-00001e00: 7273 6f72 5f63 6f6c 756d 6e5f 6e61 6d65  rsor_column_name
-00001e10: 7328 7365 6c66 2c20 6375 7273 6f72 3a20  s(self, cursor: 
-00001e20: 545f 4375 7273 6f72 2920 2d3e 206c 6973  T_Cursor) -> lis
-00001e30: 745b 7374 725d 3a0d 0a20 2020 2020 2020  t[str]:..       
-00001e40: 2072 6574 7572 6e20 5b69 6e66 6f5b 305d   return [info[0]
-00001e50: 2066 6f72 2069 6e66 6f20 696e 2063 7572   for info in cur
-00001e60: 736f 722e 6465 7363 7269 7074 696f 6e5d  sor.description]
-00001e70: 0d0a 2020 2020 2020 2020 0d0a 0d0a 2020  ..        ....  
-00001e80: 2020 6465 6620 6765 745f 7461 626c 655f    def get_table_
-00001e90: 636f 6c75 6d6e 7328 7365 6c66 2c20 7461  columns(self, ta
-00001ea0: 626c 653a 2073 7472 7c74 7570 6c65 2920  ble: str|tuple) 
-00001eb0: 2d3e 206c 6973 745b 436f 6c75 6d6e 5d3a  -> list[Column]:
-00001ec0: 0d0a 2020 2020 2020 2020 7175 6572 7920  ..        query 
-00001ed0: 3d20 7365 6c66 2e67 6574 5f73 656c 6563  = self.get_selec
-00001ee0: 745f 7461 626c 655f 7175 6572 7928 7461  t_table_query(ta
-00001ef0: 626c 652c 2073 6368 656d 615f 6f6e 6c79  ble, schema_only
-00001f00: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-00001f10: 7769 7468 2073 656c 662e 6578 6563 7574  with self.execut
-00001f20: 655f 6765 745f 6375 7273 6f72 2871 7565  e_get_cursor(que
-00001f30: 7279 2920 6173 2063 7572 736f 723a 0d0a  ry) as cursor:..
-00001f40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00001f50: 726e 2073 656c 662e 6765 745f 6375 7273  rn self.get_curs
-00001f60: 6f72 5f63 6f6c 756d 6e73 2863 7572 736f  or_columns(curso
-00001f70: 7229 0d0a 0d0a 0d0a 2020 2020 6465 6620  r)......    def 
-00001f80: 6765 745f 7461 626c 655f 636f 6c75 6d6e  get_table_column
-00001f90: 5f6e 616d 6573 2873 656c 662c 2074 6162  _names(self, tab
-00001fa0: 6c65 3a20 7374 727c 7475 706c 6529 202d  le: str|tuple) -
-00001fb0: 3e20 6c69 7374 5b73 7472 5d3a 0d0a 2020  > list[str]:..  
-00001fc0: 2020 2020 2020 636f 6c75 6d6e 5f6e 616d        column_nam
-00001fd0: 6573 203d 205b 5d0d 0a20 2020 2020 2020  es = []..       
-00001fe0: 2066 6f72 2063 6f6c 756d 6e20 696e 2073   for column in s
-00001ff0: 656c 662e 6765 745f 7461 626c 655f 636f  elf.get_table_co
-00002000: 6c75 6d6e 7328 7461 626c 6529 3a0d 0a20  lumns(table):.. 
-00002010: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00002020: 6e5f 6e61 6d65 732e 6170 7065 6e64 2863  n_names.append(c
-00002030: 6f6c 756d 6e2e 6e61 6d65 290d 0a20 2020  olumn.name)..   
-00002040: 2020 2020 2072 6574 7572 6e20 636f 6c75       return colu
-00002050: 6d6e 5f6e 616d 6573 0d0a 0d0a 0d0a 2020  mn_names......  
-00002060: 2020 4063 6c61 7373 6d65 7468 6f64 0d0a    @classmethod..
-00002070: 2020 2020 6465 6620 7370 6c69 745f 6e61      def split_na
-00002080: 6d65 2863 6c73 2c20 6675 6c6c 5f6e 616d  me(cls, full_nam
-00002090: 653a 2073 7472 7c74 7570 6c65 2920 2d3e  e: str|tuple) ->
-000020a0: 2074 7570 6c65 5b73 7472 2c73 7472 5d3a   tuple[str,str]:
-000020b0: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-000020c0: 6e73 7461 6e63 6528 6675 6c6c 5f6e 616d  nstance(full_nam
-000020d0: 652c 2074 7570 6c65 293a 0d0a 2020 2020  e, tuple):..    
-000020e0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-000020f0: 756c 6c5f 6e61 6d65 0d0a 2020 2020 2020  ull_name..      
-00002100: 2020 0d0a 2020 2020 2020 2020 7472 793a    ..        try:
-00002110: 0d0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-00002120: 7320 3d20 6675 6c6c 5f6e 616d 652e 696e  s = full_name.in
-00002130: 6465 7828 272e 2729 0d0a 2020 2020 2020  dex('.')..      
-00002140: 2020 2020 2020 7363 6865 6d61 5f6e 616d        schema_nam
-00002150: 6520 3d20 6675 6c6c 5f6e 616d 655b 303a  e = full_name[0:
-00002160: 706f 735d 0d0a 2020 2020 2020 2020 2020  pos]..          
-00002170: 2020 6e61 6d65 203d 2066 756c 6c5f 6e61    name = full_na
-00002180: 6d65 5b70 6f73 2b31 3a5d 0d0a 2020 2020  me[pos+1:]..    
-00002190: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
-000021a0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-000021b0: 2020 2020 7363 6865 6d61 5f6e 616d 6520      schema_name 
-000021c0: 3d20 636c 732e 6465 6661 756c 745f 7363  = cls.default_sc
-000021d0: 6865 6d61 5f6e 616d 650d 0a20 2020 2020  hema_name..     
-000021e0: 2020 2020 2020 206e 616d 6520 3d20 6675         name = fu
-000021f0: 6c6c 5f6e 616d 650d 0a0d 0a20 2020 2020  ll_name....     
-00002200: 2020 2072 6574 7572 6e20 2873 6368 656d     return (schem
-00002210: 615f 6e61 6d65 2c20 6e61 6d65 290d 0a20  a_name, name).. 
-00002220: 2020 200d 0a0d 0a20 2020 2064 6566 2067     ....    def g
-00002230: 6574 5f73 656c 6563 745f 7461 626c 655f  et_select_table_
-00002240: 7175 6572 7928 7365 6c66 2c20 7461 626c  query(self, tabl
-00002250: 653a 2073 7472 7c74 7570 6c65 2c20 7363  e: str|tuple, sc
-00002260: 6865 6d61 5f6f 6e6c 7920 3d20 4661 6c73  hema_only = Fals
-00002270: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
-00002280: 0d0a 2020 2020 2020 2020 4275 696c 6420  ..        Build 
-00002290: 6120 7175 6572 7920 6f6e 2074 6865 2067  a query on the g
-000022a0: 6976 656e 2074 6162 6c65 2e0d 0a0d 0a20  iven table..... 
-000022b0: 2020 2020 2020 2049 6620 6073 6368 656d         If `schem
-000022c0: 615f 6f6e 6c79 6020 6973 2067 6976 656e  a_only` is given
-000022d0: 2c20 6e6f 2072 6f77 2077 696c 6c20 6265  , no row will be
-000022e0: 2072 6574 7572 6e65 6420 2874 6869 7320   returned (this 
-000022f0: 6973 2075 7365 6420 746f 2067 6574 2069  is used to get i
-00002300: 6e66 6f72 6d61 7469 6f6e 206f 6e20 7468  nformation on th
-00002310: 6520 7461 626c 6529 2e0d 0a20 2020 2020  e table)...     
-00002320: 2020 204f 7468 6572 7769 7365 2c20 616c     Otherwise, al
-00002330: 6c20 726f 7773 2077 696c 6c20 6265 2072  l rows will be r
-00002340: 6574 7572 6e65 642e 0d0a 0d0a 2020 2020  eturned.....    
-00002350: 2020 2020 5468 6520 7265 7475 726e 2074      The return t
-00002360: 7970 6520 6f66 2074 6869 7320 6675 6e63  ype of this func
-00002370: 7469 6f6e 2064 6570 656e 6473 206f 6e20  tion depends on 
-00002380: 7468 6520 6461 7461 6261 7365 2065 6e67  the database eng
-00002390: 696e 652e 0d0a 2020 2020 2020 2020 4974  ine...        It
-000023a0: 2069 7320 7061 7373 6564 2064 6972 6563   is passed direc
-000023b0: 746c 7920 746f 2074 6865 2063 7572 736f  tly to the curso
-000023c0: 7227 7320 6578 6563 7574 6520 6675 6e63  r's execute func
-000023d0: 7469 6f6e 2066 6f72 2074 6869 7320 656e  tion for this en
-000023e0: 6769 6e65 2e0d 0a20 2020 2020 2020 2022  gine...        "
-000023f0: 2222 0d0a 2020 2020 2020 2020 7261 6973  ""..        rais
-00002400: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
-00002410: 4572 726f 7228 290d 0a20 2020 200d 0a0d  Error()..    ...
-00002420: 0a20 2020 2064 6566 2065 7865 6375 7465  .    def execute
-00002430: 5f67 6574 5f63 7572 736f 7228 7365 6c66  _get_cursor(self
-00002440: 2c20 7175 6572 793a 2073 7472 2c20 7061  , query: str, pa
-00002450: 7261 6d73 3a20 6c69 7374 7c74 7570 6c65  rams: list|tuple
-00002460: 7c64 6963 7420 3d20 4e6f 6e65 2c20 6c69  |dict = None, li
-00002470: 6d69 743a 2069 6e74 203d 204e 6f6e 6529  mit: int = None)
-00002480: 202d 3e20 545f 4375 7273 6f72 3a0d 0a20   -> T_Cursor:.. 
-00002490: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-000024a0: 2020 2020 4d75 7374 2062 6520 636c 6f73      Must be clos
-000024b0: 6564 2e0d 0a20 2020 2020 2020 2022 2222  ed...        """
-000024c0: 0d0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
-000024d0: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
-000024e0: 726f 7228 290d 0a20 2020 200d 0a0d 0a20  ror()..    .... 
-000024f0: 2020 2064 6566 2065 7865 6375 7465 5f67     def execute_g
-00002500: 6574 5f73 6361 6c61 7228 7365 6c66 2c20  et_scalar(self, 
-00002510: 7175 6572 793a 2073 7472 2c20 7061 7261  query: str, para
-00002520: 6d73 3a20 6c69 7374 7c74 7570 6c65 7c64  ms: list|tuple|d
-00002530: 6963 7420 3d20 4e6f 6e65 2c20 6c69 6d69  ict = None, limi
-00002540: 743a 2069 6e74 203d 204e 6f6e 6529 3a0d  t: int = None):.
-00002550: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00002560: 6c66 2e65 7865 6375 7465 5f67 6574 5f63  lf.execute_get_c
-00002570: 7572 736f 7228 7175 6572 792c 2070 6172  ursor(query, par
-00002580: 616d 732c 206c 696d 6974 3d6c 696d 6974  ams, limit=limit
-00002590: 2920 6173 2063 7572 736f 723a 0d0a 2020  ) as cursor:..  
-000025a0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-000025b0: 203d 206e 6578 7428 6375 7273 6f72 290d   = next(cursor).
-000025c0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-000025d0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-000025e0: 636b 206f 6e6c 7920 6f6e 6520 726f 770d  ck only one row.
-000025f0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00002600: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00002610: 2020 206e 6578 7428 6375 7273 6f72 290d     next(cursor).
-00002620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002630: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00002640: 7228 6622 7365 7665 7261 6c20 726f 7773  r(f"several rows
-00002650: 2072 6574 7572 6e65 6420 6279 2071 7565   returned by que
-00002660: 7279 2229 0d0a 2020 2020 2020 2020 2020  ry")..          
-00002670: 2020 6578 6365 7074 2053 746f 7049 7465    except StopIte
-00002680: 7261 7469 6f6e 3a0d 0a20 2020 2020 2020  ration:..       
-00002690: 2020 2020 2020 2020 2070 6173 730d 0a0d           pass...
-000026a0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-000026b0: 6865 636b 206f 6e6c 7920 6f6e 6520 7661  heck only one va
-000026c0: 6c75 650d 0a20 2020 2020 2020 2020 2020  lue..           
-000026d0: 2069 6620 6c65 6e28 7265 7375 6c74 2920   if len(result) 
-000026e0: 3e20 313a 0d0a 2020 2020 2020 2020 2020  > 1:..          
-000026f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00002700: 6545 7272 6f72 2822 7365 7665 7261 6c20  eError("several 
-00002710: 7661 6c75 6573 2072 6574 7572 6e65 6420  values returned 
-00002720: 6279 2071 7565 7279 2229 0d0a 0d0a 2020  by query")....  
-00002730: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00002740: 2072 6573 756c 745b 305d 0d0a 0d0a 0d0a   result[0]......
-00002750: 2020 2020 6465 6620 6578 6563 7574 6528      def execute(
-00002760: 7365 6c66 2c20 7175 6572 793a 2073 7472  self, query: str
-00002770: 2c20 7061 7261 6d73 3a20 6c69 7374 7c74  , params: list|t
-00002780: 7570 6c65 7c64 6963 7420 3d20 4e6f 6e65  uple|dict = None
-00002790: 2c20 6c69 6d69 743a 2069 6e74 203d 204e  , limit: int = N
-000027a0: 6f6e 6529 3a0d 0a20 2020 2020 2020 2077  one):..        w
-000027b0: 6974 6820 7365 6c66 2e65 7865 6375 7465  ith self.execute
-000027c0: 5f67 6574 5f63 7572 736f 7228 7175 6572  _get_cursor(quer
-000027d0: 792c 2070 6172 616d 732c 206c 696d 6974  y, params, limit
-000027e0: 3d6c 696d 6974 293a 0d0a 2020 2020 2020  =limit):..      
-000027f0: 2020 2020 2020 7061 7373 0d0a 0d0a 0d0a        pass......
-00002800: 2020 2020 6465 6620 6578 6563 7574 655f      def execute_
-00002810: 6669 6c65 2873 656c 662c 2070 6174 683a  file(self, path:
-00002820: 2073 7472 7c50 6174 682c 2070 6172 616d   str|Path, param
-00002830: 733a 206c 6973 747c 7475 706c 657c 6469  s: list|tuple|di
-00002840: 6374 203d 204e 6f6e 652c 206c 696d 6974  ct = None, limit
-00002850: 3a20 696e 7420 3d20 4e6f 6e65 293a 0d0a  : int = None):..
-00002860: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00002870: 7369 6e73 7461 6e63 6528 7061 7468 2c20  sinstance(path, 
-00002880: 5061 7468 293a 0d0a 2020 2020 2020 2020  Path):..        
-00002890: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
-000028a0: 7061 7468 290d 0a20 2020 2020 2020 2020  path)..         
-000028b0: 2020 200d 0a20 2020 2020 2020 2071 7565     ..        que
-000028c0: 7279 203d 2070 6174 682e 7265 6164 5f74  ry = path.read_t
-000028d0: 6578 7428 656e 636f 6469 6e67 3d27 7574  ext(encoding='ut
-000028e0: 662d 3827 290d 0a20 2020 2020 2020 2073  f-8')..        s
-000028f0: 656c 662e 6578 6563 7574 6528 7175 6572  elf.execute(quer
-00002900: 792c 2070 6172 616d 732c 206c 696d 6974  y, params, limit
-00002910: 3d6c 696d 6974 290d 0a0d 0a0d 0a20 2020  =limit)......   
-00002920: 2064 6566 2063 616c 6c5f 7072 6f63 6564   def call_proced
-00002930: 7572 6528 7365 6c66 2c20 6e61 6d65 3a20  ure(self, name: 
-00002940: 7374 727c 7475 706c 652c 202a 6172 6773  str|tuple, *args
-00002950: 293a 0d0a 2020 2020 2020 2020 7261 6973  ):..        rais
-00002960: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
-00002970: 4572 726f 7228 290d 0a0d 0a0d 0a20 2020  Error()......   
-00002980: 2064 6566 2074 6162 6c65 5f65 7869 7374   def table_exist
-00002990: 7328 7365 6c66 2c20 7461 626c 653a 2073  s(self, table: s
-000029a0: 7472 7c74 7570 6c65 2920 2d3e 2062 6f6f  tr|tuple) -> boo
-000029b0: 6c3a 0d0a 2020 2020 2020 2020 7261 6973  l:..        rais
-000029c0: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
-000029d0: 4572 726f 7228 290d 0a0d 0a0d 0a20 2020  Error()......   
-000029e0: 2064 6566 2074 7275 6e63 6174 655f 7461   def truncate_ta
-000029f0: 626c 6528 7365 6c66 2c20 7461 626c 653a  ble(self, table:
-00002a00: 2073 7472 7c74 7570 6c65 293a 0d0a 2020   str|tuple):..  
-00002a10: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
-00002a20: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
-00002a30: 290d 0a0d 0a0d 0a20 2020 2064 6566 2063  )......    def c
-00002a40: 6f70 795f 6672 6f6d 5f63 7376 2873 656c  opy_from_csv(sel
-00002a50: 662c 2066 703a 2049 4f42 6173 652c 2074  f, fp: IOBase, t
-00002a60: 6162 6c65 3a20 7374 727c 7475 706c 652c  able: str|tuple,
-00002a70: 2063 6f6c 756d 6e73 3a20 6c69 7374 5b73   columns: list[s
-00002a80: 7472 5d20 3d20 4e6f 6e65 2c20 6465 6c69  tr] = None, deli
-00002a90: 6d69 7465 723a 2073 7472 203d 204e 6f6e  miter: str = Non
-00002aa0: 652c 2071 756f 7465 6368 6172 3a20 7374  e, quotechar: st
-00002ab0: 7220 3d20 2722 272c 206e 756c 6c63 6861  r = '"', nullcha
-00002ac0: 723a 2073 7472 203d 2027 272c 206e 6f68  r: str = '', noh
-00002ad0: 6561 6465 723a 2062 6f6f 6c20 3d20 4661  eader: bool = Fa
-00002ae0: 6c73 6529 3a0d 0a20 2020 2020 2020 2072  lse):..        r
-00002af0: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-00002b00: 7465 6445 7272 6f72 2829 0d0a 2020 2020  tedError()..    
-00002b10: 0d0a 0d0a 2020 2020 6465 6620 6465 706c  ....    def depl
-00002b20: 6f79 5f73 716c 2873 656c 662c 202a 7061  oy_sql(self, *pa
-00002b30: 7468 733a 2050 6174 687c 7374 722c 2065  ths: Path|str, e
-00002b40: 6e63 6f64 696e 6720 3d20 2275 7466 2d38  ncoding = "utf-8
-00002b50: 2229 3a0d 0a20 2020 2020 2020 2061 6374  "):..        act
-00002b60: 7561 6c5f 7061 7468 733a 206c 6973 745b  ual_paths: list[
-00002b70: 5061 7468 5d20 3d20 5b5d 0d0a 2020 2020  Path] = []..    
-00002b80: 2020 2020 666f 7220 7061 7468 2069 6e20      for path in 
-00002b90: 7061 7468 733a 0d0a 2020 2020 2020 2020  paths:..        
-00002ba0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00002bb0: 6528 7061 7468 2c20 7374 7229 3a0d 0a20  e(path, str):.. 
-00002bc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00002bd0: 6174 6820 3d20 5061 7468 2870 6174 6829  ath = Path(path)
-00002be0: 0d0a 2020 2020 2020 2020 2020 2020 6163  ..            ac
-00002bf0: 7475 616c 5f70 6174 6873 2e61 7070 656e  tual_paths.appen
-00002c00: 6428 7061 7468 290d 0a0d 0a20 2020 2020  d(path)....     
-00002c10: 2020 2061 6374 7561 6c5f 7061 7468 732e     actual_paths.
-00002c20: 736f 7274 2829 0d0a 0d0a 2020 2020 2020  sort()....      
-00002c30: 2020 666f 7220 7061 7468 2069 6e20 6163    for path in ac
-00002c40: 7475 616c 5f70 6174 6873 3a0d 0a20 2020  tual_paths:..   
-00002c50: 2020 2020 2020 2020 2069 6620 7061 7468           if path
-00002c60: 2e69 735f 6469 7228 293a 0d0a 2020 2020  .is_dir():..    
-00002c70: 2020 2020 2020 2020 2020 2020 7375 6270              subp
-00002c80: 6174 6873 203d 2073 6f72 7465 6428 7061  aths = sorted(pa
-00002c90: 7468 2e69 7465 7264 6972 2829 290d 0a20  th.iterdir()).. 
-00002ca0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00002cb0: 656c 662e 6465 706c 6f79 5f73 716c 282a  elf.deploy_sql(*
-00002cc0: 7375 6270 6174 6873 2c20 656e 636f 6469  subpaths, encodi
-00002cd0: 6e67 3d65 6e63 6f64 696e 6729 0d0a 0d0a  ng=encoding)....
-00002ce0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00002cf0: 206e 6f74 2070 6174 682e 6e61 6d65 2e65   not path.name.e
-00002d00: 6e64 7377 6974 6828 222e 7371 6c22 293a  ndswith(".sql"):
-00002d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002d20: 2020 636f 6e74 696e 7565 2023 2069 676e    continue # ign
-00002d30: 6f72 650d 0a0d 0a20 2020 2020 2020 2020  ore....         
-00002d40: 2020 2065 6c69 6620 7061 7468 2e6e 616d     elif path.nam
-00002d50: 652e 656e 6473 7769 7468 2822 5f72 6576  e.endswith("_rev
-00002d60: 6572 742e 7371 6c22 293a 0d0a 2020 2020  ert.sql"):..    
-00002d70: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00002d80: 696e 7565 2023 2069 676e 6f72 650d 0a0d  inue # ignore...
-00002d90: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00002da0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00002db0: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
-00002dc0: 2265 7865 6375 7465 2025 7322 2c20 7061  "execute %s", pa
-00002dd0: 7468 290d 0a20 2020 2020 2020 2020 2020  th)..           
-00002de0: 2020 2020 2071 7565 7279 203d 2070 6174       query = pat
-00002df0: 682e 7265 6164 5f74 6578 7428 656e 636f  h.read_text(enco
-00002e00: 6469 6e67 3d65 6e63 6f64 696e 6729 0d0a  ding=encoding)..
-00002e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e20: 7365 6c66 2e65 7865 6375 7465 2871 7565  self.execute(que
-00002e30: 7279 290d 0a0d 0a0d 0a20 2020 2064 6566  ry)......    def
-00002e40: 2072 6576 6572 745f 7371 6c28 7365 6c66   revert_sql(self
-00002e50: 2c20 2a70 6174 6873 3a20 5061 7468 7c73  , *paths: Path|s
-00002e60: 7472 2c20 656e 636f 6469 6e67 203d 2022  tr, encoding = "
-00002e70: 7574 662d 3822 293a 0d0a 2020 2020 2020  utf-8"):..      
-00002e80: 2020 6163 7475 616c 5f70 6174 6873 3a20    actual_paths: 
-00002e90: 6c69 7374 5b50 6174 685d 203d 205b 5d0d  list[Path] = [].
-00002ea0: 0a20 2020 2020 2020 2066 6f72 2070 6174  .        for pat
-00002eb0: 6820 696e 2070 6174 6873 3a0d 0a20 2020  h in paths:..   
-00002ec0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00002ed0: 7374 616e 6365 2870 6174 682c 2073 7472  stance(path, str
-00002ee0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00002ef0: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
-00002f00: 7061 7468 290d 0a20 2020 2020 2020 2020  path)..         
-00002f10: 2020 2061 6374 7561 6c5f 7061 7468 732e     actual_paths.
-00002f20: 6170 7065 6e64 2870 6174 6829 0d0a 0d0a  append(path)....
-00002f30: 2020 2020 2020 2020 6163 7475 616c 5f70          actual_p
-00002f40: 6174 6873 2e73 6f72 7428 7265 7665 7273  aths.sort(revers
-00002f50: 653d 5472 7565 290d 0a0d 0a20 2020 2020  e=True)....     
-00002f60: 2020 2066 6f72 2070 6174 6820 696e 2061     for path in a
-00002f70: 6374 7561 6c5f 7061 7468 733a 0d0a 2020  ctual_paths:..  
-00002f80: 2020 2020 2020 2020 2020 6966 2070 6174            if pat
-00002f90: 682e 6973 5f64 6972 2829 3a0d 0a20 2020  h.is_dir():..   
-00002fa0: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-00002fb0: 7061 7468 7320 3d20 736f 7274 6564 2870  paths = sorted(p
-00002fc0: 6174 682e 6974 6572 6469 7228 2929 0d0a  ath.iterdir())..
-00002fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fe0: 7365 6c66 2e72 6576 6572 745f 7371 6c28  self.revert_sql(
-00002ff0: 2a73 7562 7061 7468 732c 2065 6e63 6f64  *subpaths, encod
-00003000: 696e 673d 656e 636f 6469 6e67 290d 0a0d  ing=encoding)...
-00003010: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00003020: 6620 6e6f 7420 7061 7468 2e6e 616d 652e  f not path.name.
-00003030: 656e 6473 7769 7468 2822 5f72 6576 6572  endswith("_rever
-00003040: 742e 7371 6c22 293a 0d0a 2020 2020 2020  t.sql"):..      
-00003050: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00003060: 7565 2023 2069 676e 6f72 650d 0a0d 0a20  ue # ignore.... 
-00003070: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00003080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003090: 2020 6c6f 6767 6572 2e69 6e66 6f28 2265    logger.info("e
-000030a0: 7865 6375 7465 2025 7322 2c20 7061 7468  xecute %s", path
-000030b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000030c0: 2020 2071 7565 7279 203d 2070 6174 682e     query = path.
-000030d0: 7265 6164 5f74 6578 7428 656e 636f 6469  read_text(encodi
-000030e0: 6e67 3d65 6e63 6f64 696e 6729 0d0a 2020  ng=encoding)..  
-000030f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003100: 6c66 2e65 7865 6375 7465 2871 7565 7279  lf.execute(query
-00003110: 290d 0a0d 0a0d 0a63 6c61 7373 2043 6f6c  )......class Col
-00003120: 756d 6e3a 0d0a 2020 2020 6465 6620 5f5f  umn:..    def __
-00003130: 696e 6974 5f5f 2873 656c 662c 206e 616d  init__(self, nam
-00003140: 653a 2073 7472 2c20 2a2c 2070 6f73 6974  e: str, *, posit
-00003150: 696f 6e3a 2069 6e74 203d 204e 6f6e 652c  ion: int = None,
-00003160: 2070 7974 686f 6e5f 7479 7065 3a20 7479   python_type: ty
-00003170: 7065 203d 204e 6f6e 652c 206f 7269 6769  pe = None, origi
-00003180: 6e61 6c5f 7479 7065 3a20 7374 7220 3d20  nal_type: str = 
-00003190: 4e6f 6e65 2c20 7072 6563 6973 696f 6e3a  None, precision:
-000031a0: 2069 6e74 203d 204e 6f6e 652c 2073 6361   int = None, sca
-000031b0: 6c65 3a20 696e 7420 3d20 4e6f 6e65 2c20  le: int = None, 
-000031c0: 6e75 6c6c 5f6f 6b3a 2062 6f6f 6c20 3d20  null_ok: bool = 
-000031d0: 4e6f 6e65 2c20 6469 7370 6c61 795f 7369  None, display_si
-000031e0: 7a65 3a20 696e 7420 3d20 4e6f 6e65 2c20  ze: int = None, 
-000031f0: 696e 7465 726e 616c 5f73 697a 653a 2069  internal_size: i
-00003200: 6e74 203d 204e 6f6e 652c 2070 7269 6d61  nt = None, prima
-00003210: 7279 5f6b 6579 3a20 626f 6f6c 203d 2046  ry_key: bool = F
-00003220: 616c 7365 2c20 6465 6661 756c 743a 2073  alse, default: s
-00003230: 7472 7c4c 6974 6572 616c 2827 5f5f 6e6f  tr|Literal('__no
-00003240: 775f 5f27 2920 3d20 4e6f 6e65 293a 0d0a  w__') = None):..
-00003250: 2020 2020 2020 2020 7365 6c66 2e6e 616d          self.nam
-00003260: 653a 2073 7472 7c4e 6f6e 6520 3d20 6e61  e: str|None = na
-00003270: 6d65 0d0a 2020 2020 2020 2020 2222 2220  me..        """ 
-00003280: 4e6f 6d20 6465 206c 6120 636f 6c6f 6e6e  Nom de la colonn
-00003290: 652e 2050 6575 7420 c3aa 7472 6520 7669  e. Peut ..tre vi
-000032a0: 6465 2028 7061 7220 6578 656d 706c 6520  de (par exemple 
-000032b0: 706f 7572 206c 6573 2063 6f6c 6f6e 6e65  pour les colonne
-000032c0: 7320 6361 6c63 756c c3a9 6573 2073 616e  s calcul..es san
-000032d0: 7320 616c 6961 7320 64c3 a966 696e 6929  s alias d..fini)
-000032e0: 2e20 2222 220d 0a0d 0a20 2020 2020 2020  . """....       
-000032f0: 2073 656c 662e 706f 7369 7469 6f6e 3a20   self.position: 
-00003300: 696e 747c 4e6f 6e65 203d 2070 6f73 6974  int|None = posit
-00003310: 696f 6e0d 0a20 2020 2020 2020 2022 2222  ion..        """
-00003320: 204f 7264 696e 616c 2070 6f73 6974 696f   Ordinal positio
-00003330: 6e2c 2073 7461 7274 696e 6720 6672 6f6d  n, starting from
-00003340: 2031 2e20 2222 220d 0a0d 0a20 2020 2020   1. """....     
-00003350: 2020 2073 656c 662e 7079 7468 6f6e 5f74     self.python_t
-00003360: 7970 653a 2074 7970 657c 4e6f 6e65 203d  ype: type|None =
-00003370: 2070 7974 686f 6e5f 7479 7065 0d0a 2020   python_type..  
-00003380: 2020 2020 2020 2222 2220 5479 7065 2050        """ Type P
-00003390: 7974 686f 6e20 7574 696c 6973 c3a9 2070  ython utilis.. p
-000033a0: 6172 206c 6520 6472 6976 6572 2070 6f75  ar le driver pou
-000033b0: 7220 7265 7072 c3a9 7365 6e74 6572 206c  r repr..senter l
-000033c0: 6573 2076 616c 6575 7273 2e0d 0a20 2020  es valeurs...   
-000033d0: 2020 2020 2041 7474 656e 7469 6f6e 203a       Attention :
-000033e0: 206c 6573 2076 616c 6575 7273 2064 6520   les valeurs de 
-000033f0: 7479 7065 2053 514c 2044 4154 4520 6f75  type SQL DATE ou
-00003400: 2044 4154 4554 494d 4520 7065 7576 656e   DATETIME peuven
-00003410: 7420 c3aa 7472 6520 6d61 7070 c3a9 6573  t ..tre mapp..es
-00003420: 2061 7520 7479 7065 2050 7974 686f 6e20   au type Python 
-00003430: 6073 7472 6020 7375 6976 616e 7420 6c65  `str` suivant le
-00003440: 2064 7269 7665 7220 7574 696c 6973 c3a9   driver utilis..
-00003450: 2e20 2222 220d 0a20 2020 2020 2020 2023  . """..        #
-00003460: 2043 662e 2068 7474 7073 3a2f 2f73 7461   Cf. https://sta
-00003470: 636b 6f76 6572 666c 6f77 2e63 6f6d 2f71  ckoverflow.com/q
-00003480: 7565 7374 696f 6e73 2f37 3137 3235 3430  uestions/7172540
-00003490: 2f70 796f 6462 632d 7265 7475 726e 732d  /pyodbc-returns-
-000034a0: 7371 6c2d 7365 7276 6572 2d64 6174 652d  sql-server-date-
-000034b0: 6669 656c 6473 2d61 732d 7374 7269 6e67  fields-as-string
-000034c0: 730d 0a0d 0a20 2020 2020 2020 2073 656c  s....        sel
-000034d0: 662e 6f72 6967 696e 616c 5f74 7970 653a  f.original_type:
-000034e0: 2073 7472 7c4e 6f6e 6520 3d20 6f72 6967   str|None = orig
-000034f0: 696e 616c 5f74 7970 650d 0a0d 0a20 2020  inal_type....   
-00003500: 2020 2020 2073 656c 662e 7072 6563 6973       self.precis
-00003510: 696f 6e3a 2069 6e74 7c4e 6f6e 6520 3d20  ion: int|None = 
-00003520: 7072 6563 6973 696f 6e0d 0a20 2020 2020  precision..     
-00003530: 2020 2022 2222 2054 6f74 616c 206e 756d     """ Total num
-00003540: 6265 7220 6f66 2073 6967 6e69 6669 6361  ber of significa
-00003550: 6e74 2064 6967 6974 732e 0d0a 2020 2020  nt digits...    
-00003560: 2020 2020 2d20 6d73 7371 6c3a 2061 6c77      - mssql: alw
-00003570: 6179 7320 7365 742e 2022 2222 0d0a 2020  ays set. """..  
-00003580: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00003590: 7365 6c66 2e73 6361 6c65 3a20 696e 747c  self.scale: int|
-000035a0: 4e6f 6e65 203d 2073 6361 6c65 0d0a 2020  None = scale..  
-000035b0: 2020 2020 2020 2222 2220 436f 756e 7420        """ Count 
-000035c0: 6f66 2064 6563 696d 616c 2064 6967 6974  of decimal digit
-000035d0: 7320 696e 2074 6865 2066 7261 6374 696f  s in the fractio
-000035e0: 6e61 6c20 7061 7274 206f 6620 7468 6520  nal part of the 
-000035f0: 7479 7065 2e0d 0a20 2020 2020 2020 202d  type...        -
-00003600: 206d 7373 716c 3a20 616c 7761 7973 2073   mssql: always s
-00003610: 6574 2c20 7573 696e 6720 3020 6966 206e  et, using 0 if n
-00003620: 6f6e 652e 2022 2222 0d0a 0d0a 2020 2020  one. """....    
-00003630: 2020 2020 7365 6c66 2e6e 756c 6c5f 6f6b      self.null_ok
-00003640: 3a20 626f 6f6c 7c4e 6f6e 6520 3d20 6e75  : bool|None = nu
-00003650: 6c6c 5f6f 6b0d 0a20 2020 2020 2020 2022  ll_ok..        "
-00003660: 2222 2049 6e64 6963 6174 6520 6966 2074  "" Indicate if t
-00003670: 6865 2063 6f6c 756d 6e20 6163 6365 7074  he column accept
-00003680: 7320 6e75 6c6c 2076 616c 7565 2e0d 0a20  s null value... 
-00003690: 2020 2020 2020 202d 2070 673a 2061 6c77         - pg: alw
-000036a0: 6179 7320 4e6f 6e65 2061 7320 6e6f 7420  ays None as not 
-000036b0: 6561 7379 2074 6f20 7265 7472 6965 7665  easy to retrieve
-000036c0: 2066 726f 6d20 7468 6520 6c69 6270 712e   from the libpq.
-000036d0: 0d0a 2020 2020 2020 2020 2222 220d 0a0d  ..        """...
-000036e0: 0a20 2020 2020 2020 2073 656c 662e 6469  .        self.di
-000036f0: 7370 6c61 795f 7369 7a65 3a20 696e 747c  splay_size: int|
-00003700: 4e6f 6e65 203d 2064 6973 706c 6179 5f73  None = display_s
-00003710: 697a 650d 0a20 2020 2020 2020 2022 2222  ize..        """
-00003720: 2054 6865 2061 6374 7561 6c20 6c65 6e67   The actual leng
-00003730: 7468 206f 6620 7468 6520 636f 6c75 6d6e  th of the column
-00003740: 2069 6e20 6279 7465 732e 0d0a 2020 2020   in bytes...    
-00003750: 2020 2020 2d20 6d73 7371 6c3a 2061 6c77      - mssql: alw
-00003760: 6179 7320 4e6f 6e65 2028 6f72 6967 696e  ays None (origin
-00003770: 616c 6c79 2061 6c77 6179 7320 7a65 726f  ally always zero
-00003780: 292e 2022 2222 0d0a 0d0a 2020 2020 2020  ). """....      
-00003790: 2020 7365 6c66 2e69 6e74 6572 6e61 6c5f    self.internal_
-000037a0: 7369 7a65 3a20 696e 747c 4e6f 6e65 203d  size: int|None =
-000037b0: 2069 6e74 6572 6e61 6c5f 7369 7a65 0d0a   internal_size..
-000037c0: 2020 2020 2020 2020 2222 2220 5468 6520          """ The 
-000037d0: 7369 7a65 2069 6e20 6279 7465 7320 6f66  size in bytes of
-000037e0: 2074 6865 2063 6f6c 756d 6e20 6173 736f   the column asso
-000037f0: 6369 6174 6564 2074 6f20 7468 6973 2063  ciated to this c
-00003800: 6f6c 756d 6e20 6f6e 2074 6865 2073 6572  olumn on the ser
-00003810: 7665 722e 0d0a 2020 2020 2020 2020 2d20  ver...        - 
-00003820: 6d73 7371 6c3a 2061 6c77 6179 7320 4e6f  mssql: always No
-00003830: 6e65 2028 6f72 6967 696e 616c 6c79 2061  ne (originally a
-00003840: 6c77 6179 7320 7361 6d65 2061 7320 7072  lways same as pr
-00003850: 6563 6973 696f 6e29 2e20 2222 220d 0a0d  ecision). """...
-00003860: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-00003870: 696d 6172 795f 6b65 793a 2062 6f6f 6c20  imary_key: bool 
-00003880: 3d20 7072 696d 6172 795f 6b65 790d 0a0d  = primary_key...
-00003890: 0a20 2020 2020 2020 2073 656c 662e 6465  .        self.de
-000038a0: 6661 756c 743a 2073 7472 7c4c 6974 6572  fault: str|Liter
-000038b0: 616c 2827 5f5f 6e6f 775f 5f27 297c 4e6f  al('__now__')|No
-000038c0: 6e65 203d 2064 6566 6175 6c74 0d0a 0d0a  ne = default....
-000038d0: 0d0a 2020 2020 6465 6620 5f63 6865 636b  ..    def _check
-000038e0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-000038f0: 2022 2222 0d0a 2020 2020 2020 2020 456e   """..        En
-00003900: 7375 7265 2063 6f6e 7369 7374 656e 6379  sure consistency
-00003910: 206f 6620 636f 6c75 6d6e 2064 6566 696e   of column defin
-00003920: 6974 696f 6e2e 0d0a 0d0a 2020 2020 2020  ition.....      
-00003930: 2020 4361 6c6c 6564 2061 6674 6572 2063    Called after c
-00003940: 7265 6174 696f 6e20 6f66 2043 6f6c 756d  reation of Colum
-00003950: 6e20 696e 7374 616e 6365 2061 6e64 2070  n instance and p
-00003960: 6f74 656e 7469 616c 2066 6978 2061 6461  otential fix ada
-00003970: 7074 6564 2074 6f20 7370 6563 6966 6963  pted to specific
-00003980: 2044 6174 6162 6173 6520 656e 6769 6e65   Database engine
-00003990: 732e 0d0a 2020 2020 2020 2020 2222 220d  s...        """.
-000039a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000039b0: 2e70 7974 686f 6e5f 7479 7065 2069 7320  .python_type is 
-000039c0: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
-000039d0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-000039e0: 2e70 7974 686f 6e5f 7479 7065 2c20 7479  .python_type, ty
-000039f0: 7065 293a 0d0a 2020 2020 2020 2020 2020  pe):..          
-00003a00: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00003a10: 6f72 2866 2269 6e76 616c 6964 2070 7974  or(f"invalid pyt
-00003a20: 686f 6e5f 7479 7065 205c 227b 7365 6c66  hon_type \"{self
-00003a30: 2e70 7974 686f 6e5f 7479 7065 7d5c 2220  .python_type}\" 
-00003a40: 287b 7479 7065 2873 656c 662e 7079 7468  ({type(self.pyth
-00003a50: 6f6e 5f74 7970 6529 2e5f 5f6e 616d 655f  on_type).__name_
-00003a60: 5f7d 293a 2065 7870 6563 7465 6420 7479  _}): expected ty
-00003a70: 7065 2069 6e73 7461 6e63 6522 290d 0a0d  pe instance")...
-00003a80: 0a0d 0a20 2020 2064 6566 205f 5f73 7472  ...    def __str
-00003a90: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
-00003aa0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00003ab0: 2073 656c 662e 6e61 6d65 0d0a             self.name..
+000000d0: 6f72 7420 7175 6f74 650d 0a0d 0a6c 6f67  ort quote....log
+000000e0: 6765 7220 3d20 6c6f 6767 696e 672e 6765  ger = logging.ge
+000000f0: 744c 6f67 6765 7228 5f5f 6e61 6d65 5f5f  tLogger(__name__
+00000100: 290d 0a0d 0a54 5f43 6f6e 6e65 6374 696f  )....T_Connectio
+00000110: 6e20 3d20 5479 7065 5661 7228 2754 5f43  n = TypeVar('T_C
+00000120: 6f6e 6e65 6374 696f 6e27 290d 0a54 5f43  onnection')..T_C
+00000130: 7572 736f 7220 3d20 5479 7065 5661 7228  ursor = TypeVar(
+00000140: 2754 5f43 7572 736f 7227 290d 0a0d 0a63  'T_Cursor')....c
+00000150: 6c61 7373 2044 6257 7261 7070 6572 2847  lass DbWrapper(G
+00000160: 656e 6572 6963 5b54 5f43 6f6e 6e65 6374  eneric[T_Connect
+00000170: 696f 6e2c 2054 5f43 7572 736f 725d 293a  ion, T_Cursor]):
+00000180: 0d0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00000190: 6f64 0d0a 2020 2020 6465 6620 6973 5f61  od..    def is_a
+000001a0: 7661 696c 6162 6c65 2863 6c73 293a 0d0a  vailable(cls):..
+000001b0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
+000001c0: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
+000001d0: 7228 290d 0a20 2020 200d 0a20 2020 2073  r()..    ..    s
+000001e0: 6368 656d 653a 2073 7472 0d0a 2020 2020  cheme: str..    
+000001f0: 6465 6661 756c 745f 7363 6865 6d61 5f6e  default_schema_n
+00000200: 616d 653a 2073 7472 0d0a 2020 2020 636f  ame: str..    co
+00000210: 6d70 6174 6962 6c65 5f64 6a61 6e67 6f5f  mpatible_django_
+00000220: 656e 6769 6e65 733a 206c 6973 745b 7374  engines: list[st
+00000230: 725d 0d0a 0d0a 2020 2020 6465 6620 5f5f  r]....    def __
+00000240: 696e 6974 5f5f 2873 656c 662c 202a 2c20  init__(self, *, 
+00000250: 6e61 6d65 3a20 7374 7220 3d20 4e6f 6e65  name: str = None
+00000260: 2c20 686f 7374 3a20 7374 7220 3d20 4e6f  , host: str = No
+00000270: 6e65 2c20 706f 7274 3a20 696e 7420 3d20  ne, port: int = 
+00000280: 4e6f 6e65 2c20 7573 6572 3a20 7374 7220  None, user: str 
+00000290: 3d20 4e6f 6e65 2c20 7061 7373 776f 7264  = None, password
+000002a0: 3a20 7374 7220 3d20 4e6f 6e65 2c20 646a  : str = None, dj
+000002b0: 616e 676f 5f61 6c69 6173 3a20 7374 7220  ango_alias: str 
+000002c0: 3d20 4e6f 6e65 2c20 636f 6e6e 6563 7469  = None, connecti
+000002d0: 6f6e 3a20 545f 436f 6e6e 6563 7469 6f6e  on: T_Connection
+000002e0: 203d 204e 6f6e 652c 206e 6169 7665 5f74   = None, naive_t
+000002f0: 7a3a 204c 6974 6572 616c 5b27 6c6f 6361  z: Literal['loca
+00000300: 6c27 5d7c 7469 6d65 7a6f 6e65 203d 2027  l']|timezone = '
+00000310: 6c6f 6361 6c27 293a 2020 2020 0d0a 2020  local'):    ..  
+00000320: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00000330: 662e 6973 5f61 7661 696c 6162 6c65 2829  f.is_available()
+00000340: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00000350: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00000360: 6622 6361 6e6e 6f74 2075 7365 207b 7479  f"cannot use {ty
+00000370: 7065 2873 656c 6629 2e5f 5f6e 616d 655f  pe(self).__name_
+00000380: 5f7d 2028 6e6f 7420 6176 6169 6c61 626c  _} (not availabl
+00000390: 6529 2229 0d0a 2020 2020 2020 2020 0d0a  e)")..        ..
+000003a0: 2020 2020 2020 2020 6966 2064 6a61 6e67          if djang
+000003b0: 6f5f 616c 6961 7320 6973 206e 6f74 204e  o_alias is not N
+000003c0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000003d0: 2020 6672 6f6d 2064 6a61 6e67 6f2e 636f    from django.co
+000003e0: 6e66 2069 6d70 6f72 7420 7365 7474 696e  nf import settin
+000003f0: 6773 0d0a 2020 2020 2020 2020 2020 2020  gs..            
+00000400: 4441 5441 4241 5345 5320 3d20 7365 7474  DATABASES = sett
+00000410: 696e 6773 2e44 4154 4142 4153 4553 0d0a  ings.DATABASES..
+00000420: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00000430: 6f74 2064 6a61 6e67 6f5f 616c 6961 7320  ot django_alias 
+00000440: 696e 2044 4154 4142 4153 4553 3a0d 0a20  in DATABASES:.. 
+00000450: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00000460: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00000470: 6622 6b65 7920 5c22 7b64 6a61 6e67 6f5f  f"key \"{django_
+00000480: 616c 6961 737d 5c22 206e 6f74 2066 6f75  alias}\" not fou
+00000490: 6e64 2069 6e20 646a 616e 676f 2044 4154  nd in django DAT
+000004a0: 4142 4153 4553 2073 6574 7469 6e67 7322  ABASES settings"
+000004b0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+000004c0: 6174 6162 6173 655f 7365 7474 696e 6773  atabase_settings
+000004d0: 3a20 6469 6374 5b73 7472 2c41 6e79 5d20  : dict[str,Any] 
+000004e0: 3d20 4441 5441 4241 5345 535b 646a 616e  = DATABASES[djan
+000004f0: 676f 5f61 6c69 6173 5d0d 0a20 2020 2020  go_alias]..     
+00000500: 2020 2020 2020 2065 6e67 696e 6520 3d20         engine = 
+00000510: 6461 7461 6261 7365 5f73 6574 7469 6e67  database_setting
+00000520: 735b 2745 4e47 494e 4527 5d0d 0a20 2020  s['ENGINE']..   
+00000530: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00000540: 656e 6769 6e65 2069 6e20 7365 6c66 2e63  engine in self.c
+00000550: 6f6d 7061 7469 626c 655f 646a 616e 676f  ompatible_django
+00000560: 5f65 6e67 696e 6573 3a0d 0a20 2020 2020  _engines:..     
+00000570: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00000580: 2056 616c 7565 4572 726f 7228 6622 646a   ValueError(f"dj
+00000590: 616e 676f 2064 6174 6162 6173 6520 656e  ango database en
+000005a0: 6769 6e65 205c 227b 656e 6769 6e65 7d5c  gine \"{engine}\
+000005b0: 2220 6973 206e 6f74 2063 6f6d 7061 7469  " is not compati
+000005c0: 626c 6520 7769 7468 207b 7479 7065 2873  ble with {type(s
+000005d0: 656c 6629 2e5f 5f6e 616d 655f 5f7d 2229  elf).__name__}")
+000005e0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+000005f0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00000600: 6162 6173 655f 7365 7474 696e 6773 3a20  abase_settings: 
+00000610: 6469 6374 5b73 7472 2c41 6e79 5d20 3d20  dict[str,Any] = 
+00000620: 7b7d 0d0a 0d0a 2020 2020 2020 2020 7365  {}....        se
+00000630: 6c66 2e5f 6e61 6d65 3a20 7374 7220 3d20  lf._name: str = 
+00000640: 6e61 6d65 2069 6620 6e61 6d65 2069 7320  name if name is 
+00000650: 6e6f 7420 4e6f 6e65 2065 6c73 6520 6461  not None else da
+00000660: 7461 6261 7365 5f73 6574 7469 6e67 732e  tabase_settings.
+00000670: 6765 7428 274e 414d 4527 2c20 4e6f 6e65  get('NAME', None
+00000680: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00000690: 5f68 6f73 743a 2073 7472 203d 2068 6f73  _host: str = hos
+000006a0: 7420 6966 2068 6f73 7420 6973 206e 6f74  t if host is not
+000006b0: 204e 6f6e 6520 656c 7365 2064 6174 6162   None else datab
+000006c0: 6173 655f 7365 7474 696e 6773 2e67 6574  ase_settings.get
+000006d0: 2827 484f 5354 272c 204e 6f6e 6529 0d0a  ('HOST', None)..
+000006e0: 2020 2020 2020 2020 7365 6c66 2e5f 7573          self._us
+000006f0: 6572 3a20 7374 7220 3d20 7573 6572 2069  er: str = user i
+00000700: 6620 7573 6572 2069 7320 6e6f 7420 4e6f  f user is not No
+00000710: 6e65 2065 6c73 6520 6461 7461 6261 7365  ne else database
+00000720: 5f73 6574 7469 6e67 732e 6765 7428 2755  _settings.get('U
+00000730: 5345 5227 2c20 4e6f 6e65 290d 0a20 2020  SER', None)..   
+00000740: 2020 2020 2073 656c 662e 5f70 6173 7377       self._passw
+00000750: 6f72 643a 2073 7472 203d 2070 6173 7377  ord: str = passw
+00000760: 6f72 6420 6966 2070 6173 7377 6f72 6420  ord if password 
+00000770: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+00000780: 2064 6174 6162 6173 655f 7365 7474 696e   database_settin
+00000790: 6773 2e67 6574 2827 5041 5353 574f 5244  gs.get('PASSWORD
+000007a0: 272c 204e 6f6e 6529 0d0a 2020 2020 2020  ', None)..      
+000007b0: 2020 7365 6c66 2e5f 706f 7274 3a20 7374    self._port: st
+000007c0: 7220 3d20 706f 7274 2069 6620 706f 7274  r = port if port
+000007d0: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+000007e0: 6520 6461 7461 6261 7365 5f73 6574 7469  e database_setti
+000007f0: 6e67 732e 6765 7428 2750 4f52 5427 2c20  ngs.get('PORT', 
+00000800: 4e6f 6e65 290d 0a0d 0a20 2020 2020 2020  None)....       
+00000810: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
+00000820: 656c 662e 5f70 6f72 742c 2073 7472 293a  elf._port, str):
+00000830: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00000840: 6c66 2e5f 706f 7274 203d 2069 6e74 2873  lf._port = int(s
+00000850: 656c 662e 5f70 6f72 7429 0d0a 2020 2020  elf._port)..    
+00000860: 2020 2020 0d0a 2020 2020 2020 2020 7365      ..        se
+00000870: 6c66 2e5f 6e61 6976 655f 747a 203d 206e  lf._naive_tz = n
+00000880: 6169 7665 5f74 7a0d 0a20 2020 2020 2020  aive_tz..       
+00000890: 2022 2222 2049 6620 6e6f 7420 4e6f 6e65   """ If not None
+000008a0: 2c20 696e 6469 6361 7465 2077 6869 6368  , indicate which
+000008b0: 2074 696d 657a 6f6e 6520 7769 6c6c 2062   timezone will b
+000008c0: 6520 7573 6564 2066 6f72 206e 6169 7665  e used for naive
+000008d0: 2064 6174 6574 696d 6573 2e20 2222 220d   datetimes. """.
+000008e0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000008f0: 5f63 6f6e 6e65 6374 696f 6e20 3d20 636f  _connection = co
+00000900: 6e6e 6563 7469 6f6e 0d0a 2020 2020 2020  nnection..      
+00000910: 2020 7365 6c66 2e5f 6d75 7374 5f63 6c6f    self._must_clo
+00000920: 7365 5f63 6f6e 6e65 6374 696f 6e20 3d20  se_connection = 
+00000930: 636f 6e6e 6563 7469 6f6e 2069 7320 4e6f  connection is No
+00000940: 6e65 0d0a 0d0a 0d0a 2020 2020 6465 6620  ne......    def 
+00000950: 5f5f 656e 7465 725f 5f28 7365 6c66 293a  __enter__(self):
+00000960: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00000970: 2073 656c 660d 0a0d 0a0d 0a20 2020 2064   self......    d
+00000980: 6566 205f 5f65 7869 745f 5f28 7365 6c66  ef __exit__(self
+00000990: 2c20 6578 635f 7479 7065 203d 204e 6f6e  , exc_type = Non
+000009a0: 652c 2065 7863 5f76 616c 203d 204e 6f6e  e, exc_val = Non
+000009b0: 652c 2065 7863 5f74 6220 3d20 4e6f 6e65  e, exc_tb = None
+000009c0: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
+000009d0: 656c 662e 5f63 6f6e 6e65 6374 696f 6e20  elf._connection 
+000009e0: 616e 6420 7365 6c66 2e5f 6d75 7374 5f63  and self._must_c
+000009f0: 6c6f 7365 5f63 6f6e 6e65 6374 696f 6e3a  lose_connection:
+00000a00: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00000a10: 6c66 2e5f 636f 6e6e 6563 7469 6f6e 2e63  lf._connection.c
+00000a20: 6c6f 7365 2829 0d0a 0d0a 0d0a 2020 2020  lose()......    
+00000a30: 6465 6620 6765 745f 7572 6928 7365 6c66  def get_uri(self
+00000a40: 2c20 7461 626c 653a 2073 7472 7c74 7570  , table: str|tup
+00000a50: 6c65 2c20 2a2c 2077 6974 685f 7061 7373  le, *, with_pass
+00000a60: 776f 7264 203d 2046 616c 7365 293a 0d0a  word = False):..
+00000a70: 2020 2020 2020 2020 7572 6920 3d20 6622          uri = f"
+00000a80: 7b73 656c 662e 7363 6865 6d65 7d3a 220d  {self.scheme}:".
+00000a90: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+00000aa0: 6c66 2e5f 7573 6572 206f 7220 7365 6c66  lf._user or self
+00000ab0: 2e5f 686f 7374 3a0d 0a20 2020 2020 2020  ._host:..       
+00000ac0: 2020 2020 2075 7269 202b 3d20 272f 2f27       uri += '//'
+00000ad0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00000ae0: 2073 656c 662e 5f75 7365 723a 0d0a 2020   self._user:..  
+00000af0: 2020 2020 2020 2020 2020 2020 2020 7572                ur
+00000b00: 6920 2b3d 2071 756f 7465 2873 656c 662e  i += quote(self.
+00000b10: 5f75 7365 7229 0d0a 2020 2020 2020 2020  _user)..        
+00000b20: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00000b30: 5f70 6173 7377 6f72 643a 0d0a 2020 2020  _password:..    
+00000b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b50: 7572 6920 2b3d 2027 3a27 202b 2028 7175  uri += ':' + (qu
+00000b60: 6f74 6528 7365 6c66 2e5f 7061 7373 776f  ote(self._passwo
+00000b70: 7264 2920 6966 2077 6974 685f 7061 7373  rd) if with_pass
+00000b80: 776f 7264 2065 6c73 6520 7265 2e73 7562  word else re.sub
+00000b90: 2872 272e 272c 2027 2a27 2c20 7365 6c66  (r'.', '*', self
+00000ba0: 2e5f 7061 7373 776f 7264 2929 0d0a 2020  ._password))..  
+00000bb0: 2020 2020 2020 2020 2020 2020 2020 7572                ur
+00000bc0: 6920 2b3d 2027 4027 0d0a 0d0a 2020 2020  i += '@'....    
+00000bd0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00000be0: 5f68 6f73 743a 0d0a 2020 2020 2020 2020  _host:..        
+00000bf0: 2020 2020 2020 2020 7572 6920 2b3d 2071          uri += q
+00000c00: 756f 7465 2873 656c 662e 5f68 6f73 7429  uote(self._host)
+00000c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000c20: 2020 6966 2073 656c 662e 5f70 6f72 743a    if self._port:
+00000c30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000c40: 2020 2020 2020 7572 6920 2b3d 2066 273a        uri += f':
+00000c50: 7b73 656c 662e 5f70 6f72 747d 270d 0a0d  {self._port}'...
+00000c60: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00000c70: 2e5f 6e61 6d65 3a0d 0a20 2020 2020 2020  ._name:..       
+00000c80: 2020 2020 2075 7269 202b 3d20 6622 2f7b       uri += f"/{
+00000c90: 7175 6f74 6528 7365 6c66 2e5f 6e61 6d65  quote(self._name
+00000ca0: 297d 220d 0a0d 0a20 2020 2020 2020 2073  )}"....        s
+00000cb0: 6368 656d 612c 2074 6162 6c65 203d 2073  chema, table = s
+00000cc0: 656c 662e 7370 6c69 745f 6e61 6d65 2874  elf.split_name(t
+00000cd0: 6162 6c65 290d 0a20 2020 2020 2020 2069  able)..        i
+00000ce0: 6620 7461 626c 653a 0d0a 2020 2020 2020  f table:..      
+00000cf0: 2020 2020 2020 7572 6920 2b3d 2066 222f        uri += f"/
+00000d00: 220d 0a20 2020 2020 2020 2020 2020 2069  "..            i
+00000d10: 6620 7363 6865 6d61 3a0d 0a20 2020 2020  f schema:..     
+00000d20: 2020 2020 2020 2020 2020 2075 7269 202b             uri +
+00000d30: 3d20 7175 6f74 6528 7363 6865 6d61 290d  = quote(schema).
+00000d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000d50: 2075 7269 202b 3d20 272e 270d 0a20 2020   uri += '.'..   
+00000d60: 2020 2020 2020 2020 2075 7269 202b 3d20           uri += 
+00000d70: 7175 6f74 6528 7461 626c 6529 0d0a 0d0a  quote(table)....
+00000d80: 2020 2020 2020 2020 7265 7475 726e 2075          return u
+00000d90: 7269 0d0a 0d0a 0d0a 2020 2020 4070 726f  ri......    @pro
+00000da0: 7065 7274 790d 0a20 2020 2064 6566 2063  perty..    def c
+00000db0: 6f6e 6e65 6374 696f 6e28 7365 6c66 293a  onnection(self):
+00000dc0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00000dd0: 2073 656c 662e 5f63 6f6e 6e65 6374 696f   self._connectio
+00000de0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+00000df0: 7365 6c66 2e5f 636f 6e6e 6563 7469 6f6e  self._connection
+00000e00: 203d 2073 656c 662e 5f63 7265 6174 655f   = self._create_
+00000e10: 636f 6e6e 6563 7469 6f6e 2829 0d0a 2020  connection()..  
+00000e20: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00000e30: 662e 5f63 6f6e 6e65 6374 696f 6e0d 0a0d  f._connection...
+00000e40: 0a0d 0a20 2020 2064 6566 205f 6372 6561  ...    def _crea
+00000e50: 7465 5f63 6f6e 6e65 6374 696f 6e28 7365  te_connection(se
+00000e60: 6c66 2920 2d3e 2054 5f43 6f6e 6e65 6374  lf) -> T_Connect
+00000e70: 696f 6e3a 0d0a 2020 2020 2020 2020 7261  ion:..        ra
+00000e80: 6973 6520 4e6f 7449 6d70 6c65 6d65 6e74  ise NotImplement
+00000e90: 6564 4572 726f 7228 290d 0a0d 0a0d 0a20  edError()...... 
+00000ea0: 2020 2064 6566 2063 7572 736f 7228 7365     def cursor(se
+00000eb0: 6c66 2920 2d3e 2054 5f43 7572 736f 723a  lf) -> T_Cursor:
+00000ec0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00000ed0: 2073 656c 662e 636f 6e6e 6563 7469 6f6e   self.connection
+00000ee0: 2e63 7572 736f 7228 290d 0a20 2020 200d  .cursor()..    .
+00000ef0: 0a20 2020 200d 0a20 2020 2064 6566 206c  .    ..    def l
+00000f00: 696d 6974 5f71 7565 7279 2873 656c 662c  imit_query(self,
+00000f10: 2071 7565 7279 3a20 7374 722c 206c 696d   query: str, lim
+00000f20: 6974 3a20 696e 7429 3a0d 0a20 2020 2020  it: int):..     
+00000f30: 2020 2069 6620 6c69 6d69 7420 6973 204e     if limit is N
+00000f40: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00000f50: 2020 7265 7475 726e 2071 7565 7279 0d0a    return query..
+00000f60: 2020 2020 0d0a 2020 2020 2020 2020 6966      ..        if
+00000f70: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00000f80: 6c69 6d69 742c 2069 6e74 293a 0d0a 2020  limit, int):..  
+00000f90: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00000fa0: 5661 6c75 6545 7272 6f72 2866 2269 6e76  ValueError(f"inv
+00000fb0: 616c 6964 2074 7970 6520 666f 7220 6c69  alid type for li
+00000fc0: 6d69 743a 207b 7479 7065 286c 696d 6974  mit: {type(limit
+00000fd0: 292e 5f5f 6e61 6d65 5f5f 7d20 2865 7870  ).__name__} (exp
+00000fe0: 6563 7465 6420 696e 7429 2229 0d0a 2020  ected int)")..  
+00000ff0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00001000: 696d 706f 7274 2073 716c 7061 7273 6520  import sqlparse 
+00001010: 2320 6e6f 7420 6174 2074 6865 2074 6f70  # not at the top
+00001020: 2062 6563 6175 7365 2074 6865 2065 6e64   because the end
+00001030: 7573 6572 206d 6967 6874 206e 6f74 206e  user might not n
+00001040: 6565 6420 7468 6973 2066 6561 7475 7265  eed this feature
+00001050: 0d0a 0d0a 2020 2020 2020 2020 2320 5061  ....        # Pa
+00001060: 7273 6520 5351 4c20 746f 2072 656d 6f76  rse SQL to remov
+00001070: 6520 746f 6b65 6e20 6265 666f 7265 2074  e token before t
+00001080: 6865 2053 454c 4543 5420 6b65 7977 6f72  he SELECT keywor
+00001090: 640d 0a20 2020 2020 2020 2023 2065 7861  d..        # exa
+000010a0: 6d70 6c65 3a20 5749 5448 2028 4354 4529  mple: WITH (CTE)
+000010b0: 2074 6f6b 656e 730d 0a20 2020 2020 2020   tokens..       
+000010c0: 2073 7461 7465 6d65 6e74 7320 3d20 7371   statements = sq
+000010d0: 6c70 6172 7365 2e70 6172 7365 2871 7565  lparse.parse(que
+000010e0: 7279 290d 0a20 2020 2020 2020 2069 6620  ry)..        if 
+000010f0: 6c65 6e28 7374 6174 656d 656e 7473 2920  len(statements) 
+00001100: 213d 2031 3a0d 0a20 2020 2020 2020 2020  != 1:..         
+00001110: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00001120: 726f 7228 6622 7175 6572 7920 636f 6e74  ror(f"query cont
+00001130: 6169 6e73 207b 6c65 6e28 7374 6174 656d  ains {len(statem
+00001140: 656e 7473 297d 2073 7461 7465 6d65 6e74  ents)} statement
+00001150: 7322 290d 0a0d 0a20 2020 2020 2020 2023  s")....        #
+00001160: 2047 6574 2066 6972 7374 2044 4d4c 206b   Get first DML k
+00001170: 6579 776f 7264 0d0a 2020 2020 2020 2020  eyword..        
+00001180: 646d 6c5f 6b65 7977 6f72 6420 3d20 4e6f  dml_keyword = No
+00001190: 6e65 0d0a 2020 2020 2020 2020 646d 6c5f  ne..        dml_
+000011a0: 6b65 7977 6f72 645f 696e 6465 7820 3d20  keyword_index = 
+000011b0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6f72  None..        or
+000011c0: 6465 725f 6279 5f69 6e64 6578 203d 204e  der_by_index = N
+000011d0: 6f6e 650d 0a20 2020 2020 2020 2066 6f72  one..        for
+000011e0: 2069 2c20 746f 6b65 6e20 696e 2065 6e75   i, token in enu
+000011f0: 6d65 7261 7465 2873 7461 7465 6d65 6e74  merate(statement
+00001200: 735b 305d 2e74 6f6b 656e 7329 3a0d 0a20  s[0].tokens):.. 
+00001210: 2020 2020 2020 2020 2020 2069 6620 746f             if to
+00001220: 6b65 6e2e 7474 7970 6520 3d3d 2073 716c  ken.ttype == sql
+00001230: 7061 7273 652e 746f 6b65 6e73 2e44 4d4c  parse.tokens.DML
+00001240: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00001250: 2020 2069 6620 646d 6c5f 6b65 7977 6f72     if dml_keywor
+00001260: 6420 6973 204e 6f6e 653a 0d0a 2020 2020  d is None:..    
+00001270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001280: 646d 6c5f 6b65 7977 6f72 6420 3d20 7374  dml_keyword = st
+00001290: 7228 746f 6b65 6e29 2e75 7070 6572 2829  r(token).upper()
+000012a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000012b0: 2020 2020 2020 646d 6c5f 6b65 7977 6f72        dml_keywor
+000012c0: 645f 696e 6465 7820 3d20 690d 0a20 2020  d_index = i..   
+000012d0: 2020 2020 2020 2020 2065 6c69 6620 746f           elif to
+000012e0: 6b65 6e2e 7474 7970 6520 3d3d 2073 716c  ken.ttype == sql
+000012f0: 7061 7273 652e 746f 6b65 6e73 2e4b 6579  parse.tokens.Key
+00001300: 776f 7264 3a0d 0a20 2020 2020 2020 2020  word:..         
+00001310: 2020 2020 2020 2069 6620 6f72 6465 725f         if order_
+00001320: 6279 5f69 6e64 6578 2069 7320 4e6f 6e65  by_index is None
+00001330: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00001340: 2020 2020 2020 206b 6579 776f 7264 203d         keyword =
+00001350: 2073 7472 2874 6f6b 656e 292e 7570 7065   str(token).uppe
+00001360: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
+00001370: 2020 2020 2020 2020 2069 6620 6b65 7977           if keyw
+00001380: 6f72 6420 3d3d 2022 4f52 4445 5220 4259  ord == "ORDER BY
+00001390: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
+000013a0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+000013b0: 725f 6279 5f69 6e64 6578 203d 2069 0d0a  r_by_index = i..
+000013c0: 0d0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
+000013d0: 6b20 6966 2074 6865 2044 4d4c 206b 6579  k if the DML key
+000013e0: 776f 7264 2069 7320 5345 4c45 4354 0d0a  word is SELECT..
+000013f0: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
+00001400: 6d6c 5f6b 6579 776f 7264 3a0d 0a20 2020  ml_keyword:..   
+00001410: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00001420: 616c 7565 4572 726f 7228 6622 6e6f 2053  alueError(f"no S
+00001430: 454c 4543 5420 666f 756e 6420 2871 7565  ELECT found (que
+00001440: 7279 2064 6f65 7320 6e6f 7420 636f 6e74  ry does not cont
+00001450: 6169 6e20 444d 4c20 6b65 7977 6f72 6429  ain DML keyword)
+00001460: 2229 0d0a 2020 2020 2020 2020 6966 2064  ")..        if d
+00001470: 6d6c 5f6b 6579 776f 7264 2021 3d20 2753  ml_keyword != 'S
+00001480: 454c 4543 5427 3a0d 0a20 2020 2020 2020  ELECT':..       
+00001490: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000014a0: 4572 726f 7228 6622 6669 7273 7420 444d  Error(f"first DM
+000014b0: 4c20 6b65 7977 6f72 6420 6973 207b 646d  L keyword is {dm
+000014c0: 6c5f 6b65 7977 6f72 647d 2c20 6578 7065  l_keyword}, expe
+000014d0: 6374 6564 2053 454c 4543 5422 290d 0a0d  cted SELECT")...
+000014e0: 0a20 2020 2020 2020 2023 2047 6574 2070  .        # Get p
+000014f0: 6172 7420 6265 666f 7265 2053 454c 4543  art before SELEC
+00001500: 5420 2865 7861 6d70 6c65 3a20 5749 5448  T (example: WITH
+00001510: 290d 0a20 2020 2020 2020 2069 6620 646d  )..        if dm
+00001520: 6c5f 6b65 7977 6f72 645f 696e 6465 7820  l_keyword_index 
+00001530: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
+00001540: 2020 746f 6b65 6e73 203d 2073 7461 7465    tokens = state
+00001550: 6d65 6e74 735b 305d 2e74 6f6b 656e 735b  ments[0].tokens[
+00001560: 3a64 6d6c 5f6b 6579 776f 7264 5f69 6e64  :dml_keyword_ind
+00001570: 6578 5d0d 0a20 2020 2020 2020 2020 2020  ex]..           
+00001580: 206c 696d 6974 6564 5f71 7565 7279 203d   limited_query =
+00001590: 2027 272e 6a6f 696e 2873 7472 2874 6f6b   ''.join(str(tok
+000015a0: 656e 2920 666f 7220 746f 6b65 6e20 696e  en) for token in
+000015b0: 2074 6f6b 656e 7329 0d0a 2020 2020 2020   tokens)..      
+000015c0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000015d0: 2020 2020 206c 696d 6974 6564 5f71 7565       limited_que
+000015e0: 7279 203d 2027 270d 0a20 2020 200d 0a20  ry = ''..    .. 
+000015f0: 2020 2020 2020 2023 2041 7070 656e 6420         # Append 
+00001600: 5345 4c45 4354 2062 6566 6f72 6520 4f52  SELECT before OR
+00001610: 4445 5220 4259 0d0a 2020 2020 2020 2020  DER BY..        
+00001620: 6966 206f 7264 6572 5f62 795f 696e 6465  if order_by_inde
+00001630: 7820 6973 206e 6f74 204e 6f6e 653a 0d0a  x is not None:..
+00001640: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
+00001650: 6e73 203d 2073 7461 7465 6d65 6e74 735b  ns = statements[
+00001660: 305d 2e74 6f6b 656e 735b 646d 6c5f 6b65  0].tokens[dml_ke
+00001670: 7977 6f72 645f 696e 6465 783a 6f72 6465  yword_index:orde
+00001680: 725f 6279 5f69 6e64 6578 5d0d 0a20 2020  r_by_index]..   
+00001690: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000016a0: 2020 2020 2020 2020 746f 6b65 6e73 203d          tokens =
+000016b0: 2073 7461 7465 6d65 6e74 735b 305d 2e74   statements[0].t
+000016c0: 6f6b 656e 735b 646d 6c5f 6b65 7977 6f72  okens[dml_keywor
+000016d0: 645f 696e 6465 783a 5d0d 0a0d 0a20 2020  d_index:]....   
+000016e0: 2020 2020 206c 696d 6974 6564 5f71 7565       limited_que
+000016f0: 7279 202b 3d20 7365 6c66 2e5f 6c69 6d69  ry += self._limi
+00001700: 745f 7061 7273 6564 5f71 7565 7279 2827  t_parsed_query('
+00001710: 272e 6a6f 696e 2873 7472 2874 6f6b 656e  '.join(str(token
+00001720: 2920 666f 7220 746f 6b65 6e20 696e 2074  ) for token in t
+00001730: 6f6b 656e 7329 2c20 6c69 6d69 743d 6c69  okens), limit=li
+00001740: 6d69 7429 0d0a 0d0a 2020 2020 2020 2020  mit)....        
+00001750: 2320 4170 7065 6e64 204f 5244 4552 2042  # Append ORDER B
+00001760: 590d 0a20 2020 2020 2020 2069 6620 6f72  Y..        if or
+00001770: 6465 725f 6279 5f69 6e64 6578 2069 7320  der_by_index is 
+00001780: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00001790: 2020 2020 2020 2074 6f6b 656e 7320 3d20         tokens = 
+000017a0: 7374 6174 656d 656e 7473 5b30 5d2e 746f  statements[0].to
+000017b0: 6b65 6e73 5b6f 7264 6572 5f62 795f 696e  kens[order_by_in
+000017c0: 6465 783a 5d0d 0a20 2020 2020 2020 2020  dex:]..         
+000017d0: 2020 206c 696d 6974 6564 5f71 7565 7279     limited_query
+000017e0: 202b 3d20 275c 6e27 202b 2027 272e 6a6f   += '\n' + ''.jo
+000017f0: 696e 2873 7472 2874 6f6b 656e 2920 666f  in(str(token) fo
+00001800: 7220 746f 6b65 6e20 696e 2074 6f6b 656e  r token in token
+00001810: 7329 0d0a 0d0a 2020 2020 2020 2020 7265  s)....        re
+00001820: 7475 726e 206c 696d 6974 6564 5f71 7565  turn limited_que
+00001830: 7279 0d0a 2020 2020 0d0a 0d0a 2020 2020  ry..    ....    
+00001840: 6465 6620 5f6c 696d 6974 5f70 6172 7365  def _limit_parse
+00001850: 645f 7175 6572 7928 7365 6c66 2c20 7175  d_query(self, qu
+00001860: 6572 793a 2073 7472 2c20 6c69 6d69 743a  ery: str, limit:
+00001870: 2069 6e74 2920 2d3e 2073 7472 3a0d 0a20   int) -> str:.. 
+00001880: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
+00001890: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
+000018a0: 2829 0d0a 0d0a 0d0a 2020 2020 6465 6620  ()......    def 
+000018b0: 6275 696c 645f 7175 6572 795f 7769 7468  build_query_with
+000018c0: 5f70 6f73 6974 696f 6e61 6c5f 7061 7261  _positional_para
+000018d0: 6d73 2873 656c 662c 2071 7565 7279 3a20  ms(self, query: 
+000018e0: 7374 722c 2070 6172 616d 733a 206c 6973  str, params: lis
+000018f0: 747c 7475 706c 657c 6469 6374 293a 0d0a  t|tuple|dict):..
+00001900: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00001910: 7461 6e63 6528 7061 7261 6d73 2c20 6469  tance(params, di
+00001920: 6374 293a 0d0a 2020 2020 2020 2020 2020  ct):..          
+00001930: 2020 6672 6f6d 2073 716c 7061 7261 6d73    from sqlparams
+00001940: 2069 6d70 6f72 7420 5351 4c50 6172 616d   import SQLParam
+00001950: 7320 2320 6e6f 7420 6174 2074 6865 2074  s # not at the t
+00001960: 6f70 2062 6563 6175 7365 2074 6865 2065  op because the e
+00001970: 6e64 7573 6572 206d 6967 6874 206e 6f74  nduser might not
+00001980: 206e 6565 6420 7468 6973 2066 6561 7475   need this featu
+00001990: 7265 0d0a 0d0a 2020 2020 2020 2020 2020  re....          
+000019a0: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+000019b0: 2873 656c 662e 5f5f 636c 6173 735f 5f2c  (self.__class__,
+000019c0: 2027 5f70 6172 616d 735f 666f 726d 6174   '_params_format
+000019d0: 7465 7227 293a 0d0a 2020 2020 2020 2020  ter'):..        
+000019e0: 2020 2020 2020 2020 7365 6c66 2e5f 5f63          self.__c
+000019f0: 6c61 7373 5f5f 2e5f 7061 7261 6d73 5f66  lass__._params_f
+00001a00: 6f72 6d61 7474 6572 203d 2053 514c 5061  ormatter = SQLPa
+00001a10: 7261 6d73 2827 6e61 6d65 6427 2c20 2771  rams('named', 'q
+00001a20: 6d61 726b 2729 0d0a 2020 2020 2020 2020  mark')..        
+00001a30: 2020 2020 7175 6572 792c 2070 6172 616d      query, param
+00001a40: 7320 3d20 7365 6c66 2e5f 5f63 6c61 7373  s = self.__class
+00001a50: 5f5f 2e5f 7061 7261 6d73 5f66 6f72 6d61  __._params_forma
+00001a60: 7474 6572 2e66 6f72 6d61 7428 7175 6572  tter.format(quer
+00001a70: 792c 2070 6172 616d 7329 0d0a 0d0a 2020  y, params)....  
+00001a80: 2020 2020 2020 7265 7475 726e 2071 7565        return que
+00001a90: 7279 2c20 7061 7261 6d73 0d0a 2020 2020  ry, params..    
+00001aa0: 2020 2020 0d0a 0d0a 2020 2020 6465 6620      ....    def 
+00001ab0: 6765 745f 6375 7273 6f72 5f63 6f6c 756d  get_cursor_colum
+00001ac0: 6e73 2873 656c 662c 2063 7572 736f 723a  ns(self, cursor:
+00001ad0: 2054 5f43 7572 736f 7229 202d 3e20 6c69   T_Cursor) -> li
+00001ae0: 7374 5b43 6f6c 756d 6e5d 3a0d 0a20 2020  st[Column]:..   
+00001af0: 2020 2020 2063 6f6c 756d 6e73 203d 205b       columns = [
+00001b00: 5d0d 0a0d 0a20 2020 2020 2020 2066 6f72  ]....        for
+00001b10: 2069 2c20 696e 666f 2069 6e20 656e 756d   i, info in enum
+00001b20: 6572 6174 6528 6375 7273 6f72 2e64 6573  erate(cursor.des
+00001b30: 6372 6970 7469 6f6e 293a 0d0a 2020 2020  cription):..    
+00001b40: 2020 2020 2020 2020 6e61 6d65 2c20 7079          name, py
+00001b50: 7468 6f6e 5f74 7970 652c 2064 6973 706c  thon_type, displ
+00001b60: 6179 5f73 697a 652c 2069 6e74 6572 6e61  ay_size, interna
+00001b70: 6c5f 7369 7a65 2c20 7072 6563 6973 696f  l_size, precisio
+00001b80: 6e2c 2073 6361 6c65 2c20 6e75 6c6c 5f6f  n, scale, null_o
+00001b90: 6b20 3d20 696e 666f 0d0a 2020 2020 2020  k = info..      
+00001ba0: 2020 2020 2020 636f 6c75 6d6e 203d 2043        column = C
+00001bb0: 6f6c 756d 6e28 6e61 6d65 2c20 706f 7369  olumn(name, posi
+00001bc0: 7469 6f6e 3d69 202b 2031 2c20 7079 7468  tion=i + 1, pyth
+00001bd0: 6f6e 5f74 7970 653d 7079 7468 6f6e 5f74  on_type=python_t
+00001be0: 7970 652c 2064 6973 706c 6179 5f73 697a  ype, display_siz
+00001bf0: 653d 6469 7370 6c61 795f 7369 7a65 2c20  e=display_size, 
+00001c00: 696e 7465 726e 616c 5f73 697a 653d 696e  internal_size=in
+00001c10: 7465 726e 616c 5f73 697a 652c 2070 7265  ternal_size, pre
+00001c20: 6369 7369 6f6e 3d70 7265 6369 7369 6f6e  cision=precision
+00001c30: 2c20 7363 616c 653d 7363 616c 652c 206e  , scale=scale, n
+00001c40: 756c 6c5f 6f6b 3d6e 756c 6c5f 6f6b 290d  ull_ok=null_ok).
+00001c50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00001c60: 662e 5f66 6978 5f63 7572 736f 725f 636f  f._fix_cursor_co
+00001c70: 6c75 6d6e 5f64 6566 696e 6974 696f 6e28  lumn_definition(
+00001c80: 636f 6c75 6d6e 290d 0a20 2020 2020 2020  column)..       
+00001c90: 2020 2020 2063 6f6c 756d 6e2e 5f63 6865       column._che
+00001ca0: 636b 2829 0d0a 2020 2020 2020 2020 2020  ck()..          
+00001cb0: 2020 636f 6c75 6d6e 732e 6170 7065 6e64    columns.append
+00001cc0: 2863 6f6c 756d 6e29 0d0a 2020 2020 2020  (column)..      
+00001cd0: 2020 0d0a 2020 2020 2020 2020 7265 7475    ..        retu
+00001ce0: 726e 2063 6f6c 756d 6e73 0d0a 0d0a 0d0a  rn columns......
+00001cf0: 2020 2020 6465 6620 5f66 6978 5f63 7572      def _fix_cur
+00001d00: 736f 725f 636f 6c75 6d6e 5f64 6566 696e  sor_column_defin
+00001d10: 6974 696f 6e28 7365 6c66 2c20 636f 6c75  ition(self, colu
+00001d20: 6d6e 3a20 436f 6c75 6d6e 293a 0d0a 2020  mn: Column):..  
+00001d30: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00001d40: 2020 2046 6978 2061 2063 6f6c 756d 6e20     Fix a column 
+00001d50: 6465 6669 6e69 7469 6f6e 2c20 6166 7465  definition, afte
+00001d60: 7220 696e 7374 616e 6369 6174 696f 6e20  r instanciation 
+00001d70: 696e 2060 6765 745f 636f 6c75 6d6e 735f  in `get_columns_
+00001d80: 6672 6f6d 5f63 7572 736f 7260 2c20 666f  from_cursor`, fo
+00001d90: 7220 6120 7370 6563 6966 6963 2064 6174  r a specific dat
+00001da0: 6162 6173 6520 656e 6769 6e65 2e0d 0a20  abase engine... 
+00001db0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00001dc0: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
+00001dd0: 2020 0d0a 0d0a 2020 2020 6465 6620 6765    ....    def ge
+00001de0: 745f 6375 7273 6f72 5f63 6f6c 756d 6e5f  t_cursor_column_
+00001df0: 6e61 6d65 7328 7365 6c66 2c20 6375 7273  names(self, curs
+00001e00: 6f72 3a20 545f 4375 7273 6f72 2920 2d3e  or: T_Cursor) ->
+00001e10: 206c 6973 745b 7374 725d 3a0d 0a20 2020   list[str]:..   
+00001e20: 2020 2020 2072 6574 7572 6e20 5b69 6e66       return [inf
+00001e30: 6f5b 305d 2066 6f72 2069 6e66 6f20 696e  o[0] for info in
+00001e40: 2063 7572 736f 722e 6465 7363 7269 7074   cursor.descript
+00001e50: 696f 6e5d 0d0a 2020 2020 2020 2020 0d0a  ion]..        ..
+00001e60: 0d0a 2020 2020 6465 6620 6765 745f 7461  ..    def get_ta
+00001e70: 626c 655f 636f 6c75 6d6e 7328 7365 6c66  ble_columns(self
+00001e80: 2c20 7461 626c 653a 2073 7472 7c74 7570  , table: str|tup
+00001e90: 6c65 2920 2d3e 206c 6973 745b 436f 6c75  le) -> list[Colu
+00001ea0: 6d6e 5d3a 0d0a 2020 2020 2020 2020 7175  mn]:..        qu
+00001eb0: 6572 7920 3d20 7365 6c66 2e67 6574 5f73  ery = self.get_s
+00001ec0: 656c 6563 745f 7461 626c 655f 7175 6572  elect_table_quer
+00001ed0: 7928 7461 626c 652c 2073 6368 656d 615f  y(table, schema_
+00001ee0: 6f6e 6c79 3d54 7275 6529 0d0a 2020 2020  only=True)..    
+00001ef0: 2020 2020 7769 7468 2073 656c 662e 6578      with self.ex
+00001f00: 6563 7574 655f 6765 745f 6375 7273 6f72  ecute_get_cursor
+00001f10: 2871 7565 7279 2920 6173 2063 7572 736f  (query) as curso
+00001f20: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00001f30: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
+00001f40: 6375 7273 6f72 5f63 6f6c 756d 6e73 2863  cursor_columns(c
+00001f50: 7572 736f 7229 0d0a 0d0a 0d0a 2020 2020  ursor)......    
+00001f60: 6465 6620 6765 745f 7461 626c 655f 636f  def get_table_co
+00001f70: 6c75 6d6e 5f6e 616d 6573 2873 656c 662c  lumn_names(self,
+00001f80: 2074 6162 6c65 3a20 7374 727c 7475 706c   table: str|tupl
+00001f90: 6529 202d 3e20 6c69 7374 5b73 7472 5d3a  e) -> list[str]:
+00001fa0: 0d0a 2020 2020 2020 2020 636f 6c75 6d6e  ..        column
+00001fb0: 5f6e 616d 6573 203d 205b 5d0d 0a20 2020  _names = []..   
+00001fc0: 2020 2020 2066 6f72 2063 6f6c 756d 6e20       for column 
+00001fd0: 696e 2073 656c 662e 6765 745f 7461 626c  in self.get_tabl
+00001fe0: 655f 636f 6c75 6d6e 7328 7461 626c 6529  e_columns(table)
+00001ff0: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
+00002000: 6f6c 756d 6e5f 6e61 6d65 732e 6170 7065  olumn_names.appe
+00002010: 6e64 2863 6f6c 756d 6e2e 6e61 6d65 290d  nd(column.name).
+00002020: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00002030: 636f 6c75 6d6e 5f6e 616d 6573 0d0a 0d0a  column_names....
+00002040: 0d0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00002050: 6f64 0d0a 2020 2020 6465 6620 7370 6c69  od..    def spli
+00002060: 745f 6e61 6d65 2863 6c73 2c20 6675 6c6c  t_name(cls, full
+00002070: 5f6e 616d 653a 2073 7472 7c74 7570 6c65  _name: str|tuple
+00002080: 2920 2d3e 2074 7570 6c65 5b73 7472 2c73  ) -> tuple[str,s
+00002090: 7472 5d3a 0d0a 2020 2020 2020 2020 6966  tr]:..        if
+000020a0: 2069 7369 6e73 7461 6e63 6528 6675 6c6c   isinstance(full
+000020b0: 5f6e 616d 652c 2074 7570 6c65 293a 0d0a  _name, tuple):..
+000020c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000020d0: 726e 2066 756c 6c5f 6e61 6d65 0d0a 2020  rn full_name..  
+000020e0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000020f0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00002100: 2020 706f 7320 3d20 6675 6c6c 5f6e 616d    pos = full_nam
+00002110: 652e 696e 6465 7828 272e 2729 0d0a 2020  e.index('.')..  
+00002120: 2020 2020 2020 2020 2020 7363 6865 6d61            schema
+00002130: 5f6e 616d 6520 3d20 6675 6c6c 5f6e 616d  _name = full_nam
+00002140: 655b 303a 706f 735d 0d0a 2020 2020 2020  e[0:pos]..      
+00002150: 2020 2020 2020 6e61 6d65 203d 2066 756c        name = ful
+00002160: 6c5f 6e61 6d65 5b70 6f73 2b31 3a5d 0d0a  l_name[pos+1:]..
+00002170: 2020 2020 2020 2020 6578 6365 7074 2056          except V
+00002180: 616c 7565 4572 726f 723a 0d0a 2020 2020  alueError:..    
+00002190: 2020 2020 2020 2020 7363 6865 6d61 5f6e          schema_n
+000021a0: 616d 6520 3d20 636c 732e 6465 6661 756c  ame = cls.defaul
+000021b0: 745f 7363 6865 6d61 5f6e 616d 650d 0a20  t_schema_name.. 
+000021c0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+000021d0: 3d20 6675 6c6c 5f6e 616d 650d 0a0d 0a20  = full_name.... 
+000021e0: 2020 2020 2020 2072 6574 7572 6e20 2873         return (s
+000021f0: 6368 656d 615f 6e61 6d65 2c20 6e61 6d65  chema_name, name
+00002200: 290d 0a20 2020 200d 0a0d 0a20 2020 2064  )..    ....    d
+00002210: 6566 2067 6574 5f73 656c 6563 745f 7461  ef get_select_ta
+00002220: 626c 655f 7175 6572 7928 7365 6c66 2c20  ble_query(self, 
+00002230: 7461 626c 653a 2073 7472 7c74 7570 6c65  table: str|tuple
+00002240: 2c20 7363 6865 6d61 5f6f 6e6c 7920 3d20  , schema_only = 
+00002250: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+00002260: 2022 2222 0d0a 2020 2020 2020 2020 4275   """..        Bu
+00002270: 696c 6420 6120 7175 6572 7920 6f6e 2074  ild a query on t
+00002280: 6865 2067 6976 656e 2074 6162 6c65 2e0d  he given table..
+00002290: 0a0d 0a20 2020 2020 2020 2049 6620 6073  ...        If `s
+000022a0: 6368 656d 615f 6f6e 6c79 6020 6973 2067  chema_only` is g
+000022b0: 6976 656e 2c20 6e6f 2072 6f77 2077 696c  iven, no row wil
+000022c0: 6c20 6265 2072 6574 7572 6e65 6420 2874  l be returned (t
+000022d0: 6869 7320 6973 2075 7365 6420 746f 2067  his is used to g
+000022e0: 6574 2069 6e66 6f72 6d61 7469 6f6e 206f  et information o
+000022f0: 6e20 7468 6520 7461 626c 6529 2e0d 0a20  n the table)... 
+00002300: 2020 2020 2020 204f 7468 6572 7769 7365         Otherwise
+00002310: 2c20 616c 6c20 726f 7773 2077 696c 6c20  , all rows will 
+00002320: 6265 2072 6574 7572 6e65 642e 0d0a 0d0a  be returned.....
+00002330: 2020 2020 2020 2020 5468 6520 7265 7475          The retu
+00002340: 726e 2074 7970 6520 6f66 2074 6869 7320  rn type of this 
+00002350: 6675 6e63 7469 6f6e 2064 6570 656e 6473  function depends
+00002360: 206f 6e20 7468 6520 6461 7461 6261 7365   on the database
+00002370: 2065 6e67 696e 652e 0d0a 2020 2020 2020   engine...      
+00002380: 2020 4974 2069 7320 7061 7373 6564 2064    It is passed d
+00002390: 6972 6563 746c 7920 746f 2074 6865 2063  irectly to the c
+000023a0: 7572 736f 7227 7320 6578 6563 7574 6520  ursor's execute 
+000023b0: 6675 6e63 7469 6f6e 2066 6f72 2074 6869  function for thi
+000023c0: 7320 656e 6769 6e65 2e0d 0a20 2020 2020  s engine...     
+000023d0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+000023e0: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
+000023f0: 6e74 6564 4572 726f 7228 290d 0a20 2020  ntedError()..   
+00002400: 200d 0a0d 0a20 2020 2064 6566 2065 7865   ....    def exe
+00002410: 6375 7465 5f67 6574 5f63 7572 736f 7228  cute_get_cursor(
+00002420: 7365 6c66 2c20 7175 6572 793a 2073 7472  self, query: str
+00002430: 2c20 7061 7261 6d73 3a20 6c69 7374 7c74  , params: list|t
+00002440: 7570 6c65 7c64 6963 7420 3d20 4e6f 6e65  uple|dict = None
+00002450: 2c20 6c69 6d69 743a 2069 6e74 203d 204e  , limit: int = N
+00002460: 6f6e 6529 202d 3e20 545f 4375 7273 6f72  one) -> T_Cursor
+00002470: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00002480: 2020 2020 2020 2020 4d75 7374 2062 6520          Must be 
+00002490: 636c 6f73 6564 2e0d 0a20 2020 2020 2020  closed...       
+000024a0: 2022 2222 0d0a 2020 2020 2020 2020 7261   """..        ra
+000024b0: 6973 6520 4e6f 7449 6d70 6c65 6d65 6e74  ise NotImplement
+000024c0: 6564 4572 726f 7228 290d 0a20 2020 200d  edError()..    .
+000024d0: 0a0d 0a20 2020 2064 6566 2065 7865 6375  ...    def execu
+000024e0: 7465 5f67 6574 5f73 6361 6c61 7228 7365  te_get_scalar(se
+000024f0: 6c66 2c20 7175 6572 793a 2073 7472 2c20  lf, query: str, 
+00002500: 7061 7261 6d73 3a20 6c69 7374 7c74 7570  params: list|tup
+00002510: 6c65 7c64 6963 7420 3d20 4e6f 6e65 2c20  le|dict = None, 
+00002520: 6c69 6d69 743a 2069 6e74 203d 204e 6f6e  limit: int = Non
+00002530: 6529 3a0d 0a20 2020 2020 2020 2077 6974  e):..        wit
+00002540: 6820 7365 6c66 2e65 7865 6375 7465 5f67  h self.execute_g
+00002550: 6574 5f63 7572 736f 7228 7175 6572 792c  et_cursor(query,
+00002560: 2070 6172 616d 732c 206c 696d 6974 3d6c   params, limit=l
+00002570: 696d 6974 2920 6173 2063 7572 736f 723a  imit) as cursor:
+00002580: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00002590: 7375 6c74 203d 206e 6578 7428 6375 7273  sult = next(curs
+000025a0: 6f72 290d 0a20 2020 2020 2020 2020 2020  or)..           
+000025b0: 200d 0a20 2020 2020 2020 2020 2020 2023   ..            #
+000025c0: 2043 6865 636b 206f 6e6c 7920 6f6e 6520   Check only one 
+000025d0: 726f 770d 0a20 2020 2020 2020 2020 2020  row..           
+000025e0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+000025f0: 2020 2020 2020 206e 6578 7428 6375 7273         next(curs
+00002600: 6f72 290d 0a20 2020 2020 2020 2020 2020  or)..           
+00002610: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00002620: 4572 726f 7228 6622 7365 7665 7261 6c20  Error(f"several 
+00002630: 726f 7773 2072 6574 7572 6e65 6420 6279  rows returned by
+00002640: 2071 7565 7279 2229 0d0a 2020 2020 2020   query")..      
+00002650: 2020 2020 2020 6578 6365 7074 2053 746f        except Sto
+00002660: 7049 7465 7261 7469 6f6e 3a0d 0a20 2020  pIteration:..   
+00002670: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00002680: 730d 0a0d 0a20 2020 2020 2020 2020 2020  s....           
+00002690: 2023 2043 6865 636b 206f 6e6c 7920 6f6e   # Check only on
+000026a0: 6520 7661 6c75 650d 0a20 2020 2020 2020  e value..       
+000026b0: 2020 2020 2069 6620 6c65 6e28 7265 7375       if len(resu
+000026c0: 6c74 2920 3e20 313a 0d0a 2020 2020 2020  lt) > 1:..      
+000026d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000026e0: 5661 6c75 6545 7272 6f72 2822 7365 7665  ValueError("seve
+000026f0: 7261 6c20 7661 6c75 6573 2072 6574 7572  ral values retur
+00002700: 6e65 6420 6279 2071 7565 7279 2229 0d0a  ned by query")..
+00002710: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00002720: 7475 726e 2072 6573 756c 745b 305d 0d0a  turn result[0]..
+00002730: 0d0a 0d0a 2020 2020 6465 6620 6578 6563  ....    def exec
+00002740: 7574 6528 7365 6c66 2c20 7175 6572 793a  ute(self, query:
+00002750: 2073 7472 2c20 7061 7261 6d73 3a20 6c69   str, params: li
+00002760: 7374 7c74 7570 6c65 7c64 6963 7420 3d20  st|tuple|dict = 
+00002770: 4e6f 6e65 2c20 6c69 6d69 743a 2069 6e74  None, limit: int
+00002780: 203d 204e 6f6e 6529 3a0d 0a20 2020 2020   = None):..     
+00002790: 2020 2077 6974 6820 7365 6c66 2e65 7865     with self.exe
+000027a0: 6375 7465 5f67 6574 5f63 7572 736f 7228  cute_get_cursor(
+000027b0: 7175 6572 792c 2070 6172 616d 732c 206c  query, params, l
+000027c0: 696d 6974 3d6c 696d 6974 293a 0d0a 2020  imit=limit):..  
+000027d0: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
+000027e0: 0d0a 0d0a 2020 2020 6465 6620 6578 6563  ....    def exec
+000027f0: 7574 655f 6669 6c65 2873 656c 662c 2070  ute_file(self, p
+00002800: 6174 683a 2073 7472 7c50 6174 682c 2070  ath: str|Path, p
+00002810: 6172 616d 733a 206c 6973 747c 7475 706c  arams: list|tupl
+00002820: 657c 6469 6374 203d 204e 6f6e 652c 206c  e|dict = None, l
+00002830: 696d 6974 3a20 696e 7420 3d20 4e6f 6e65  imit: int = None
+00002840: 293a 0d0a 2020 2020 2020 2020 6966 206e  ):..        if n
+00002850: 6f74 2069 7369 6e73 7461 6e63 6528 7061  ot isinstance(pa
+00002860: 7468 2c20 5061 7468 293a 0d0a 2020 2020  th, Path):..    
+00002870: 2020 2020 2020 2020 7061 7468 203d 2050          path = P
+00002880: 6174 6828 7061 7468 290d 0a20 2020 2020  ath(path)..     
+00002890: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000028a0: 2071 7565 7279 203d 2070 6174 682e 7265   query = path.re
+000028b0: 6164 5f74 6578 7428 656e 636f 6469 6e67  ad_text(encoding
+000028c0: 3d27 7574 662d 3827 290d 0a20 2020 2020  ='utf-8')..     
+000028d0: 2020 2073 656c 662e 6578 6563 7574 6528     self.execute(
+000028e0: 7175 6572 792c 2070 6172 616d 732c 206c  query, params, l
+000028f0: 696d 6974 3d6c 696d 6974 290d 0a0d 0a0d  imit=limit).....
+00002900: 0a20 2020 2064 6566 2063 616c 6c5f 7072  .    def call_pr
+00002910: 6f63 6564 7572 6528 7365 6c66 2c20 6e61  ocedure(self, na
+00002920: 6d65 3a20 7374 727c 7475 706c 652c 202a  me: str|tuple, *
+00002930: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00002940: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
+00002950: 6e74 6564 4572 726f 7228 290d 0a0d 0a0d  ntedError().....
+00002960: 0a20 2020 2064 6566 2074 6162 6c65 5f65  .    def table_e
+00002970: 7869 7374 7328 7365 6c66 2c20 7461 626c  xists(self, tabl
+00002980: 653a 2073 7472 7c74 7570 6c65 2920 2d3e  e: str|tuple) ->
+00002990: 2062 6f6f 6c3a 0d0a 2020 2020 2020 2020   bool:..        
+000029a0: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
+000029b0: 6e74 6564 4572 726f 7228 290d 0a0d 0a0d  ntedError().....
+000029c0: 0a20 2020 2064 6566 2074 7275 6e63 6174  .    def truncat
+000029d0: 655f 7461 626c 6528 7365 6c66 2c20 7461  e_table(self, ta
+000029e0: 626c 653a 2073 7472 7c74 7570 6c65 293a  ble: str|tuple):
+000029f0: 0d0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
+00002a00: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
+00002a10: 726f 7228 290d 0a0d 0a0d 0a20 2020 2064  ror()......    d
+00002a20: 6566 2063 6f70 795f 6672 6f6d 5f63 7376  ef copy_from_csv
+00002a30: 2873 656c 662c 2066 703a 2049 4f42 6173  (self, fp: IOBas
+00002a40: 652c 2074 6162 6c65 3a20 7374 727c 7475  e, table: str|tu
+00002a50: 706c 652c 2063 6f6c 756d 6e73 3a20 6c69  ple, columns: li
+00002a60: 7374 5b73 7472 5d20 3d20 4e6f 6e65 2c20  st[str] = None, 
+00002a70: 6465 6c69 6d69 7465 723a 2073 7472 203d  delimiter: str =
+00002a80: 204e 6f6e 652c 2071 756f 7465 6368 6172   None, quotechar
+00002a90: 3a20 7374 7220 3d20 2722 272c 206e 756c  : str = '"', nul
+00002aa0: 6c63 6861 723a 2073 7472 203d 2027 272c  lchar: str = '',
+00002ab0: 206e 6f68 6561 6465 723a 2062 6f6f 6c20   noheader: bool 
+00002ac0: 3d20 4661 6c73 6529 3a0d 0a20 2020 2020  = False):..     
+00002ad0: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
+00002ae0: 656d 656e 7465 6445 7272 6f72 2829 0d0a  ementedError()..
+00002af0: 2020 2020 0d0a 0d0a 2020 2020 6465 6620      ....    def 
+00002b00: 6465 706c 6f79 5f73 716c 2873 656c 662c  deploy_sql(self,
+00002b10: 202a 7061 7468 733a 2050 6174 687c 7374   *paths: Path|st
+00002b20: 722c 2065 6e63 6f64 696e 6720 3d20 2275  r, encoding = "u
+00002b30: 7466 2d38 2229 3a0d 0a20 2020 2020 2020  tf-8"):..       
+00002b40: 2061 6374 7561 6c5f 7061 7468 733a 206c   actual_paths: l
+00002b50: 6973 745b 5061 7468 5d20 3d20 5b5d 0d0a  ist[Path] = []..
+00002b60: 2020 2020 2020 2020 666f 7220 7061 7468          for path
+00002b70: 2069 6e20 7061 7468 733a 0d0a 2020 2020   in paths:..    
+00002b80: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00002b90: 7461 6e63 6528 7061 7468 2c20 7374 7229  tance(path, str)
+00002ba0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00002bb0: 2020 2070 6174 6820 3d20 5061 7468 2870     path = Path(p
+00002bc0: 6174 6829 0d0a 2020 2020 2020 2020 2020  ath)..          
+00002bd0: 2020 6163 7475 616c 5f70 6174 6873 2e61    actual_paths.a
+00002be0: 7070 656e 6428 7061 7468 290d 0a0d 0a20  ppend(path).... 
+00002bf0: 2020 2020 2020 2061 6374 7561 6c5f 7061         actual_pa
+00002c00: 7468 732e 736f 7274 2829 0d0a 0d0a 2020  ths.sort()....  
+00002c10: 2020 2020 2020 666f 7220 7061 7468 2069        for path i
+00002c20: 6e20 6163 7475 616c 5f70 6174 6873 3a0d  n actual_paths:.
+00002c30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002c40: 7061 7468 2e69 735f 6469 7228 293a 0d0a  path.is_dir():..
+00002c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c60: 7375 6270 6174 6873 203d 2073 6f72 7465  subpaths = sorte
+00002c70: 6428 7061 7468 2e69 7465 7264 6972 2829  d(path.iterdir()
+00002c80: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00002c90: 2020 2073 656c 662e 6465 706c 6f79 5f73     self.deploy_s
+00002ca0: 716c 282a 7375 6270 6174 6873 2c20 656e  ql(*subpaths, en
+00002cb0: 636f 6469 6e67 3d65 6e63 6f64 696e 6729  coding=encoding)
+00002cc0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00002cd0: 656c 6966 206e 6f74 2070 6174 682e 6e61  elif not path.na
+00002ce0: 6d65 2e65 6e64 7377 6974 6828 222e 7371  me.endswith(".sq
+00002cf0: 6c22 293a 0d0a 2020 2020 2020 2020 2020  l"):..          
+00002d00: 2020 2020 2020 636f 6e74 696e 7565 2023        continue #
+00002d10: 2069 676e 6f72 650d 0a0d 0a20 2020 2020   ignore....     
+00002d20: 2020 2020 2020 2065 6c69 6620 7061 7468         elif path
+00002d30: 2e6e 616d 652e 656e 6473 7769 7468 2822  .name.endswith("
+00002d40: 5f72 6576 6572 742e 7371 6c22 293a 0d0a  _revert.sql"):..
+00002d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d60: 636f 6e74 696e 7565 2023 2069 676e 6f72  continue # ignor
+00002d70: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+00002d80: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00002d90: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
+00002da0: 6e66 6f28 2265 7865 6375 7465 2025 7322  nfo("execute %s"
+00002db0: 2c20 7061 7468 290d 0a20 2020 2020 2020  , path)..       
+00002dc0: 2020 2020 2020 2020 2071 7565 7279 203d           query =
+00002dd0: 2070 6174 682e 7265 6164 5f74 6578 7428   path.read_text(
+00002de0: 656e 636f 6469 6e67 3d65 6e63 6f64 696e  encoding=encodin
+00002df0: 6729 0d0a 2020 2020 2020 2020 2020 2020  g)..            
+00002e00: 2020 2020 7365 6c66 2e65 7865 6375 7465      self.execute
+00002e10: 2871 7565 7279 290d 0a0d 0a0d 0a20 2020  (query)......   
+00002e20: 2064 6566 2072 6576 6572 745f 7371 6c28   def revert_sql(
+00002e30: 7365 6c66 2c20 2a70 6174 6873 3a20 5061  self, *paths: Pa
+00002e40: 7468 7c73 7472 2c20 656e 636f 6469 6e67  th|str, encoding
+00002e50: 203d 2022 7574 662d 3822 293a 0d0a 2020   = "utf-8"):..  
+00002e60: 2020 2020 2020 6163 7475 616c 5f70 6174        actual_pat
+00002e70: 6873 3a20 6c69 7374 5b50 6174 685d 203d  hs: list[Path] =
+00002e80: 205b 5d0d 0a20 2020 2020 2020 2066 6f72   []..        for
+00002e90: 2070 6174 6820 696e 2070 6174 6873 3a0d   path in paths:.
+00002ea0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002eb0: 6973 696e 7374 616e 6365 2870 6174 682c  isinstance(path,
+00002ec0: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
+00002ed0: 2020 2020 2020 2020 7061 7468 203d 2050          path = P
+00002ee0: 6174 6828 7061 7468 290d 0a20 2020 2020  ath(path)..     
+00002ef0: 2020 2020 2020 2061 6374 7561 6c5f 7061         actual_pa
+00002f00: 7468 732e 6170 7065 6e64 2870 6174 6829  ths.append(path)
+00002f10: 0d0a 0d0a 2020 2020 2020 2020 6163 7475  ....        actu
+00002f20: 616c 5f70 6174 6873 2e73 6f72 7428 7265  al_paths.sort(re
+00002f30: 7665 7273 653d 5472 7565 290d 0a0d 0a20  verse=True).... 
+00002f40: 2020 2020 2020 2066 6f72 2070 6174 6820         for path 
+00002f50: 696e 2061 6374 7561 6c5f 7061 7468 733a  in actual_paths:
+00002f60: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00002f70: 2070 6174 682e 6973 5f64 6972 2829 3a0d   path.is_dir():.
+00002f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002f90: 2073 7562 7061 7468 7320 3d20 736f 7274   subpaths = sort
+00002fa0: 6564 2870 6174 682e 6974 6572 6469 7228  ed(path.iterdir(
+00002fb0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00002fc0: 2020 2020 7365 6c66 2e72 6576 6572 745f      self.revert_
+00002fd0: 7371 6c28 2a73 7562 7061 7468 732c 2065  sql(*subpaths, e
+00002fe0: 6e63 6f64 696e 673d 656e 636f 6469 6e67  ncoding=encoding
+00002ff0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00003000: 2065 6c69 6620 6e6f 7420 7061 7468 2e6e   elif not path.n
+00003010: 616d 652e 656e 6473 7769 7468 2822 5f72  ame.endswith("_r
+00003020: 6576 6572 742e 7371 6c22 293a 0d0a 2020  evert.sql"):..  
+00003030: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00003040: 6e74 696e 7565 2023 2069 676e 6f72 650d  ntinue # ignore.
+00003050: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
+00003060: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00003070: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+00003080: 6f28 2265 7865 6375 7465 2025 7322 2c20  o("execute %s", 
+00003090: 7061 7468 290d 0a20 2020 2020 2020 2020  path)..         
+000030a0: 2020 2020 2020 2071 7565 7279 203d 2070         query = p
+000030b0: 6174 682e 7265 6164 5f74 6578 7428 656e  ath.read_text(en
+000030c0: 636f 6469 6e67 3d65 6e63 6f64 696e 6729  coding=encoding)
+000030d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000030e0: 2020 7365 6c66 2e65 7865 6375 7465 2871    self.execute(q
+000030f0: 7565 7279 290d 0a0d 0a0d 0a63 6c61 7373  uery)......class
+00003100: 2043 6f6c 756d 6e3a 0d0a 2020 2020 6465   Column:..    de
+00003110: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00003120: 206e 616d 653a 2073 7472 2c20 2a2c 2070   name: str, *, p
+00003130: 6f73 6974 696f 6e3a 2069 6e74 203d 204e  osition: int = N
+00003140: 6f6e 652c 2070 7974 686f 6e5f 7479 7065  one, python_type
+00003150: 3a20 7479 7065 203d 204e 6f6e 652c 206f  : type = None, o
+00003160: 7269 6769 6e61 6c5f 7479 7065 3a20 7374  riginal_type: st
+00003170: 7220 3d20 4e6f 6e65 2c20 7072 6563 6973  r = None, precis
+00003180: 696f 6e3a 2069 6e74 203d 204e 6f6e 652c  ion: int = None,
+00003190: 2073 6361 6c65 3a20 696e 7420 3d20 4e6f   scale: int = No
+000031a0: 6e65 2c20 6e75 6c6c 5f6f 6b3a 2062 6f6f  ne, null_ok: boo
+000031b0: 6c20 3d20 4e6f 6e65 2c20 6469 7370 6c61  l = None, displa
+000031c0: 795f 7369 7a65 3a20 696e 7420 3d20 4e6f  y_size: int = No
+000031d0: 6e65 2c20 696e 7465 726e 616c 5f73 697a  ne, internal_siz
+000031e0: 653a 2069 6e74 203d 204e 6f6e 652c 2070  e: int = None, p
+000031f0: 7269 6d61 7279 5f6b 6579 3a20 626f 6f6c  rimary_key: bool
+00003200: 203d 2046 616c 7365 2c20 6465 6661 756c   = False, defaul
+00003210: 743a 2073 7472 203d 204e 6f6e 6529 3a0d  t: str = None):.
+00003220: 0a20 2020 2020 2020 2073 656c 662e 6e61  .        self.na
+00003230: 6d65 3a20 7374 727c 4e6f 6e65 203d 206e  me: str|None = n
+00003240: 616d 650d 0a20 2020 2020 2020 2022 2222  ame..        """
+00003250: 204e 6f6d 2064 6520 6c61 2063 6f6c 6f6e   Nom de la colon
+00003260: 6e65 2e20 5065 7574 20c3 aa74 7265 2076  ne. Peut ..tre v
+00003270: 6964 6520 2870 6172 2065 7865 6d70 6c65  ide (par exemple
+00003280: 2070 6f75 7220 6c65 7320 636f 6c6f 6e6e   pour les colonn
+00003290: 6573 2063 616c 6375 6cc3 a965 7320 7361  es calcul..es sa
+000032a0: 6e73 2061 6c69 6173 2064 c3a9 6669 6e69  ns alias d..fini
+000032b0: 292e 2022 2222 0d0a 0d0a 2020 2020 2020  ). """....      
+000032c0: 2020 7365 6c66 2e70 6f73 6974 696f 6e3a    self.position:
+000032d0: 2069 6e74 7c4e 6f6e 6520 3d20 706f 7369   int|None = posi
+000032e0: 7469 6f6e 0d0a 2020 2020 2020 2020 2222  tion..        ""
+000032f0: 2220 4f72 6469 6e61 6c20 706f 7369 7469  " Ordinal positi
+00003300: 6f6e 2c20 7374 6172 7469 6e67 2066 726f  on, starting fro
+00003310: 6d20 312e 2022 2222 0d0a 0d0a 2020 2020  m 1. """....    
+00003320: 2020 2020 7365 6c66 2e70 7974 686f 6e5f      self.python_
+00003330: 7479 7065 3a20 7479 7065 7c4e 6f6e 6520  type: type|None 
+00003340: 3d20 7079 7468 6f6e 5f74 7970 650d 0a20  = python_type.. 
+00003350: 2020 2020 2020 2022 2222 2054 7970 6520         """ Type 
+00003360: 5079 7468 6f6e 2075 7469 6c69 73c3 a920  Python utilis.. 
+00003370: 7061 7220 6c65 2064 7269 7665 7220 706f  par le driver po
+00003380: 7572 2072 6570 72c3 a973 656e 7465 7220  ur repr..senter 
+00003390: 6c65 7320 7661 6c65 7572 732e 0d0a 2020  les valeurs...  
+000033a0: 2020 2020 2020 4174 7465 6e74 696f 6e20        Attention 
+000033b0: 3a20 6c65 7320 7661 6c65 7572 7320 6465  : les valeurs de
+000033c0: 2074 7970 6520 5351 4c20 4441 5445 206f   type SQL DATE o
+000033d0: 7520 4441 5445 5449 4d45 2070 6575 7665  u DATETIME peuve
+000033e0: 6e74 20c3 aa74 7265 206d 6170 70c3 a965  nt ..tre mapp..e
+000033f0: 7320 6175 2074 7970 6520 5079 7468 6f6e  s au type Python
+00003400: 2060 7374 7260 2073 7569 7661 6e74 206c   `str` suivant l
+00003410: 6520 6472 6976 6572 2075 7469 6c69 73c3  e driver utilis.
+00003420: a92e 2022 2222 0d0a 2020 2020 2020 2020  .. """..        
+00003430: 2320 4366 2e20 6874 7470 733a 2f2f 7374  # Cf. https://st
+00003440: 6163 6b6f 7665 7266 6c6f 772e 636f 6d2f  ackoverflow.com/
+00003450: 7175 6573 7469 6f6e 732f 3731 3732 3534  questions/717254
+00003460: 302f 7079 6f64 6263 2d72 6574 7572 6e73  0/pyodbc-returns
+00003470: 2d73 716c 2d73 6572 7665 722d 6461 7465  -sql-server-date
+00003480: 2d66 6965 6c64 732d 6173 2d73 7472 696e  -fields-as-strin
+00003490: 6773 0d0a 0d0a 2020 2020 2020 2020 7365  gs....        se
+000034a0: 6c66 2e6f 7269 6769 6e61 6c5f 7479 7065  lf.original_type
+000034b0: 3a20 7374 727c 4e6f 6e65 203d 206f 7269  : str|None = ori
+000034c0: 6769 6e61 6c5f 7479 7065 0d0a 0d0a 2020  ginal_type....  
+000034d0: 2020 2020 2020 7365 6c66 2e70 7265 6369        self.preci
+000034e0: 7369 6f6e 3a20 696e 747c 4e6f 6e65 203d  sion: int|None =
+000034f0: 2070 7265 6369 7369 6f6e 0d0a 2020 2020   precision..    
+00003500: 2020 2020 2222 2220 546f 7461 6c20 6e75      """ Total nu
+00003510: 6d62 6572 206f 6620 7369 676e 6966 6963  mber of signific
+00003520: 616e 7420 6469 6769 7473 2e0d 0a20 2020  ant digits...   
+00003530: 2020 2020 202d 206d 7373 716c 3a20 616c       - mssql: al
+00003540: 7761 7973 2073 6574 2e20 2222 220d 0a20  ways set. """.. 
+00003550: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00003560: 2073 656c 662e 7363 616c 653a 2069 6e74   self.scale: int
+00003570: 7c4e 6f6e 6520 3d20 7363 616c 650d 0a20  |None = scale.. 
+00003580: 2020 2020 2020 2022 2222 2043 6f75 6e74         """ Count
+00003590: 206f 6620 6465 6369 6d61 6c20 6469 6769   of decimal digi
+000035a0: 7473 2069 6e20 7468 6520 6672 6163 7469  ts in the fracti
+000035b0: 6f6e 616c 2070 6172 7420 6f66 2074 6865  onal part of the
+000035c0: 2074 7970 652e 0d0a 2020 2020 2020 2020   type...        
+000035d0: 2d20 6d73 7371 6c3a 2061 6c77 6179 7320  - mssql: always 
+000035e0: 7365 742c 2075 7369 6e67 2030 2069 6620  set, using 0 if 
+000035f0: 6e6f 6e65 2e20 2222 220d 0a0d 0a20 2020  none. """....   
+00003600: 2020 2020 2073 656c 662e 6e75 6c6c 5f6f       self.null_o
+00003610: 6b3a 2062 6f6f 6c7c 4e6f 6e65 203d 206e  k: bool|None = n
+00003620: 756c 6c5f 6f6b 0d0a 2020 2020 2020 2020  ull_ok..        
+00003630: 2222 2220 496e 6469 6361 7465 2069 6620  """ Indicate if 
+00003640: 7468 6520 636f 6c75 6d6e 2061 6363 6570  the column accep
+00003650: 7473 206e 756c 6c20 7661 6c75 652e 0d0a  ts null value...
+00003660: 2020 2020 2020 2020 2d20 7067 3a20 616c          - pg: al
+00003670: 7761 7973 204e 6f6e 6520 6173 206e 6f74  ways None as not
+00003680: 2065 6173 7920 746f 2072 6574 7269 6576   easy to retriev
+00003690: 6520 6672 6f6d 2074 6865 206c 6962 7071  e from the libpq
+000036a0: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+000036b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+000036c0: 6973 706c 6179 5f73 697a 653a 2069 6e74  isplay_size: int
+000036d0: 7c4e 6f6e 6520 3d20 6469 7370 6c61 795f  |None = display_
+000036e0: 7369 7a65 0d0a 2020 2020 2020 2020 2222  size..        ""
+000036f0: 2220 5468 6520 6163 7475 616c 206c 656e  " The actual len
+00003700: 6774 6820 6f66 2074 6865 2063 6f6c 756d  gth of the colum
+00003710: 6e20 696e 2062 7974 6573 2e0d 0a20 2020  n in bytes...   
+00003720: 2020 2020 202d 206d 7373 716c 3a20 616c       - mssql: al
+00003730: 7761 7973 204e 6f6e 6520 286f 7269 6769  ways None (origi
+00003740: 6e61 6c6c 7920 616c 7761 7973 207a 6572  nally always zer
+00003750: 6f29 2e20 2222 220d 0a0d 0a20 2020 2020  o). """....     
+00003760: 2020 2073 656c 662e 696e 7465 726e 616c     self.internal
+00003770: 5f73 697a 653a 2069 6e74 7c4e 6f6e 6520  _size: int|None 
+00003780: 3d20 696e 7465 726e 616c 5f73 697a 650d  = internal_size.
+00003790: 0a20 2020 2020 2020 2022 2222 2054 6865  .        """ The
+000037a0: 2073 697a 6520 696e 2062 7974 6573 206f   size in bytes o
+000037b0: 6620 7468 6520 636f 6c75 6d6e 2061 7373  f the column ass
+000037c0: 6f63 6961 7465 6420 746f 2074 6869 7320  ociated to this 
+000037d0: 636f 6c75 6d6e 206f 6e20 7468 6520 7365  column on the se
+000037e0: 7276 6572 2e0d 0a20 2020 2020 2020 202d  rver...        -
+000037f0: 206d 7373 716c 3a20 616c 7761 7973 204e   mssql: always N
+00003800: 6f6e 6520 286f 7269 6769 6e61 6c6c 7920  one (originally 
+00003810: 616c 7761 7973 2073 616d 6520 6173 2070  always same as p
+00003820: 7265 6369 7369 6f6e 292e 2022 2222 0d0a  recision). """..
+00003830: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00003840: 7269 6d61 7279 5f6b 6579 3a20 626f 6f6c  rimary_key: bool
+00003850: 203d 2070 7269 6d61 7279 5f6b 6579 0d0a   = primary_key..
+00003860: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+00003870: 6566 6175 6c74 3a20 7374 727c 4e6f 6e65  efault: str|None
+00003880: 203d 2064 6566 6175 6c74 0d0a 0d0a 0d0a   = default......
+00003890: 2020 2020 6465 6620 5f63 6865 636b 2873      def _check(s
+000038a0: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
+000038b0: 2222 0d0a 2020 2020 2020 2020 456e 7375  ""..        Ensu
+000038c0: 7265 2063 6f6e 7369 7374 656e 6379 206f  re consistency o
+000038d0: 6620 636f 6c75 6d6e 2064 6566 696e 6974  f column definit
+000038e0: 696f 6e2e 0d0a 0d0a 2020 2020 2020 2020  ion.....        
+000038f0: 4361 6c6c 6564 2061 6674 6572 2063 7265  Called after cre
+00003900: 6174 696f 6e20 6f66 2043 6f6c 756d 6e20  ation of Column 
+00003910: 696e 7374 616e 6365 2061 6e64 2070 6f74  instance and pot
+00003920: 656e 7469 616c 2066 6978 2061 6461 7074  ential fix adapt
+00003930: 6564 2074 6f20 7370 6563 6966 6963 2044  ed to specific D
+00003940: 6174 6162 6173 6520 656e 6769 6e65 732e  atabase engines.
+00003950: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00003960: 2020 2020 2020 2069 6620 7365 6c66 2e70         if self.p
+00003970: 7974 686f 6e5f 7479 7065 2069 7320 6e6f  ython_type is no
+00003980: 7420 4e6f 6e65 2061 6e64 206e 6f74 2069  t None and not i
+00003990: 7369 6e73 7461 6e63 6528 7365 6c66 2e70  sinstance(self.p
+000039a0: 7974 686f 6e5f 7479 7065 2c20 7479 7065  ython_type, type
+000039b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000039c0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000039d0: 2866 2269 6e76 616c 6964 2070 7974 686f  (f"invalid pytho
+000039e0: 6e5f 7479 7065 205c 227b 7365 6c66 2e70  n_type \"{self.p
+000039f0: 7974 686f 6e5f 7479 7065 7d5c 2220 287b  ython_type}\" ({
+00003a00: 7479 7065 2873 656c 662e 7079 7468 6f6e  type(self.python
+00003a10: 5f74 7970 6529 2e5f 5f6e 616d 655f 5f7d  _type).__name__}
+00003a20: 293a 2065 7870 6563 7465 6420 7479 7065  ): expected type
+00003a30: 2069 6e73 7461 6e63 6522 290d 0a0d 0a0d   instance").....
+00003a40: 0a20 2020 2064 6566 205f 5f73 7472 5f5f  .    def __str__
+00003a50: 2873 656c 6629 202d 3e20 7374 723a 0d0a  (self) -> str:..
+00003a60: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00003a70: 656c 662e 6e61 6d65 0d0a                 elf.name..
```

## zut/inout/InDb.py

```diff
@@ -42,16 +42,14 @@
             logger.debug(f"execute {self.name} with params {self._params}, limit={self._limit}\n{Colors.CYAN}{self._query}{Colors.RESET}")
 
         # set in __enter__() -> _prepare():
         self._cursor = None
 
 
     def _prepare(self):
-        self.db.__enter__()
-
         self._cursor = self.db.execute_get_cursor(self._query, self._params, limit=self._limit)
 
         self.headers = self.db.get_cursor_column_names(self._cursor)
 
 
     def _get_next_values(self):
         cursor_row = next(self._cursor)
```

## zut/inout/InTable.py

```diff
@@ -1,28 +1,27 @@
 from __future__ import annotations
 
 import logging
 from datetime import datetime, timezone
 from pathlib import Path
 from time import time_ns
 from typing import Any, Callable
-from ..lang import Literal
 from ..tabular import Row
 from ..datetime import is_aware, make_aware
 from .utils import normalize_inout, get_inout_name
 
 logger = logging.getLogger(__name__)
 
 
 class InTable:
     @classmethod
     def is_available(cls):
         return True
     
-    def __init__(self, src, *, src_dir: str|Path|None = None, title: str|None = None, debug: bool = None, naive_tz: Literal['local']|timezone = 'local', formatters: dict[int|str,Callable] = None, **kwargs):
+    def __init__(self, src, *, src_dir: str|Path|None = None, title: str|None = None, debug: bool = None, naive_tz: timezone = 'local', formatters: dict[int|str,Callable] = None, **kwargs):
         if not self.is_available():
             raise ValueError(f"cannot use {type(self).__name__} (not available)")
 
         self.src = normalize_inout(src, dir=src_dir, title=title, **kwargs)
         self.name = get_inout_name(self.src)
 
         self._debug = debug
```

## zut/inout/OutCsv.py

```diff
@@ -1,31 +1,28 @@
 from __future__ import annotations
 import csv
 import logging
 from datetime import datetime
 from decimal import Decimal
-
 from io import IOBase
-import os
 from pathlib import Path
 from typing import Any, Iterable
-from ..lang import Literal
 from ..text import ValueString
-
 from ..numeric import get_default_decimal_separator
 from ..csv import get_csv_headers, get_default_csv_delimiter
+from .. import filesh
 from .OutTable import OutTable
 
 logger = logging.getLogger(__name__)
 
 
 class OutCsv(OutTable):
     file: IOBase
     
-    def __init__(self, out: str|Path|IOBase|Literal[False]|None = None, *, delimiter: str = None, quotechar: str = '"', decimal_separator: str = None, **kwargs):
+    def __init__(self, out: str|Path|IOBase|None = None, *, delimiter: str = None, quotechar: str = '"', decimal_separator: str = None, **kwargs):
         self._delimiter = delimiter
         if self._delimiter is None:
             self._delimiter = get_default_csv_delimiter()
 
         self._quotechar = quotechar
 
         self._decimal_separator = decimal_separator
@@ -41,15 +38,15 @@
     # OutTable subclassing
     #
     
     def _get_existing_headers(self) -> list[str]|None:
         if not self._append:
             return []  # file will be truncated
         
-        if not isinstance(self.out, str) or not os.path.exists(self.out):
+        if not isinstance(self.out, str) or not filesh.exists(self.out):
             return []  # we consider output as a new file
         
         # From now on, we append to an existing file
         existing_headers = get_csv_headers(self.out, encoding=self._encoding, delimiter=self._delimiter, quotechar=self._quotechar)
         if existing_headers is None:
             return []  # existing file is empty
```

## zut/inout/OutDb.py

```diff
@@ -27,23 +27,22 @@
         self.name = self.db.get_uri(table=(self.schema_name, self.table_name), with_password=False)
 
     # -------------------------------------------------------------------------
     # OutFile subclassing
     #
 
     def _open_file(self):
-        super()._open_file()
-
-        # Connect to database
-        self.db.__enter__()
+        existing_headers = super()._open_file()
 
         # Create, drop or truncate table
         if not self._append:
             logger.debug(f"truncate table %s.%s", self.schema_name, self.table_name)
             self.db.truncate_table((self.schema_name, self.table_name))
+
+        return existing_headers
                 
 
     def _close_file(self):
         if not self._headers:
             if self._row_count == 0:
                 return
             raise ValueError(f"cannot export rows to database: no headers")
```

## zut/inout/OutExcel.py

```diff
@@ -1,16 +1,15 @@
 from __future__ import annotations
 from datetime import datetime
 import logging
-import os
 from pathlib import Path
 from typing import Any, Iterable
+from .. import filesh
 from .OutTable import OutTable
 from .utils import get_inout_name, split_excel_path
-from ..lang import Literal
 
 try:
     from ..excel import ExcelWorkbook
     _available = True
 except ImportError:
     _available = False
 
@@ -44,28 +43,31 @@
     # -------------------------------------------------------------------------
     # OutFile subclassing
     #
 
     def _open_file(self):
         self._print_title()
 
-        parent = os.path.dirname(self.out)
-        if parent and not os.path.exists(parent):
-            os.makedirs(parent)
+        parent = filesh.dirname(self.out)
+        if parent and not filesh.exists(parent):
+            filesh.makedirs(parent)
 
         self.file = ExcelWorkbook.get_or_create_cached(self.out)
         self._must_close_file = True
 
         self.table = self.file.get_table(self.table_name, default=None)
         if not self.table:
             self.table = self.file.create_table(self.table_name, no_headers=True if not self._headers else False)
         
         if not self._append:
             self.table.truncate()
 
+        existing_headers = self._get_existing_headers()
+        return existing_headers
+
 
     # -------------------------------------------------------------------------
     # OutTable subclassing
     #
 
     def _get_existing_headers(self) -> list[str]|None:
         return self.table.column_names if self.table.has_headers else None
@@ -75,14 +77,18 @@
         self.table.insert_col(header)
     
 
     def _export_prepared_row(self, row: Iterable):
         table_row = self.table.insert_row()
         
         for i, value in enumerate(row):
+            if value is None:
+                # keep default formula if any (applied during table.erase_cell(), called from table.insert_row())
+                continue
+            
             if i < len(table_row):            
                 table_row[i] = value
             else:
                 logger.warning(f'ignore values from index {i} ({value})')
                 break
```

## zut/inout/OutFile.py

```diff
@@ -2,24 +2,23 @@
 from io import IOBase
 from atexit import register as register_atexit
 import logging
 import os
 from pathlib import Path
 import sys
 from typing import Any, Callable
-from ..lang import Literal
 from .. import filesh
 
-from .utils import get_inout_name, normalize_inout, Closable
+from .utils import get_inout_name, normalize_inout
 
 logger = logging.getLogger(__name__)
 
 
 class OutFile:
-    def __init__(self, out: str|Path|IOBase|Literal[False]|None = None, *, out_dir: str|Path|None = None, title: str|None = None, append: bool = False, encoding: str = 'utf-8-sig', newline: str = None, atexit: bool|Callable = None, **kwargs):
+    def __init__(self, out: str|Path|IOBase|None = None, *, out_dir: str|Path|None = None, title: str|None = None, append: bool = False, encoding: str = 'utf-8-sig', newline: str = None, atexit: bool|Callable = None, **kwargs):
         self.out = normalize_inout(out, dir=out_dir, title=title, **kwargs)
         self.name = get_inout_name(self.out)
         
         self._title = title
         self._append = append
         self._encoding = encoding
         self._newline = newline
@@ -71,17 +70,17 @@
             
         else:
             if isinstance(self.out, IOBase):
                 self.file = self.out
                 self._must_close_file = False
             
             else:
-                parent = os.path.dirname(self.out)
-                if parent and not os.path.exists(parent):
-                    os.makedirs(parent)
+                parent = filesh.dirname(self.out)
+                if parent and not filesh.exists(parent):
+                    filesh.makedirs(parent)
 
                 self.file = filesh.open_file(self.out, 'a' if self._append else 'w', newline=self._newline, encoding=self._encoding)
                 self._must_close_file = True
 
 
     def _print_title(self):
         if self._title is False:
```

## zut/inout/OutTable.py

```diff
@@ -5,34 +5,31 @@
 from enum import Enum
 from io import IOBase
 import json
 import logging
 from pathlib import Path
 from types import FunctionType
 from typing import Any, Iterable
-from ..lang import Literal, is_list_or_tuple_of
+from ..lang import is_list_or_tuple_of
 from .OutFile import OutFile
-from .utils import Closable
 
 logger = logging.getLogger(__name__)
 
 
 class OutTable(OutFile):
-    _file: Closable
-
     """
     A mixin for appending and exporting tabular data.
 
     Must be subclassed (to implement read/write of value).
     """
     @classmethod
     def is_available(cls):
         return True
     
-    def __init__(self, out: str|Path|IOBase|Literal[False]|None = None, append: bool = False, headers: list[str] = None, tz: Literal['local', 'utc']|timezone = None, **kwargs):
+    def __init__(self, out: str|Path|IOBase|None = None, append: bool = False, headers: list[str] = None, tz: timezone = None, **kwargs):
         if not self.is_available():
             raise ValueError(f"cannot use {type(self).__name__} (not available)")
     
         super().__init__(out, **kwargs)
         
         self._append = append
 
@@ -55,16 +52,16 @@
     # -------------------------------------------------------------------------
     # Actions on start/end (see OutFile)
     #
 
     def __enter__(self) -> OutTable:
         if self._start_atonce:
             if self._headers:
-                self._open_file()
-                self._export_headers()
+                existing_headers = self._open_file()
+                self._export_headers(existing_headers)
                 self._actually_started = True
 
         if self.atexit:
             if callable(self.atexit):
                 self.atexit(self)
             else:
                 register_atexit(self.end)
@@ -72,33 +69,31 @@
         return self
     
 
     def end(self):
         """
         This method is automatically executed when context ends (__exit__), except if `atexit` is truthy.
         """
-        if not self._actually_started:
-            self._open_file()
-            self._export_headers(at_end=True)
+        if not self._actually_started:        
+            existing_headers = self._open_file()
+            self._export_headers(existing_headers, at_end=True)
             self._actually_started = True
 
         self._export_delayed_rows()
 
         self._delayed_rows = []
         self._close_file()
     
 
     # -------------------------------------------------------------------------
     # Following methods are the core table export mechanism.
     # They are not supposed to be subclassed.
     #
 
-    def _export_headers(self, at_end=False):
-        existing_headers = self._get_existing_headers()
-
+    def _export_headers(self, existing_headers: list[str]|None, at_end=False):
         if not self._headers:
             if existing_headers:
                 if not (at_end and not self._delayed_rows):
                     raise ValueError(f"cannot export table without headers: existing table contains headers ({', '.join(existing_headers)})")
             return
         
         if existing_headers is None:
@@ -141,16 +136,16 @@
             self._delayed_rows.append(row)
         
         self._row_count += 1
 
 
     def _export_row(self, row: Iterable):
         if not self._actually_started:
-            self._open_file()
-            self._export_headers()
+            existing_headers = self._open_file()
+            self._export_headers(existing_headers)
             self._actually_started = True
 
         self._export_prepared_row(self._prepare_row(row))
 
 
     def _prepare_row(self, data: Iterable):
         if not self._reordering:
@@ -210,21 +205,31 @@
             
         return index
 
 
     # -------------------------------------------------------------------------
     # These methods are available for subclassing. 
     #
+    def _open_file(self) -> list[str]|None:
+        """
+        For OutTable and its subclass, `_open_table()` must return existing headers.
+
+        Depending on the situation, `_get_existing_headers()` may be called before opening the underlying file (in order to avoid potential file locking)
+        or after opening the underlying file (for example the Excel workbook for OutExcel).
+        """
+        existing_headers = self._get_existing_headers()
+        super()._open_file()
+        return existing_headers
     
+
     def _get_existing_headers(self) -> list[str]|None:
         """
         Get headers to consider in the existing target.
 
         Return a list (including empty list) if headers make sense.
-
         Return `None` if headers cannot be used at all.
         """
         raise NotImplementedError(f"method must be implemented by {type(self).__name__}")
 
 
     def _export_new_headers(self, headers: list[str]):
         """
```

## zut/inout/__init__.py

```diff
@@ -2,15 +2,14 @@
 from datetime import timezone
 
 import logging
 from io import IOBase
 from pathlib import Path
 import sys
 from typing import Any, Callable
-from ..lang import Literal
 from ..text import slugify
 from ..db import DbWrapper
 
 from .OutFile import OutFile
 from .OutTable import OutTable
 from .OutTabulate import OutTabulate
 from .OutCsv import OutCsv
@@ -21,24 +20,24 @@
 from .InCsv import InCsv
 from .InExcel import InExcel
 from .utils import is_excel_path, split_excel_path, normalize_inout
 
 logger = logging.getLogger(__name__)
 
 
-def out_file(out: str|Path|IOBase|Literal[False]|None = None, *, out_dir: str|Path|None = None, title: str|None = None, append: bool = False, encoding: str = 'utf-8-sig', newline: str = None, atexit: bool|Callable = None, format: OutFile = None, **kwargs) -> OutFile:
+def out_file(out: str|Path|IOBase|None = None, *, out_dir: str|Path|None = None, title: str|None = None, append: bool = False, encoding: str = 'utf-8-sig', newline: str = None, atexit: bool|Callable = None, format: OutFile = None, **kwargs) -> OutFile:
     if not format:
         format = OutFile
     elif not isinstance(format, type) or not issubclass(format, OutFile):
         raise ValueError(f"invalid format: {format}")
     
     return format(out, out_dir=out_dir, title=title, append=append, encoding=encoding, newline=newline, atexit=atexit, **kwargs)
 
 
-def out_table(out: Path|str|IOBase|Literal[False]|None = None, *, out_dir: str|Path|None = None, title: str|None = None, append: bool = False, encoding: str = 'utf-8-sig', headers: list[str] = None, delimiter: str = None, quotechar: str = '"', tz: Literal['local']|timezone = None, decimal_separator: str = None, atexit: bool|Callable = None, format: OutTable|Literal['csv','excel','tabulate'] = None, **kwargs) -> OutTable:
+def out_table(out: Path|str|IOBase|None = None, *, out_dir: str|Path|None = None, title: str|None = None, append: bool = False, encoding: str = 'utf-8-sig', headers: list[str] = None, delimiter: str = None, quotechar: str = '"', tz: timezone = None, decimal_separator: str = None, atexit: bool|Callable = None, format: OutTable|str = None, **kwargs) -> OutTable:
     if not format:
         if isinstance(out, str) and out.startswith('db:'):
             format = OutDb
         elif OutTabulate.is_available() and (out is None or out == 'stdout' or out == sys.stdout or out == 'stderr' or out == sys.stderr):
             format = OutTabulate
         elif isinstance(out, (str,Path)) and is_excel_path(out, accept_table_suffix=True):
             format = OutExcel
@@ -52,15 +51,15 @@
         format = OutTabulate
     elif not isinstance(format, type) or not issubclass(format, OutTable):
         raise ValueError(f"invalid format: {format}")
 
     return format(out, out_dir=out_dir, title=title, append=append, encoding=encoding, headers=headers, delimiter=delimiter, tz=tz, decimal_separator=decimal_separator, quotechar=quotechar, atexit=atexit, **kwargs)
 
 
-def in_table(src: Path|str|IOBase|DbWrapper, query: str = None, *args, src_dir: str|Path|None = None, title: str|None = None, encoding: str = 'utf-8', delimiter: str = None, quotechar: str = '"', formatters: dict[int|str,Callable] = None, debug: bool = False, limit: int = None, format: InTable|Literal['csv','excel'] = None, **kwargs) -> InTable:
+def in_table(src: Path|str|IOBase|DbWrapper, query: str = None, *args, src_dir: str|Path|None = None, title: str|None = None, encoding: str = 'utf-8', delimiter: str = None, quotechar: str = '"', formatters: dict[int|str,Callable] = None, debug: bool = False, limit: int = None, format: InTable|str = None, **kwargs) -> InTable:
     if not format:
         if isinstance(src, DbWrapper) or (isinstance(src, str) and src.startswith('db:')):
             format = InDb
         elif isinstance(src, (str,Path)) and is_excel_path(src, accept_table_suffix=True):
             format = InExcel
         else:
             format = InCsv
```

## zut/inout/utils.py

```diff
@@ -2,23 +2,16 @@
 
 import os
 import re
 import sys
 from io import IOBase
 from pathlib import Path
 
-from ..lang import Literal, Protocol
 
-
-class Closable(Protocol):
-    def close(self):
-        ...
-
-
-def normalize_inout(inout: str|Path|IOBase|Literal[False]|None, *, dir: str|Path|None, **kwargs) -> str|IOBase:
+def normalize_inout(inout: str|Path|IOBase|None, *, dir: str|Path|None, **kwargs) -> str|IOBase:
     if inout == 'stdout' or inout == sys.stdout or inout is None:
         return sys.stdout
     elif inout == 'stderr' or inout == sys.stderr:
         return sys.stderr
     elif inout == 'stdin' or inout == sys.stdin:
         return sys.stdin
     elif inout == False:
@@ -30,15 +23,15 @@
         if dir and not ':' in inout and not inout.startswith('.'):
             inout = os.path.join(str(dir), inout)
         return os.path.expanduser(inout)
     else:
         raise ValueError(f'invalid inout type: {type(inout)}')
 
 
-def get_inout_name(inout: str|Path|IOBase|Literal[False]|None) -> str:
+def get_inout_name(inout: str|Path|IOBase|None) -> str:
     if inout == 'stdout' or inout == sys.stdout or inout is None:
         return '<stdout>'
     elif inout == 'stderr' or inout == sys.stderr:
         return '<stderr>'
     elif inout == 'stdin' or inout == sys.stdin:
         return '<stdin>'
     elif inout == False:
```

## Comparing `zut-0.6.3.dist-info/LICENSE.txt` & `zut-0.6.4.dist-info/LICENSE.txt`

 * *Files identical despite different names*

## Comparing `zut-0.6.3.dist-info/METADATA` & `zut-0.6.4.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: zut
-Version: 0.6.3
+Version: 0.6.4
 Summary: Reusable Python, Django and PostgreSql utilities.
 Author-email: Ipamo <dev@ipamo.net>
 Project-URL: Homepage, https://github.com/ipamo/zut
 Project-URL: Bug Tracker, https://github.com/ipamo/zut/issues
 Keywords: reusable,util,utils,common,commons,flexout,csv,excel,tabulate,smb,samba,share
 Classifier: Development Status :: 4 - Beta
 Classifier: License :: OSI Approved :: MIT License
@@ -15,27 +15,27 @@
 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
 Classifier: Topic :: Software Development :: Libraries
 Requires-Python: >=3.7.3
 Description-Content-Type: text/markdown
 License-File: LICENSE.txt
-Requires-Dist: typing-extensions ; python_version < "3.11"
 Provides-Extra: all
 Requires-Dist: cmarkgfm ; extra == 'all'
 Requires-Dist: django ; extra == 'all'
 Requires-Dist: djangorestframework ; extra == 'all'
 Requires-Dist: openpyxl ; extra == 'all'
 Requires-Dist: defusedxml ; extra == 'all'
 Requires-Dist: pyodbc ; extra == 'all'
 Requires-Dist: sqlparams ; extra == 'all'
 Requires-Dist: sqlparse ; extra == 'all'
 Requires-Dist: psycopg2-binary ; extra == 'all'
 Requires-Dist: smbprotocol ; extra == 'all'
 Requires-Dist: tabulate ; extra == 'all'
+Requires-Dist: typing-extensions ; (python_version < "3.11") and extra == 'all'
 Requires-Dist: keyring ; (sys_platform == "win32") and extra == 'all'
 Requires-Dist: pywin32 ; (sys_platform == "win32") and extra == 'all'
 Provides-Extra: credentials
 Requires-Dist: keyring ; (sys_platform == "win32") and extra == 'credentials'
 Requires-Dist: pywin32 ; (sys_platform == "win32") and extra == 'credentials'
 Provides-Extra: django
 Requires-Dist: cmarkgfm ; extra == 'django'
@@ -52,14 +52,16 @@
 Requires-Dist: psycopg2-binary ; extra == 'pg'
 Requires-Dist: sqlparse ; extra == 'pg'
 Requires-Dist: sqlparams ; extra == 'pg'
 Provides-Extra: smb
 Requires-Dist: smbprotocol ; extra == 'smb'
 Provides-Extra: tabulate
 Requires-Dist: tabulate ; extra == 'tabulate'
+Provides-Extra: typing
+Requires-Dist: typing-extensions ; (python_version < "3.11") and extra == 'typing'
 Provides-Extra: winhttp
 Requires-Dist: pywin32 ; (sys_platform == "win32") and extra == 'winhttp'
 
 Zut
 ===
 
 Reusable Python, Django and PostgreSql utilities.
@@ -83,15 +85,15 @@
 ### Configure logging
 
 ```py
 from zut import configure_logging
 configure_logging()
 ```
 
-### Flexible in/out - TODO
+### Flexible in/out
 
 Write text or tabular data to a flexible, easily configurable output: CSV or Excel file, or tabulated stdout/stderr.
 
 The output file may be on the local file system or on a Windows/Samba share (including when the library is used on Linux).
 
 Export text to stdout or to a file:
```

## Comparing `zut-0.6.3.dist-info/RECORD` & `zut-0.6.4.dist-info/RECORD`

 * *Files 7% similar despite different names*

```diff
@@ -1,30 +1,31 @@
-zut/__init__.py,sha256=Byn3JsXGznnJIkOULgvcs7cV_HoAe6nyUEdm0Tp2eUA,2157
-zut/_version.py,sha256=mFm3cAXzqKjM-5nKtnauQIPo1DPoSKHWL2wi6y8dIc0,164
+zut/__init__.py,sha256=oaxRzTW6q6yJkXot7O0sb5zGsDXjvyofnPmDdASP2IA,2172
+zut/_version.py,sha256=-1I2Rc1r60PPGi3Q_MAqpzf3LwxAChD5fuG04BNLNZo,164
 zut/apps.py,sha256=jQ5XEeKzi7EBmtPjeZb8sAph8XWTT98g8zqGwVWIK2U,276
 zut/colors.py,sha256=T_NrD_MBlHoL5-muusPNmMlDcP3fGZnsVnd8jICGZIQ,949
 zut/commands.py,sha256=WDCPxtGnKIqv31gBOvVoP7qYJHs9ozjlzyB_QOJ0ynU,6914
 zut/config.py,sha256=jJ2Yd18JtvglQZK-qIdqCWNH83ZHFvWdrfuVC_Eeiy8,1979
 zut/credentials.py,sha256=VeC0Tdium0F0X1UfMieqWog-W4SGC6RC1QNO_kd4-xA,9861
-zut/csv.py,sha256=I8VuJaEbRuHsr_EkxOalsY0-vOmMKx3O5QoCSAHcv2s,1218
-zut/datetime.py,sha256=W_drp5fj0HhfyVAaU8BfPSNpYplR1bPb0Axa6DIQhxY,1488
-zut/excel.py,sha256=olPkMSmypRqXTTi_zoQm0Ww1roBhNzD8WC5UEQs9fjY,17630
-zut/filesh.py,sha256=EbIF5vwmbAETkzA9c-cJEEhckKpKjA8hsdBTjwccqKk,9037
+zut/csv.py,sha256=PqmJdxqkhHdW6pteVjiuZTV1fUpXK7mtynWayGHZKEY,1220
+zut/datetime.py,sha256=jyb_zTv-CgoEOwT3zXmBU8WfET7gOjsGPLAI2YnqEls,1662
+zut/excel.py,sha256=dRiDYfTAb_39H_FEnAh85T3nBhX6wMHiWod0wWyA0RE,19433
+zut/filesh.py,sha256=VlDtbcQrPHlAg0I5IOlgqE75R4tptcFixyH3DOVWCfQ,12996
 zut/git.py,sha256=A0oJiGkMOTleHyD6guaz2q507iGW6FBdpUyoAmPUXyU,2590
 zut/gpg.py,sha256=ax0CO0I9hq5yAtzOfxvwTp8jJR0PzzQ-oOQRbNtjzfk,1537
 zut/json.py,sha256=9UrErYUQyEYz11fQUtVovYv26XKPlcdDuKynupNzD38,4943
-zut/lang.py,sha256=PcBQG8RLjHUGUNHcHoUsG-QLRmVhOpjnE8CbJhkJAUI,731
+zut/lang.py,sha256=MfCa-2W-4zoF9UQpx9b5BQTWfMsM0d0glq_auaPupbY,429
 zut/logging.py,sha256=5reFTldB4OXVLr6dbCY9z_yGv9vW6qbBp-4HOrV9HCo,4578
-zut/numeric.py,sha256=VlHa0OZezDa9DxKCOLNjK4OiwmXlZUcZI0xnJxGJ3tg,3116
+zut/numeric.py,sha256=3aQ0mEaOR-QNr32N5oKfmUGiQvgLjN1xCnFoOp8XGKE,3252
 zut/process.py,sha256=P1XtNqm13hwEvFYr9lQjPzirpRXe2ZBCQU6fcU5DVGE,2710
 zut/tabular.py,sha256=XQUEFiYW6uUbqLxWrzhLs_4iPuUuQI7rIPDZMPhhZEw,2054
 zut/text.py,sha256=ePkvz5CkB2J9enwZwV1H-EMfgVsmLjRsp-0m-sw9aZw,2019
+zut/typing.py,sha256=yFyfrxO3JZcvZwNAkNDmy-Lz7F6IPH5W61KXBkc6A_s,309
 zut/venv.py,sha256=0D8WhnKZeIb-kIlXO03bW9zibUaumMrH8sBVw2rscqI,632
 zut/db/__init__.py,sha256=kIIvke3nvHIRCmwrkwu72mLOHLnBMBpFMBQ5Hh1zhNA,1665
-zut/db/commons.py,sha256=RvDdBARUiDTi7XLQCrztlPUIbcDvG1tEw2fMhcGhK7A,15036
+zut/db/commons.py,sha256=unXTHZoMe3AhQK97MZ_HYhu1QpMmhZ3PmwrI-OsIei0,14970
 zut/db/mssql.py,sha256=wTYz_w13PxOkptesuoqlC8bI2MGZwm1RmyEuD764NQ4,2650
 zut/db/pg.py,sha256=9sXyh8qvRxnCP43MvQ1kYJ3VMSJLK_1PRbh9Fh9U-1Y,8672
 zut/db/sql_pg/010_extensions.sql,sha256=_uPdGwRw1eMwgO57xs-WSftqSbG62dmGJbdCl9mh7Z0,42
 zut/db/sql_pg/020_slugify.sql,sha256=bQy0KSOD3pYQnEHonP2zAENxINWrxIWtPEvdBfnl4Po,479
 zut/django/migration_tools.py,sha256=fzpZsDhGPRJj7lsWKPzuMiwqGrMGWpFiY7UHsS0Li3w,1157
 zut/django/management/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 zut/django/management/commands/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
@@ -34,26 +35,26 @@
 zut/django/templatetags/static_lib.py,sha256=p3jbZGCNlqOWpDZFnGXonKlOOHZKQuNwR6ziF0wY0io,2808
 zut/django/tracking/__init__.py,sha256=KtHO-ri7ThbrYeu3Wvjpo73Izk7Jp7Dqouu9lwooDIc,9036
 zut/django/tracking/models.py,sha256=gB1wQG-JyYq3cXPKBGXMJB2AG2AlAcBzT7eXNyKsKBA,4666
 zut/django/tracking/sql_pg/tracking_history_view.sql,sha256=o79jhgTnQ8nvx_nlILKQDnFjccC1M3WgAEYUAjMd5Gw,621
 zut/django/views/MarkdownTemplateView.py,sha256=fNNDD5Z71fZucbnUKhcyCCBmDFFLzY6DVEgdn3pcYkA,1652
 zut/django/views/__init__.py,sha256=1ueMo8cvT4-sr9csWSxwWvlGot7__HWqAwT38gIVVZU,56
 zut/inout/InCsv.py,sha256=oOI-H-WutdfGk2pZhOG7NMKO_f65WkgHT2o1oaIKCVM,1767
-zut/inout/InDb.py,sha256=TEcqrLfTaR86iwwZxRVlL-vKsoo3HDpvyt9yJMiDOak,2155
+zut/inout/InDb.py,sha256=xLffAgM1snpU9hMzgJFiWsn9ufEH0kL5I_aHMqB_9eA,2124
 zut/inout/InExcel.py,sha256=3MHjziiiv2DKfvwS_UZgBm5AJV5CxyyjpnHUXor8C5I,1403
-zut/inout/InTable.py,sha256=jjR-i_K6zFuPp5v7U2mJPs7WN-W4uFMZYjH1wJ-5gkQ,4127
-zut/inout/OutCsv.py,sha256=M2j3eieV0yIXVPEIIwztfTWhzk2VJwayVIhLGuUaz9E,4662
-zut/inout/OutDb.py,sha256=GPyQuFiCGYUv1gD5Mif3CAmsGq138bSa93u_8Vn8s3M,2884
-zut/inout/OutExcel.py,sha256=06Ik5hQf4oPazqhhMyRrt-g8-1qntMiHpDihnyW_bU8,3076
-zut/inout/OutFile.py,sha256=prO5fJAav-hUgfk6KRvKwh5zAJiANqk6zhDkLsCoZfY,3202
-zut/inout/OutTable.py,sha256=SlbnvM7NchXE4Nru1mNETV1AN5rujEWun0tpccOWnbc,9687
+zut/inout/InTable.py,sha256=IZXiHiWau4uWehlCXvgFq-i9keOcyJTGeQg_fiIF_OY,4082
+zut/inout/OutCsv.py,sha256=_uzvUwDCmX9zwz4wRIsTHdDs7ADJpcxrrrZHEQsu2sE,4626
+zut/inout/OutDb.py,sha256=ujN8Pzx_nDjUp7fW80EDQrJLt3UEC5y7I6NRLC3SG0g,2876
+zut/inout/OutExcel.py,sha256=-OgeKWhDu2weRwGxEVED0RDa6-zt3-Znow71_mHHqeQ,3340
+zut/inout/OutFile.py,sha256=QOX5Yk_dXEIpHj_QsX2epykd-c9jEab8cQhJIfu15hs,3151
+zut/inout/OutTable.py,sha256=mLejmHHFlSTRfaf3gKmq7NlNcSBvRC5rBES6Km3OCmo,10204
 zut/inout/OutTabulate.py,sha256=u3zd8QrbdofEdnvN1r4jI4QVwIqBd34WRFtwfyUcl4Q,1163
-zut/inout/__init__.py,sha256=mhdz0D4IjesmSpG7pf0H55ygs4aYMxHJoqMnEFmU5J8,7385
-zut/inout/utils.py,sha256=e_izFPlilYnVs2AgqRje_fhNzPZuETeDdY3AwBNrzoE,2922
+zut/inout/__init__.py,sha256=kr7cs3k3EmWGxtwRMOWoJ7Yj2ATVS1QRiEJsXoeCLa8,7261
+zut/inout/utils.py,sha256=SkgU1TyoWGVF7VTqifsoO9hhZt79gvvyD7hwFg4N0rg,2786
 zut/network/__init__.py,sha256=DaidKvr4BcJ3xL7fT1jUixRsXM1E8WQKgdbk0xCGvH8,9147
 zut/network/commons.py,sha256=ZeVqQ5I1neDMx3-GEUJFgCTOIlBAVSXmgPvhc7ETh4A,3850
 zut/network/winhttp.py,sha256=sJQQc0a7-BLI5NEI82F4x4qEYBNtx31kAgNZkOGvoyM,2962
-zut-0.6.3.dist-info/LICENSE.txt,sha256=g3B0wycmR6XLn-gWLyJ8IwvBHSAs3pzqmiwME45tzJk,1066
-zut-0.6.3.dist-info/METADATA,sha256=iMQH__rBfS0yDR19z_ik_9V7-L3kfI8tPuro1-x3hgo,4840
-zut-0.6.3.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-zut-0.6.3.dist-info/top_level.txt,sha256=0b5rfbMHLPzpcwBifEaAzzfyv1gZPGT7RXa2myDnXXs,4
-zut-0.6.3.dist-info/RECORD,,
+zut-0.6.4.dist-info/LICENSE.txt,sha256=g3B0wycmR6XLn-gWLyJ8IwvBHSAs3pzqmiwME45tzJk,1066
+zut-0.6.4.dist-info/METADATA,sha256=HlaR3YUZEuSuaSaZxeu0Nnfnl_PeAwBjTCtG7iTYkUQ,4962
+zut-0.6.4.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+zut-0.6.4.dist-info/top_level.txt,sha256=0b5rfbMHLPzpcwBifEaAzzfyv1gZPGT7RXa2myDnXXs,4
+zut-0.6.4.dist-info/RECORD,,
```

